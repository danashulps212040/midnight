<div class="module-header" style="padding: 90px 20px 20px 20px; font-size: 14px;">
<link rel="stylesheet" href="/static/css/custom-scrollbar.css">
  <h1>Entradas de Estoque</h1>

<div class="search-filters" style="margin-bottom: 20px; padding: 15px; background-color: rgba(19, 4, 60, 0.69); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 2px solid #9B64E3; border-radius: 10px;">
    <div class="search-container" style="display: flex; margin-bottom: 15px;">
        <input type="text" id="searchEntrada" placeholder="Pesquisar entrada..." style="flex: 1; padding: 10px; border: 0.2px solid #9B64E3; border-radius: 5px 0 0 5px; background-color: rgba(255, 255, 255, 0.1); color: white;">
        <button type="button" id="searchButton" style="padding: 10px 15px; background-color: rgba(155, 100, 227, 0.1); border: 1px solid #9b63e3; border-left: none; border-radius: 0 5px 5px 0; color: white; cursor: pointer;" onmouseover="this.style.backgroundColor='#D8CEFE'" onmouseout="this.style.backgroundColor='rgba(155, 100, 227, 0.1)'">
            <i class="search-icon">&#128269;</i>
        </button>
    </div>
</div>

<!-- Lista de Entradas -->
<div class="entradas-list-container" style="background-color: var(--order-card-bg); border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <div class="entradas-list-header" style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr; gap: 15px; font-weight: bold; padding: 15px 20px; border-bottom: 2px solid var(--cor-destaque, #9B64E3); color: var(--column-title-text);">
        <div>Material</div>
        <div>Quantidade</div>
        <div>Data Entrada</div>
        <div>Fornecedor</div>
        <div>Nota Fiscal</div>
        <div>Custo Unit.</div>
        <div>Lote</div>
        <div>Localização</div>
        <div>Ações</div>
    </div>
    <div class="entradas-list" style="margin-top: 10px;">
        <!-- Dados das entradas serão carregados dinamicamente aqui -->
    </div>
</div>

<script>
// Função para carregar lista de entradas
window.carregarListaEntradas = function() {
    fetch('/api/entradas_estoque')
        .then(response => {
            const statusCode = response.status;
            return response.json().then(data => ({ data, statusCode }));
        })
        .then(({ data, statusCode }) => {
            if (data.status === 'success') {
                const container = document.querySelector('.entradas-list');
                container.innerHTML = '';
                
                if (data.entradas.length === 0) {
                    const emptyRow = document.createElement('div');
                    emptyRow.className = 'entrada-item';
                    emptyRow.style.cssText = 'justify-content: center; color: #666; padding: 20px;';
                    emptyRow.textContent = 'Nenhuma entrada registrada.';
                    container.appendChild(emptyRow);
                    return;
                }
                
                data.entradas.forEach(entrada => {
                    const row = document.createElement('div');
                    row.className = 'entrada-item';
                    row.style.cssText = 'display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr; gap: 15px; padding: 12px 20px; margin: 8px 0; border-radius: 6px; transition: background-color 0.2s ease; align-items: center;';
                    
                    // Formatar custo unitário como moeda
                    const custoFormatado = entrada.custo_unitario ? 
                        new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(entrada.custo_unitario) : '-';
                    
                    // Formatar data
                    const data = entrada.data_entrada ? new Date(entrada.data_entrada).toLocaleDateString('pt-BR') : '-';
                    
                    row.innerHTML = `
                        <div>${entrada.item_nome || '-'}</div>
                        <div>${entrada.quantidade || '-'}</div>
                        <div>${data}</div>
                        <div>${entrada.fornecedor || '-'}</div>
                        <div>${entrada.nota_fiscal || '-'}</div>
                        <div>${custoFormatado}</div>
                        <div>${entrada.lote || '-'}</div>
                        <div>${entrada.localizacao || '-'}</div>
                        <div class="entrada-actions" style="display: flex; gap: 5px; align-items: center;">
                            <button class="action-btn" data-tooltip="Detalhes" onclick="visualizarDetalhesEntrada(${entrada.id})" style="background: none; border: none; cursor: pointer; padding: 5px; border-radius: 4px; transition: background-color 0.2s ease; color: var(--action-icon-color);">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                    `;
                    
                    // Adicionar hover effect
                    row.addEventListener('mouseover', function() {
                        this.style.backgroundColor = 'var(--order-card-hover-bg)';
                    });
                    
                    row.addEventListener('mouseout', function() {
                        this.style.backgroundColor = '';
                    });
                    
                    container.appendChild(row);
                });
            } else {
                console.error('Erro ao carregar lista de entradas:', data.message);
                showNotification('error', 'Erro ao carregar entradas: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Erro na requisição:', error);
            showNotification('error', 'Erro ao carregar entradas: ' + error.message);
        });
}

// Carregar lista inicial de entradas quando a página carregar
document.addEventListener('DOMContentLoaded', function() {
    carregarListaEntradas();
    
    // Configurar busca
    const searchInput = document.getElementById('searchEntrada');
    const searchButton = document.getElementById('searchButton');
    
    let debounceTimeout;
    
    searchInput.addEventListener('input', function() {
        clearTimeout(debounceTimeout);
        debounceTimeout = setTimeout(() => {
            realizarBusca(this.value);
        }, 300);
    });
    
    searchButton.addEventListener('click', function() {
        realizarBusca(searchInput.value);
    });
});

function realizarBusca(termo) {
    // Implementar lógica de busca aqui
    console.log('Realizando busca por:', termo);
}

function visualizarDetalhesEntrada(id) {
    // Implementar visualização de detalhes aqui
    console.log('Visualizando detalhes da entrada:', id);
}
</script>

<style>
.entrada-actions {
    opacity: 0.7;
    visibility: visible;
    transition: opacity 0.2s ease, visibility 0.2s ease;
}

.entrada-item:hover .entrada-actions {
    opacity: 1;
}

.action-btn {
    position: relative;
}

.action-btn:hover {
    background-color: rgba(155, 100, 227, 0.2);
    color: var(--cor-destaque, #9B64E3);
}

.action-btn[data-tooltip]:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 12px;
    white-space: nowrap;
    z-index: 10;
    margin-bottom: 5px;
}

:root {
    --action-icon-color: #9B64E3;
    --order-card-hover-bg: rgba(155, 100, 227, 0.1);
}
</style>
</div>
