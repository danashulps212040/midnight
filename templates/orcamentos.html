<div class="module-header" style="padding: 90px 20px 20px 20px; font-size: 14px;">
  <h1>Or√ßamentos</h1>
  
<div class="search-container" style="margin-bottom: 20px;margin-top: 30px;"><input type="text" id="searchOrcamento" placeholder="Pesquisar or√ßamento..." class="search-input" style="width: 30%; padding: 8px 16px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 5px; background-color: rgba(255, 255, 255, 0.1); color: white;"></div>

<!-- Modal para Incluir Or√ßamento -->
<div id="orcamentoModal" class="modal" style="display: none;">
    <div class="modal-content orcamento-modal-content">
        <div class="modal-header">
            <h2 id="modalOrcamentoTitulo">Incluir Or√ßamento</h2>
            <span class="close-button" onclick="closeOrcamentoModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="orcamentoForm">
                <div class="orcamento-layout">
                    <!-- Coluna Esquerda: Informa√ß√µes B√°sicas -->
                    <div class="orcamento-left-column">
                        <!-- Informa√ß√µes B√°sicas -->
                        <!-- Campos ocultos para n√∫mero e data do or√ßamento -->
                        <input type="hidden" id="numeroOrcamento" name="numeroOrcamento" readonly>
                        <input type="hidden" id="dataOrcamento" name="dataOrcamento" readonly>
                        
                        <div class="form-group">
                            <label for="cliente">Cliente:</label>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <div class="dropdown custom-select" tabindex="0" role="button" id="cliente" style="flex: 1;">
                                    <button type="button" tabindex="0">Selecione o Cliente</button>
                                    <div class="dropdown-content">
                                        <!-- Op√ß√µes ser√£o carregadas dinamicamente -->
                                    </div>
                                </div>
                                <button type="button" onclick="buscarCliente()" class="btn-search">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="11" cy="11" r="8"/>
                                        <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="validadeOrcamento">Validade:</label>
                            <input type="date" id="validadeOrcamento" name="validadeOrcamento" onchange="calcularPrazoEntrega()">
                        </div>
                        
                        <div class="form-group">
                            <label for="dataEntrega">Data e hora de entrega:</label>
                            <input type="datetime-local" id="dataEntrega" name="dataEntrega" onchange="calcularPrazoEntrega()">
                        </div>
                        
                        <div class="form-group">
                            <label for="vendedor">
                                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIwIDIxdi0yYTQgNCAwIDAgMC00LTRIOGE0IDQgMCAwIDAtNCA0djIiIHN0cm9rZT0iI0Q4Q0VGRSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPGNpcmNsZSBjeD0iMTIiIGN5PSI3IiByPSI0IiBzdHJva2U9IiNEOENFRkUiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjwvc3ZnPg==" style="width: 14px; height: 14px; margin-right: 6px; vertical-align: middle;">
                                Vendedor:
                            </label>
                            <div class="input-group">
                                <input type="text" id="vendedor" name="vendedor" readonly placeholder="Selecione o vendedor">
                                <button type="button" class="search-btn" onclick="buscarVendedor()">
                                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTEiIGN5PSIxMSIgcj0iOCIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjIiLz4KPHBhdGggZD0ibTIxIDIxLTQuMzUtNC4zNSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+" alt="üîç">
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="condicoesPagamento">Condi√ß√µes:</label>
                            <div class="dropdown custom-select" tabindex="0" role="button" id="condicoesPagamento">
                                <button type="button" tabindex="0">Selecione</button>
                                <div class="dropdown-content">
                                    <div>Dinheiro</div>
                                    <div>D√©bito</div>
                                    <div>Cr√©dito</div>
                                    <div>PIX</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group" id="parcelamentoGroup" style="display: none;">
                            <label for="parcelas">Parcelas:</label>
                            <div class="dropdown custom-select" tabindex="0" role="button" id="parcelas">
                                <button type="button" tabindex="0">Selecione</button>
                                <div class="dropdown-content">
                                    <div data-value="2">2x</div>
                                    <div data-value="3">3x</div>
                                    <div data-value="4">4x</div>
                                    <div data-value="5">5x</div>
                                    <div data-value="6">6x</div>
                                    <div data-value="7">7x</div>
                                    <div data-value="8">8x</div>
                                    <div data-value="9">9x</div>
                                    <div data-value="10">10x</div>
                                    <div data-value="11">11x</div>
                                    <div data-value="12">12x</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="prazoEntrega">
                                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTAiIHN0cm9rZT0iI0Q4Q0VGRSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjxwb2x5bGluZSBwb2ludHM9IjEyLDYgMTIsMTIgMTYsNDE0IiBzdHJva2U9IiNEOENFRkUiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjwvc3ZnPg==" style="width: 14px; height: 14px; margin-right: 6px; vertical-align: middle;">
                                Prazo de Entrega:
                            </label>
                            <input type="text" id="prazoEntrega" name="prazoEntrega" placeholder="Calculado automaticamente" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label for="desconto">Desconto:</label>
                            <input type="text" id="desconto" name="desconto" placeholder="R$ 0,00">
                        </div>
                        
                        <div class="form-group">
                            <label for="observacoesOrcamento">Observa√ß√µes:</label>
                            <textarea id="observacoesOrcamento" name="observacoes" rows="1" placeholder="Observa√ß√µes gerais do or√ßamento..."></textarea>
                        </div>
                    </div>

                    <!-- Coluna Direita: Sistema de Abas -->
                    <div class="orcamento-right-column">
                        <div class="tabs-container">
                            <div class="tabs-header">
                                <button type="button" class="tab-button active" data-tab="itens" onclick="switchOrcamentoTab('itens', this)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M3 3h18v18H3zM9 9h6v6H9z"/>
                                    </svg>
                                    Itens/Servi√ßos
                                </button>
                                <button type="button" class="tab-button" data-tab="resumo" onclick="switchOrcamentoTab('resumo', this)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14,2 14,8 20,8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                    </svg>
                                    Descritivo
                                </button>
                                <button type="button" class="tab-button" data-tab="producao" onclick="switchOrcamentoTab('producao', this)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                        <path d="M2 17l10 5 10-5"/>
                                        <path d="M2 12l10 5 10-5"/>
                                    </svg>
                                    Produ√ß√£o
                                </button>
                            </div>

                            <!-- Aba Itens/Servi√ßos -->
                            <div id="itens-tab" class="tab-content active">
                                <div class="itens-actions">
                                    <div class="item-search">
                                        <input type="text" placeholder="Digite para buscar um item..." onkeyup="buscarItens(this.value)">
                                        <div id="itensDropdown" class="dropdown-results">
                                            <!-- Os itens ser√£o adicionados aqui dinamicamente -->
                                        </div>
                                    </div>
                                    <button type="button" onclick="abrirModalProdutos()" class="btn-add-produtos">
                                        + Produtos
                                    </button>
                                </div>
                                
                                <div class="itens-table-container">
                                    <table class="itens-table">
                                        <thead>
                                            <tr>
                                                <th>Item</th>
                                                <th>Qtd</th>
                                                <th>Pre√ßo Unit.</th>
                                                <th>Desconto (%)</th>
                                                <th>Total</th>
                                                <th>A√ß√µes</th>
                                            </tr>
                                        </thead>
                                        <tbody id="itensTabela">
                                            <!-- Os itens ser√£o adicionados dinamicamente aqui -->
                                        </tbody>
                                    </table>
                                </div>

                                <div class="totais-container">
                                    <div class="total-row">
                                        <span class="total-label">Pre√ßo Total:</span>
                                        <span id="precoTotal" class="total-value">R$ 0,00</span>
                                    </div>
                                    <div class="total-row">
                                        <span class="total-label">Custo Total:</span>
                                        <span id="custoTotal" class="total-value">R$ 0,00</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Aba Descritivo -->
                            <div id="resumo-tab" class="tab-content">
                                <div class="descritivo-container">
                                    <div class="descritivo-header">
                                        <div class="descritivo-header-top">
                                            <h4>Descritivo do Or√ßamento</h4>
                                            <button id="btnImprimirDescritivo" type="button" class="btn-imprimir-descritivo" onclick="imprimirDescritivo(event)" title="Imprimir Descritivo">
                                                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTcgM0gxN0MxNy41NTIzIDMgMTggMy40NDc3MiAxOCA0VjZIMjBDMjAuNTUyMyA2IDIxIDYuNDQ3NzIgMjEgN1YxN0MyMSAxNy41NTIzIDIwLjU1MjMgMTggMjAgMThIMThWMjBDMTggMjAuNTUyMyAxNy41NTIzIDIxIDE3IDIxSDdDNi40NDc3MiAyMSA2IDIwLjU1MjMgNiAyMFYxOEg0QzMuNDQ3NzIgMTggMyAxNy41NTIzIDMgMTdWN0MzIDYuNDQ3NzIgMy40NDc3MiA2IDQgNkg2VjRDNiAzLjQ0NzcyIDYuNDQ3NzIgMyA3IDNaTTggNVY3SDE2VjVIOFpNMTYgMTZWMTlIOFYxNkgxNlpNMTkgOEg1VjE2SDZWMTVDNiAxNC40NDc3IDYuNDQ3NzIgMTQgNyAxNEgxN0MxNy41NTIzIDE0IDE4IDE0LjQ0NzcgMTggMTVWMTZIMTlWOFpNMTcgMTBINUMxNC40NDc3IDEwIDE0IDEwLjQ0NzcgMTQgMTFTMTQuNDQ3NyAxMiAxNSAxMkgxN0MxNy41NTIzIDEyIDE4IDExLjU1MjMgMTggMTFTMTcuNTUyMyAxMCAxNyAxMFoiIGZpbGw9ImN1cnJlbnRDb2xvciIvPgo8L3N2Zz4K" alt="Imprimir">
                                                <span>Imprimir Descritivo</span>
                                            </button>
                                        </div>
                                        <div class="descritivo-totais">
                                            <span class="total-items">Total de Itens: <strong id="descritivoTotalItens">0</strong></span>
                                            <span class="valor-total">Valor Total: <strong id="descritivoValorTotal">R$ 0,00</strong></span>
                                        </div>
                                    </div>
                                    
                                    <div class="descritivo-produtos">
                                        <div id="descritivoListaProdutos" class="produtos-descritivos">
                                            <div class="no-products">
                                                <p>Nenhum produto adicionado ao or√ßamento</p>
                                                <p class="sub-text">Adicione produtos na aba "Itens/Servi√ßos" para visualizar o descritivo</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Aba Produ√ß√£o -->
                            <div id="producao-tab" class="tab-content">
                                <div class="producao-container">
                                    <div class="producao-header">
                                        <h4>An√°lise de Produ√ß√£o</h4>
                                        <span class="producao-subtitle">Resumo de materiais e tempo de m√°quinas necess√°rios</span>
                                    </div>

                                    <div class="producao-content">
                                        <!-- Se√ß√£o de Materiais -->
                                        <div class="producao-section">
                                            <div class="section-header">
                                                <h5>
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                                                        <line x1="8" y1="21" x2="16" y2="21"/>
                                                        <line x1="12" y1="17" x2="12" y2="21"/>
                                                    </svg>
                                                    Materiais Necess√°rios
                                                </h5>
                                            </div>
                                            <div class="materiais-resumo">
                                                <div id="listaMateriais" class="materiais-lista">
                                                    <div class="no-materials">
                                                        <p>Nenhum material encontrado</p>
                                                        <p class="sub-text">Adicione produtos com materiais especificados para ver o resumo</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Se√ß√£o de M√°quinas/Tempo -->
                                        <div class="producao-section">
                                            <div class="section-header">
                                                <h5>
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                        <circle cx="12" cy="12" r="3"/>
                                                        <path d="M12 1v6m0 6v6"/>
                                                        <path d="m15.5 3.5-1.1 1.1m-3.9 0L9.4 3.4m6.1 14.1-1.1-1.1m-3.9 0-1.1 1.1"/>
                                                    </svg>
                                                    Tempo de M√°quinas
                                                </h5>
                                            </div>
                                            <div class="maquinas-resumo">
                                                <div id="listaMaquinas" class="maquinas-lista">
                                                    <div class="no-machines">
                                                        <p>Nenhuma m√°quina identificada</p>
                                                        <p class="sub-text">Adicione produtos com etapas de produ√ß√£o para ver o tempo necess√°rio</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Resumo Total -->
                                    <div class="producao-totals">
                                        <div class="total-row">
                                            <span class="total-label">Materiais √önicos:</span>
                                            <span id="totalMateriaisUnicos" class="total-value">0</span>
                                        </div>
                                        <div class="total-row">
                                            <span class="total-label">Tempo Total:</span>
                                            <span id="tempoTotalProducao" class="total-value">0h 0m 0s</span>
                                        </div>
                                        <div class="total-row">
                                            <span class="total-label">M√°quinas:</span>
                                            <span id="totalMaquinasEnvolvidas" class="total-value">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Bot√£o movido para fora do formul√°rio -->
        <div class="modal-footer">
            <button type="button" id="btnSalvarOrcamento" onclick="confirmarSalvarOrcamento()" class="btn-primary">Salvar Or√ßamento</button>
        </div>
    </div>
</div>

<!-- Modal para Sele√ß√£o de Cliente -->
<div id="clienteModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <span class="close-button" onclick="fecharModalCliente()">&times;</span>
        <h2>Selecionar Cliente</h2>
        <div class="modal-body">
            <div style="margin-bottom: 20px;">
                <input type="text" id="buscarClienteModal" placeholder="Buscar cliente..." 
                       onkeyup="filtrarClientesModal(this.value)" 
                       style="width: 100%; padding: 8px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 5px; background-color: rgba(255, 255, 255, 0.1); color: white;">
            </div>
            <div id="listaClientesModal" style="max-height: 400px; overflow-y: auto; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 5px; background-color: rgba(255, 255, 255, 0.05);">
                <!-- Lista de clientes ser√° carregada aqui -->
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button type="button" onclick="abrirModalNovoCliente()" class="btn-secondary" style="margin-right: 10px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <line x1="19" y1="8" x2="19" y2="14"/>
                        <line x1="22" y1="11" x2="16" y2="11"/>
                    </svg>
                    Novo Cliente
                </button>
                <button type="button" onclick="fecharModalCliente()" class="btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Novo Cliente -->
<div id="novoClienteModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 700px;">
        <span class="close-button" onclick="fecharModalNovoCliente()">&times;</span>
        <h2>Novo Cliente</h2>
        <div class="modal-body">
            <form id="novoClienteForm" onsubmit="salvarNovoCliente(event)">
                <div class="modal-layout">
                    <div class="modal-form">
                        <div class="form-group">
                            <label for="novoClienteNome">Nome: *</label>
                            <input type="text" id="novoClienteNome" name="nome" required 
                                   style="width: calc(100% - 18px); padding: 8px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 4px; background-color: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                        <div class="form-group">
                            <label for="novoClienteEmail">Email: *</label>
                            <input type="email" id="novoClienteEmail" name="email" required 
                                   style="width: calc(100% - 18px); padding: 8px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 4px; background-color: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                        <div class="form-group">
                            <label for="novoClienteTelefone">Telefone:</label>
                            <input type="tel" id="novoClienteTelefone" name="telefone" 
                                   style="width: calc(100% - 18px); padding: 8px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 4px; background-color: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                        <div class="form-group">
                            <label for="novoClienteWhatsapp">WhatsApp:</label>
                            <input type="tel" id="novoClienteWhatsapp" name="whatsapp" 
                                   style="width: calc(100% - 18px); padding: 8px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 4px; background-color: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                        <div class="form-group">
                            <label for="novoClienteCpfCnpj">CPF/CNPJ:</label>
                            <input type="text" id="novoClienteCpfCnpj" name="cpf_cnpj" oninput="formatarCpfCnpj(this)"
                                   style="width: calc(100% - 18px); padding: 8px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 4px; background-color: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                    </div>
                    <div class="modal-profile">
                        <div class="form-group">
                            <label for="novoClienteCep">CEP:</label>
                            <input type="text" id="novoClienteCep" name="cep" oninput="formatarCep(this)" onblur="buscarEnderecoPorCep(this.value)"
                                   style="width: calc(100% - 18px); padding: 8px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 4px; background-color: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                        <div class="form-group">
                            <label for="novoClienteEndereco">Endere√ßo:</label>
                            <input type="text" id="novoClienteEndereco" name="endereco" 
                                   style="width: calc(100% - 18px); padding: 8px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 4px; background-color: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                        <div class="form-group">
                            <label for="novoClienteBairro">Bairro:</label>
                            <input type="text" id="novoClienteBairro" name="bairro" 
                                   style="width: calc(100% - 18px); padding: 8px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 4px; background-color: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                        <div class="form-group">
                            <label for="novoClienteCidade">Cidade:</label>
                            <input type="text" id="novoClienteCidade" name="cidade" 
                                   style="width: calc(100% - 18px); padding: 8px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 4px; background-color: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                        <div class="form-group">
                            <label for="novoClienteEstado">Estado:</label>
                            <input type="text" id="novoClienteEstado" name="estado" 
                                   style="width: calc(100% - 18px); padding: 8px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 4px; background-color: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                    </div>
                </div>
                <div style="margin-top: 20px; text-align: center; display: flex; gap: 10px; justify-content: center;">
                    <button type="submit" class="btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                            <polyline points="17,21 17,13 7,13 7,21"/>
                            <polyline points="7,3 7,8 15,8"/>
                        </svg>
                        Salvar Cliente
                    </button>
                    <button type="button" onclick="fecharModalNovoCliente()" class="btn-secondary">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para Sele√ß√£o de Produtos -->
<div id="produtosModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 900px;">
        <span class="close-button" onclick="fecharModalProdutos()">&times;</span>
        <h2>Selecionar Produtos e Kits</h2>
        <div class="modal-body">
            <!-- Controles de filtro e busca -->
            <div style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center;">
                <input type="text" id="buscarProduto" placeholder="Buscar produto ou kit..." 
                       onkeyup="filtrarItens(this.value)" 
                       style="flex: 1; padding: 8px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 5px; background-color: rgba(255, 255, 255, 0.1); color: white;">
                
                <!-- Abas para alternar entre produtos e kits -->
                <div style="display: flex; gap: 5px;">
                    <button id="btnTodosProdutos" onclick="mostrarTodosProdutos()" 
                            style="padding: 6px 12px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 5px; background-color: rgba(155, 100, 227, 0.2); color: white; cursor: pointer;">
                        Todos
                    </button>
                    <button id="btnApenasProdutos" onclick="mostrarApenasProdutos()" 
                            style="padding: 6px 12px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 5px; background-color: rgba(255, 255, 255, 0.1); color: white; cursor: pointer;">
                        Produtos
                    </button>
                    <button id="btnApenasKits" onclick="mostrarApenasKits()" 
                            style="padding: 6px 12px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 5px; background-color: rgba(255, 255, 255, 0.1); color: white; cursor: pointer;">
                        Kits
                    </button>
                </div>
            </div>
            
            <!-- Lista combinada de produtos e kits -->
            <div id="listaProdutos" style="max-height: 450px; overflow-y: auto; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 5px; background-color: rgba(255, 255, 255, 0.05);">
                <!-- Lista de produtos e kits ser√° carregada aqui -->
            </div>
        </div>
    </div>
</div>

<!-- Modal para Sele√ß√£o de Vendedores -->
<div id="vendedoresModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <span class="close-button" onclick="fecharModalVendedores()">&times;</span>
        <h2>Selecionar Vendedor</h2>
        <div class="modal-body">
            <div style="margin-bottom: 20px;">
                <input type="text" id="buscarVendedor" placeholder="Buscar vendedor..." 
                       onkeyup="filtrarVendedores(this.value)"
                       style="width: 100%; padding: 8px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 5px; background-color: rgba(255, 255, 255, 0.1); color: white;">
            </div>
            <div id="listaVendedores" style="max-height: 400px; overflow-y: auto; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 5px; background-color: rgba(255, 255, 255, 0.05);">
                <!‚Äî Lista de vendedores ser√° carregada aqui ‚Äî>
            </div>
        </div>
    </div>
</div>

<style>
    /* Estilos para o combobox customizado */
    .custom-select {
        color: white;
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid var(--cor-destaque, #9B64E3);
        border-radius: 5px;
        position: relative;
        z-index: 10;
    }

    .custom-select > button {
        padding: 10px;
        background: transparent;
        border: none;
        color: white;
        text-align: left;
        font-size: 0.9em;
        width: 100%;
        cursor: pointer;
        position: relative;
    }

    .custom-select > div {
        display: flex;
        flex-direction: column;
        overflow: hidden;
        height: 0;
        transition: height 0.3s ease-in-out;
        position: absolute;
        width: calc(100% - 12px);
        left: 6px;
        background-color: rgba(19, 4, 60, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 10px;
        margin-top: 5px;
        z-index: 11;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    .custom-select:hover > div,
    .custom-select:focus-within > div {
        height: auto;
        max-height: 200px;
        overflow-y: auto;
    }

    .custom-select > div > div {
        display: block;
        padding: 10px;
        color: white;
        cursor: pointer;
        text-decoration: none;
        position: relative;
        transition: background-color 0.2s ease;
    }

    .custom-select > div > div:hover,
    .custom-select > div > div:focus {
        background-color: rgba(155, 100, 227, 0.2);
        color: var(--cor-destaque, #D8CEFE);
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 10000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
    }

    .modal-content {
        background-color: rgba(59, 12, 121, 0.29);
        color: var(--sidebar-text-color, white);
        margin: 0;
        padding: 15px; /* Reduzir padding de 20px para 15px */
        border: 1px solid var(--cor-destaque, #9B64E3);
        border-radius: 10px;
        width: 90%;
        max-width: 1200px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        max-height: 90vh;
        overflow: hidden;
    }

    /* Modal espec√≠fico para or√ßamentos */
    .orcamento-modal-content {
        max-width: 1300px;
        width: 95%;
        height: 92vh;
        max-height: 92vh;
        top: 52%;
        overflow: hidden;
        display: flex;
        flex-direction: column; /* Layout flexbox vertical */
    }

    .orcamento-modal-content h2 {
        flex-shrink: 0; /* N√£o permite que o t√≠tulo encolha */
        margin: 0 0 10px 0; /* Reduzir margem inferior */
        padding: 10px 20px 0 20px; /* Padding controlado */
    }

    .orcamento-modal-content .modal-body {
        padding: 12px;
        flex: 1; /* Ocupa todo o espa√ßo dispon√≠vel menos o que o footer precisa */
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-height: 0; /* Permite que o flex funcione corretamente */
    }

    /* Footer do modal para o bot√£o */
    .modal-footer {
        padding: 8px 20px; /* Reduzir padding vertical de 15px para 8px */
        border-top: 1px solid rgba(155, 100, 227, 0.3);
        background-color: transparent;
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        flex-shrink: 0; /* N√£o permite que o footer encolha */
        border-radius: 0 0 10px 10px;
        margin-top: auto; /* Empurra o footer para o fundo */
    }

    /* Layout horizontal com 2 colunas */
    .orcamento-layout {
        display: flex;
        gap: 18px;
        height: 100%;
        min-height: 0;
        overflow: hidden; /* Manter para controle geral, mas tabs-content ter√£o scroll pr√≥prio */
    }

    .orcamento-left-column {
        flex: 0 0 220px;
        display: flex;
        flex-direction: column;
        gap: 4px;
        overflow: hidden;
        padding-right: 6px;
        max-height: 100%;
        max-width: 220px;
        min-width: 220px;
    }

    .orcamento-right-column {
        flex: 1;
        min-width: 0;
        display: flex;
        flex-direction: column;
        height: 100%;
        max-height: 100%;
        overflow: hidden;
    }

    /* Sistema de Abas - baseado no produtos.html */
    .tabs-container {
        height: 100%;
        display: flex;
        flex-direction: column;
        border: 1px solid var(--cor-destaque, #9B64E3);
        border-radius: 8px;
        background-color: rgba(255, 255, 255, 0.02);
        overflow: hidden; /* Manter para o container geral */
    }

    .tabs-header {
        display: flex;
        background-color: rgba(155, 100, 227, 0.1);
        border-bottom: 2px solid var(--cor-destaque, #9B64E3);
        flex-shrink: 0;
    }

    .tab-button {
        flex: 1;
        padding: 10px 15px;
        background: transparent;
        border: none;
        color: rgba(255, 255, 255, 0.7);
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.85em;
        font-weight: 500;
        transition: all 0.3s ease;
        position: relative;
        border-right: 1px solid rgba(155, 100, 227, 0.3);
    }

    .tab-button:last-child {
        border-right: none;
    }

    .tab-button:hover {
        background-color: rgba(155, 100, 227, 0.1);
        color: white;
    }

    .tab-button.active {
        background-color: rgba(155, 100, 227, 0.2);
        color: var(--cor-destaque, #D8CEFE);
        font-weight: 600;
    }

    .tab-button.active::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--cor-destaque, #9B64E3), #D8CEFE);
        animation: tabSlideIn 0.3s ease;
    }

    @keyframes tabSlideIn {
        from { transform: scaleX(0); }
        to { transform: scaleX(1); }
    }

    .tab-button svg {
        transition: transform 0.3s ease;
    }

    .tab-button:hover svg {
        transform: scale(1.1);
    }

    .tab-button.active svg {
        transform: scale(1.1);
        filter: drop-shadow(0 0 3px rgba(155, 100, 227, 0.5));
    }

    .tab-content {
        flex: 1;
        padding: 10px; /* Reduzir padding de 15px para 10px */
        display: none;
        flex-direction: column;
        overflow-y: auto;
        overflow-x: hidden;
        animation: fadeIn 0.3s ease;
        align-items: flex-start; /* Alinha itens ao in√≠cio */
        position: relative; /* Garante contexto de posicionamento pr√≥prio */
        height: 100%;
        min-height: 0; /* Importante para flex funcionar */
    }

    .tab-content.active {
        display: flex !important;
        max-height: calc(100vh - 280px); /* Altura m√°xima considerando footer e headers */
        height: calc(100vh - 280px); /* Altura fixa para respeitar o footer */
        overflow-y: auto; /* Garantir scroll quando necess√°rio */
    }

    /* Configura√ß√£o espec√≠fica para a aba de produ√ß√£o - centralizar */
    #producao-tab {
        align-items: stretch; /* Para ocupar toda a largura dispon√≠vel */
        justify-content: flex-start; /* Alinhamento vertical do in√≠cio */
        overflow-y: auto; /* Permitir scroll se necess√°rio */
        overflow-x: hidden; /* Evitar scroll horizontal */
    }

    #producao-tab.active {
        height: calc(100vh - 280px); /* Altura espec√≠fica respeitando o footer */
        max-height: calc(100vh - 280px);
    }

    /* Espec√≠fico para a aba de itens - configura√ß√£o flexbox correta */
    #itens-tab {
        display: flex;
        flex-direction: column; /* Layout vertical */
        align-items: stretch; /* Para ocupar a largura */
        gap: 0; /* Sem espa√ßamento entre elementos */
    }

    #itens-tab.active {
        height: calc(100vh - 280px); /* Altura espec√≠fica respeitando o footer */
        max-height: calc(100vh - 280px);
        overflow-y: auto; /* Permitir scroll se necess√°rio */
        justify-content: flex-start; /* Alinha elementos no topo */
        padding: 8px; /* Padding normal novamente */
        overflow-x: hidden; /* Evita scroll horizontal */
    }
    
    /* Garante que abas n√£o ativas sejam completamente invis√≠veis */
    #itens-tab:not(.active) {
        display: none !important;
        visibility: hidden;
        opacity: 0;
        height: 0;
        overflow: hidden;
        position: absolute;
        left: -9999px;
    }
    
    #resumo-tab:not(.active) {
        display: none !important;
        visibility: hidden;
        opacity: 0;
        height: 0;
        overflow: hidden;
        position: absolute;
        left: -9999px;
    }
    
    /* Garante que abas ativas sejam completamente vis√≠veis */
    #itens-tab.active {
        display: flex !important;
        visibility: visible !important;
        opacity: 1 !important;
        height: 100% !important;
        position: relative !important;
        left: auto !important;
    }
    
    #resumo-tab.active {
        display: flex !important;
        visibility: visible !important;
        opacity: 1 !important;
        height: 100% !important;
        position: relative !important;
        left: auto !important;
    }

    #itens-tab .itens-table-container {
        flex: 1 1 0; /* Cresce, encolhe e tem base 0 para c√°lculo flex√≠vel */
        align-self: stretch; /* Ocupa toda a largura */
        width: 100%; /* Garante largura total */
        overflow-y: auto; /* Scroll quando necess√°rio */
        overflow-x: hidden;
        display: block;
        max-height: 45vh; /* Altura m√°xima reduzida para garantir espa√ßo para totais */
        margin: 0;
        padding: 0;
        min-height: 100px; /* Altura m√≠nima para garantir visibilidade m√≠nima */
    }

    /* Garante que o totais-container tamb√©m n√£o se estique */
    .totais-container {
        flex-shrink: 0; /* N√£o encolhe */
        margin-top: 10px; /* Pequeno espa√ßamento do container da tabela */
        width: 100%; /* Ocupa toda a largura */
        background-color: rgba(59, 12, 121, 0.2); /* Destaque visual */
        padding: 8px 12px; /* Padding reduzido para economizar espa√ßo */
        border-radius: 8px;
        border-top: 2px solid var(--cor-destaque, #9B64E3);
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Estilos espec√≠ficos para a aba de itens */
    .itens-actions {
        display: flex;
        gap: 10px;
        margin-bottom: 8px; /* Reduzido de 12px para 8px */
        align-items: center;
    }

    .item-search {
        flex: 1;
        position: relative;
    }

    .item-search input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid var(--cor-destaque, #9B64E3);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 13px;
    }

    .btn-add-produtos {
        padding: 8px 15px;
        background-color: rgba(155, 100, 227, 0.1);
        border: 1px solid var(--cor-destaque, #9B64E3);
        color: white;
        border-radius: 5px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 500;
        transition: all 0.3s ease;
        white-space: nowrap;
    }

    .btn-add-produtos:hover {
        background-color: rgba(155, 100, 227, 0.2);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(155, 100, 227, 0.3);
    }

    .itens-table-container {
        max-height: 200px;
        min-height: 120px;
        overflow-y: auto;
        border: 1px solid var(--cor-destaque, #9B64E3);
        border-radius: 8px;
        background-color: rgba(255, 255, 255, 0.02);
        margin-bottom: 10px;
    }

    .itens-table {
        width: 100%;
        border-collapse: collapse;
    }

    .itens-table th,
    .itens-table td {
        padding: 8px 6px;
        text-align: left;
        border-bottom: 1px solid rgba(155, 100, 227, 0.2);
        color: white;
        font-size: 13px;
        white-space: nowrap; /* Evitar quebra de linha nos valores */
    }

    .itens-table th {
        background-color: rgba(155, 100, 227, 0.1);
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .itens-table tbody tr:hover {
        background-color: rgba(155, 100, 227, 0.05);
    }

    /* Garante que as linhas da tabela tenham altura natural */
    .itens-table tbody tr {
        height: auto;
    }

    .itens-table tbody {
        height: auto;
    }

    .totais-container {
        background-color: rgba(155, 100, 227, 0.1);
        border: 1px solid var(--cor-destaque, #9B64E3);
        border-radius: 8px;
        padding: 8px 12px; /* Padding padronizado */
        margin-top: 8px;
    }

    .total-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 6px;
        font-size: 13px;
    }

    .total-row:last-child {
        margin-bottom: 0;
        padding-top: 6px;
        border-top: 1px solid rgba(155, 100, 227, 0.3);
        font-weight: 600;
        font-size: 14px;
    }

    .total-label {
        color: rgba(255, 255, 255, 0.8);
        font-weight: 500;
    }

    .total-value {
        color: var(--cor-destaque, #D8CEFE);
        font-weight: 600;
    }

    /* Estilos espec√≠ficos para a aba de resumo/descritivo */
    #resumo-tab {
        display: flex !important;
        flex-direction: column;
        align-items: stretch;
        padding: 0; /* Remover padding aqui pois ser√° aplicado no container interno */
        overflow: hidden; /* Container pai sem scroll */
        min-height: 0; /* Importante para flex funcionar */
    }

    #resumo-tab.active {
        height: calc(100vh - 280px); /* Altura espec√≠fica respeitando o footer */
        max-height: calc(100vh - 280px);
    }
    
    .resumo-container {
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
        padding: 10px;
    }

    .resumo-container h4 {
        color: var(--cor-destaque, #D8CEFE);
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid rgba(155, 100, 227, 0.3);
        font-size: 18px;
        font-weight: 600;
    }

    .resumo-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        margin-bottom: 10px;
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(155, 100, 227, 0.2);
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .resumo-item:hover {
        background-color: rgba(155, 100, 227, 0.1);
        border-color: var(--cor-destaque, #9B64E3);
    }

    .resumo-label {
        color: rgba(255, 255, 255, 0.8);
        font-weight: 500;
        font-size: 14px;
    }

    .resumo-value {
        color: var(--cor-destaque, #D8CEFE);
        font-weight: 600;
        font-size: 15px;
    }

    .resumo-lista-itens {
        margin-top: 25px;
    }

    .resumo-lista-itens h5 {
        color: var(--cor-destaque, #D8CEFE);
        margin-bottom: 15px;
        padding-bottom: 8px;
        border-bottom: 1px solid rgba(155, 100, 227, 0.3);
        font-size: 16px;
        font-weight: 600;
    }

    .resumo-itens {
        max-height: 200px;
        min-height: 100px;
        overflow-y: auto;
    }

    .resumo-item-detail {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 12px;
        margin-bottom: 8px;
        background-color: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(155, 100, 227, 0.15);
        border-radius: 6px;
        transition: all 0.3s ease;
    }

    .resumo-item-detail:hover {
        background-color: rgba(155, 100, 227, 0.08);
        border-color: rgba(155, 100, 227, 0.3);
    }

    /* Estilos espec√≠ficos para a aba descritivo */
    .descritivo-container {
        height: 100%;
        max-height: 100%; /* Respeitar a altura da aba pai */
        display: flex;
        flex-direction: column;
        padding: 15px;
        overflow: hidden;
        min-height: 0; /* Importante para flex funcionar */
    }

    .descritivo-header {
        flex-shrink: 0;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid rgba(155, 100, 227, 0.3);
    }

    .descritivo-header-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .descritivo-header h4 {
        color: var(--cor-destaque, #D8CEFE);
        margin: 0;
        font-size: 20px;
        font-weight: 600;
    }

    .btn-imprimir-descritivo {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 16px;
        background: linear-gradient(135deg, rgba(155, 100, 227, 0.8), rgba(155, 100, 227, 0.9));
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(155, 100, 227, 0.3);
    }

    .btn-imprimir-descritivo:hover {
        background: linear-gradient(135deg, rgba(155, 100, 227, 0.9), rgba(155, 100, 227, 1));
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(155, 100, 227, 0.4);
    }

    .btn-imprimir-descritivo:active {
        transform: translateY(0);
        box-shadow: 0 2px 6px rgba(155, 100, 227, 0.3);
    }

    .btn-imprimir-descritivo img {
        width: 18px;
        height: 18px;
        filter: brightness(0) invert(1);
    }

    .btn-imprimir-descritivo span {
        white-space: nowrap;
    }

    /* Responsividade para telas menores */
    @media (max-width: 768px) {
        .descritivo-header-top {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }

        .btn-imprimir-descritivo {
            align-self: stretch;
            justify-content: center;
        }
    }

    @media (max-width: 480px) {
        .btn-imprimir-descritivo span {
            display: none;
        }

        .btn-imprimir-descritivo {
            width: auto;
            padding: 10px;
            align-self: flex-end;
        }
    }

    .descritivo-totais {
        display: flex;
        gap: 30px;
        align-items: center;
    }

    .descritivo-totais span {
        color: rgba(255, 255, 255, 0.8);
        font-size: 14px;
    }

    .descritivo-totais strong {
        color: var(--cor-destaque, #D8CEFE);
        font-weight: 600;
    }

    .descritivo-produtos {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        padding-right: 5px;
        min-height: 0; /* Importante para flex containers com scroll */
        max-height: calc(100vh - 320px); /* Altura fixa que respeita o footer */
        height: calc(100vh - 320px); /* Altura espec√≠fica para evitar sobreposi√ß√£o */
        display: flex;
        flex-direction: column;
        border-right: 1px solid rgba(155, 100, 227, 0.1);
        margin-right: 5px;
    }

    .produtos-descritivos {
        display: flex;
        flex-direction: column;
        gap: 15px;
        min-height: 0; /* Importante para scroll funcionar */
        height: auto; /* Altura autom√°tica para se expandir */
        padding-bottom: 80px; /* Espa√ßamento extra aumentado para garantir que o √∫ltimo item n√£o seja sobreposto */
    }

    .produto-descritivo {
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(155, 100, 227, 0.2);
        border-radius: 8px;
        padding: 12px 15px;
        transition: all 0.3s ease;
        min-height: auto;
    }

    .produto-descritivo:hover {
        background-color: rgba(155, 100, 227, 0.1);
        border-color: var(--cor-destaque, #9B64E3);
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(155, 100, 227, 0.15);
    }

    .produto-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
        border-bottom: 1px solid rgba(155, 100, 227, 0.2);
        padding-bottom: 6px;
    }

    .produto-nome {
        color: var(--cor-destaque, #D8CEFE);
        font-size: 15px;
        font-weight: 600;
        margin: 0;
        line-height: 1.3;
    }

    .produto-valor {
        color: #4CAF50;
        font-size: 15px;
        font-weight: 700;
        text-align: right;
        line-height: 1.3;
    }

    .produto-quantidade {
        color: rgba(255, 255, 255, 0.7);
        font-size: 11px;
        margin-top: 2px;
        line-height: 1.2;
    }

    .produto-descricao {
        color: rgba(255, 255, 255, 0.9);
        line-height: 1.4;
        margin-bottom: 8px;
        font-size: 13px;
    }

    .produto-detalhes {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 6px;
        margin-top: 6px;
    }

    .detalhe-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px 8px;
        background-color: rgba(255, 255, 255, 0.03);
        border-radius: 4px;
        border: 1px solid rgba(155, 100, 227, 0.1);
        min-height: 28px;
    }

    .detalhe-label {
        color: rgba(255, 255, 255, 0.7);
        font-size: 11px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.3px;
    }

    .detalhe-valor {
        color: white;
        font-weight: 600;
        font-size: 12px;
    }

    .no-products {
        text-align: center;
        padding: 60px 20px;
        color: rgba(255, 255, 255, 0.6);
    }

    .no-products p {
        margin: 0 0 10px 0;
        font-size: 16px;
    }

    /* Scrollbar customizada para a aba descritivo */
    .descritivo-produtos::-webkit-scrollbar {
        width: 10px; /* Scrollbar mais vis√≠vel */
    }

    .descritivo-produtos::-webkit-scrollbar-track {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 5px;
    }

    .descritivo-produtos::-webkit-scrollbar-thumb {
        background-color: var(--cor-destaque, #9B64E3);
        border-radius: 5px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .descritivo-produtos::-webkit-scrollbar-thumb:hover {
        background-color: var(--cor-destaque-hover, #B883E8);
    }

    /* Firefox scrollbar */
    .descritivo-produtos {
        scrollbar-width: thin;
        scrollbar-color: var(--cor-destaque, #9B64E3) rgba(255, 255, 255, 0.1);
    }

    .no-products .sub-text {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.4);
    }

    /* Estilos para a aba de produ√ß√£o */
    .producao-container {
        width: 100%;
        height: auto; /* Altura autom√°tica para permitir scroll natural */
        min-height: 100%; /* Altura m√≠nima para ocupar o espa√ßo dispon√≠vel */
        display: flex;
        flex-direction: column;
        padding: 5px; /* Reduzir padding de 10px para 5px */
        gap: 8px; /* Reduzir gap de 10px para 8px */
        box-sizing: border-box; /* Inclui padding na largura total */
    }

    .producao-header {
        flex-shrink: 0;
        margin-bottom: 0;
        padding-bottom: 10px;
        border-bottom: 2px solid rgba(155, 100, 227, 0.3);
    }

    .producao-header h4 {
        color: var(--cor-destaque, #D8CEFE);
        margin: 0 0 5px 0;
        font-size: 20px;
        font-weight: 600;
    }

    .producao-subtitle {
        color: rgba(255, 255, 255, 0.7);
        font-size: 14px;
        font-style: italic;
    }

    .producao-content {
        width: 100%;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        flex: 1;
        overflow: hidden;
        min-height: 0; /* Importante para permitir que o flex funcione corretamente */
        box-sizing: border-box; /* Inclui padding na largura total */
    }

    .producao-section {
        width: 100%;
        display: flex;
        flex-direction: column;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 8px;
        padding: 12px;
        border: 1px solid rgba(155, 100, 227, 0.2);
        overflow: hidden;
        min-height: 0; /* Importante para permitir que o flex funcione corretamente */
        box-sizing: border-box; /* Inclui padding na largura total */
    }

    .section-header {
        flex-shrink: 0;
        margin-bottom: 8px;
        padding-bottom: 6px;
        border-bottom: 1px solid rgba(155, 100, 227, 0.2);
    }

    .section-header h5 {
        color: var(--cor-destaque, #D8CEFE);
        margin: 0;
        font-size: 14px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .section-header svg {
        color: var(--cor-destaque, #9B64E3);
        width: 14px;
        height: 14px;
    }

    .materiais-lista, .maquinas-lista {
        width: 100%;
        flex: 1;
        overflow-y: auto;
        border-radius: 6px;
        background: rgba(255, 255, 255, 0.02);
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
        padding: 12px;
        min-height: 0; /* Importante para permitir que o flex funcione corretamente */
        box-sizing: border-box; /* Inclui padding na largura total */
    }

    .material-item, .maquina-item {
        display: flex;
        flex-direction: column;
        padding: 15px;
        border: 1px solid rgba(155, 100, 227, 0.15);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.03);
        transition: all 0.2s ease;
        gap: 8px;
        min-height: 120px;
        max-height: 120px;
        position: relative;
        overflow: hidden;
        cursor: pointer;
    }

    .material-item:last-child, .maquina-item:last-child {
        border-bottom: 1px solid rgba(155, 100, 227, 0.15);
    }

    .material-item:hover, .maquina-item:hover {
        background-color: rgba(155, 100, 227, 0.08);
        border-color: rgba(155, 100, 227, 0.3);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(155, 100, 227, 0.15);
    }

    .material-info, .maquina-info {
        display: flex;
        flex-direction: column;
        gap: 4px;
        flex: 1;
    }

    .material-nome, .maquina-nome {
        color: white;
        font-weight: 600;
        font-size: 15px;
        margin-bottom: 2px;
        line-height: 1.2;
    }

    .material-total, .maquina-tipo, .maquina-tempo-total {
        color: rgba(255, 255, 255, 0.8);
        font-size: 13px;
        margin-bottom: 4px;
        line-height: 1.3;
    }

    .click-indicator {
        position: absolute;
        bottom: 8px;
        right: 8px;
        color: var(--cor-destaque, #9B64E3);
        font-size: 10px;
        opacity: 0.7;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .click-indicator svg {
        width: 12px;
        height: 12px;
    }

    /* Modal de detalhes de material/m√°quina */
    .detalhes-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
        z-index: 10001;
        justify-content: center;
        align-items: center;
    }

    .detalhes-modal-content {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        border-radius: 12px;
        border: 2px solid rgba(155, 100, 227, 0.3);
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    .detalhes-modal-header {
        padding: 20px;
        border-bottom: 1px solid rgba(155, 100, 227, 0.3);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .detalhes-modal-title {
        color: white;
        font-size: 18px;
        font-weight: 600;
        margin: 0;
    }

    .detalhes-modal-subtitle {
        color: rgba(255, 255, 255, 0.7);
        font-size: 14px;
        margin: 5px 0 0 0;
    }

    .detalhes-modal-close {
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.7);
        font-size: 24px;
        cursor: pointer;
        padding: 5px;
        border-radius: 50%;
        transition: all 0.2s ease;
    }

    .detalhes-modal-close:hover {
        color: white;
        background-color: rgba(155, 100, 227, 0.2);
    }

    .detalhes-modal-body {
        padding: 20px;
        overflow-y: auto;
        flex: 1;
    }

    .detalhes-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .detalhes-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        background-color: rgba(255, 255, 255, 0.04);
        border-radius: 6px;
        border-left: 3px solid rgba(155, 100, 227, 0.4);
        transition: all 0.2s ease;
    }

    .detalhes-item:hover {
        background-color: rgba(155, 100, 227, 0.08);
        border-left-color: rgba(155, 100, 227, 0.6);
    }

    .detalhes-item-nome {
        color: white;
        font-size: 14px;
        font-weight: 500;
        flex: 1;
    }

    .detalhes-item-valor {
        color: var(--cor-destaque, #D8CEFE);
        font-size: 13px;
        font-weight: 600;
    }

    .produto-usage-item, .etapa-usage-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 10px;
        background-color: rgba(255, 255, 255, 0.04);
        border-radius: 4px;
        border-left: 2px solid rgba(155, 100, 227, 0.4);
        font-size: 12px;
        min-height: 28px;
    }

    .produto-nome, .etapa-nome {
        color: white;
        font-size: 12px;
        flex: 1;
        font-weight: 500;
        line-height: 1.3;
    }

    .produto-quantidade, .etapa-tempo {
        color: var(--cor-destaque, #D8CEFE);
        font-size: 11px;
        font-weight: 600;
    }

    .etapa-produto {
        color: rgba(255, 255, 255, 0.6);
        font-size: 10px;
        margin-right: 6px;
    }

    .no-materials, .no-machines {
        grid-column: 1 / -1;
        text-align: center;
        padding: 40px 20px;
        color: rgba(255, 255, 255, 0.5);
        border: 2px dashed rgba(155, 100, 227, 0.2);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.01);
    }

    .no-materials p, .no-machines p {
        margin: 5px 0;
        font-size: 14px;
    }

    .no-materials .sub-text, .no-machines .sub-text {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.4);
        font-style: italic;
    }

    .producao-totals {
        width: 100%;
        flex-shrink: 0;
        margin-top: 10px; /* Reduzir de 15px para 10px */
        margin-bottom: 5px; /* Reduzir de 10px para 5px */
        padding: 12px;
        border-top: 2px solid rgba(155, 100, 227, 0.3);
        background: rgba(155, 100, 227, 0.05);
        border-radius: 8px;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        box-sizing: border-box; /* Inclui padding na largura total */
    }

    .producao-totals .total-row {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 8px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 6px;
        border: 1px solid rgba(155, 100, 227, 0.15);
        transition: all 0.2s ease;
        min-height: 60px; /* Altura m√≠nima fixa para todos os cards */
        height: 60px; /* Altura fixa para consist√™ncia */
    }

    .producao-totals .total-row:hover {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(155, 100, 227, 0.3);
        transform: translateY(-1px);
    }

    .producao-totals .total-label {
        color: rgba(255, 255, 255, 0.8);
        font-size: 10px;
        margin-bottom: 6px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        line-height: 1.2;
        min-height: 24px; /* Altura m√≠nima para acomodar quebras de linha */
        display: flex;
        align-items: center;
        justify-content: center;
        word-wrap: break-word;
        hyphens: auto;
    }

    .producao-totals .total-value {
        color: var(--cor-destaque, #D8CEFE);
        font-weight: 700;
        font-size: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 20px; /* Altura m√≠nima para consist√™ncia */
    }

    /* Scrollbar personalizada para listas de produ√ß√£o */
    .materiais-lista::-webkit-scrollbar, .maquinas-lista::-webkit-scrollbar {
        width: 6px;
    }

    .materiais-lista::-webkit-scrollbar-track, .maquinas-lista::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
    }

    .materiais-lista::-webkit-scrollbar-thumb, .maquinas-lista::-webkit-scrollbar-thumb {
        background-color: var(--cor-destaque, #9B64E3);
        border-radius: 3px;
        transition: background-color 0.3s ease;
    }

    .materiais-lista::-webkit-scrollbar-thumb:hover, .maquinas-lista::-webkit-scrollbar-thumb:hover {
        background-color: var(--cor-destaque-hover, #B883E8);
    }

    .item-nome {
        flex: 1;
        color: white;
        font-weight: 500;
        font-size: 14px;
    }

    .item-qtd {
        color: rgba(255, 255, 255, 0.7);
        font-size: 13px;
        margin: 0 15px;
    }

    .item-total {
        color: var(--cor-destaque, #D8CEFE);
        font-weight: 600;
        font-size: 14px;
    }

    .no-items {
        text-align: center;
        color: rgba(255, 255, 255, 0.5);
        font-style: italic;
        padding: 40px;
        margin: 0;
    }

    /* Bot√µes de a√ß√£o no final do formul√°rio - mantido para compatibilidade */
    .form-actions {
        margin-top: 20px;
        padding: 15px 20px;
        border-top: 1px solid rgba(155, 100, 227, 0.3);
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        background-color: rgba(59, 12, 121, 0.2);
        border-radius: 8px;
        flex-shrink: 0;
    }

    .btn-primary {
        padding: 12px 25px;
        background: linear-gradient(135deg, var(--cor-destaque, #9B64E3), #D8CEFE);
        border: none;
        color: white;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(155, 100, 227, 0.3);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(155, 100, 227, 0.4);
    }

    .btn-primary:active {
        transform: translateY(0);
    }

    /* Responsividade */
    @media (max-width: 1200px) {
        .orcamento-layout {
            flex-direction: column;
            gap: 12px;
        }

        .orcamento-left-column {
            flex: none;
            width: 100%;
            max-width: none;
            min-width: auto;
        }

        .orcamento-right-column {
            flex: none;
            width: 100%;
            min-height: 350px;
        }

        .orcamento-modal-content {
            width: 95%;
            height: 75vh;
        }

        /* Layout de produ√ß√£o em telas menores */
        .producao-content {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .producao-totals {
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .producao-totals .total-label {
            font-size: 9px;
        }

        .producao-totals .total-value {
            font-size: 12px;
        }
    }

    /* Ajustes espec√≠ficos quando carregado dinamicamente no dashboard */
    body.sidebar-active .orcamento-modal-content {
        top: 50%;
        max-height: 85vh;
        height: 85vh;
    }

    /* Para telas menores quando no dashboard */
    @media (max-height: 800px) {
        .orcamento-modal-content {
            height: 80vh;
            max-height: 80vh;
            top: 50%;
        }
        
        body.sidebar-active .orcamento-modal-content {
            height: 75vh;
            max-height: 75vh;
        }

        /* Ajustar layout de produ√ß√£o em altura reduzida */
        .producao-header h4 {
            font-size: 18px;
        }

        .producao-subtitle {
            font-size: 12px;
        }
    }

    /* Para modais muito pequenos */
    @media (max-width: 900px) {
        .producao-content {
            grid-template-columns: 1fr;
        }

        .producao-totals {
            grid-template-columns: 1fr;
            gap: 5px;
        }

        .producao-totals .total-row {
            flex-direction: row;
            justify-content: space-between;
            padding: 6px 10px;
        }

        .producao-totals .total-label {
            margin-bottom: 0;
            font-size: 10px;
        }

        .producao-totals .total-value {
            font-size: 12px;
        }
    }

    /* Ajustes adicionais quando dentro do dashboard */
    #content-container .orcamento-modal-content {
        position: fixed;
        z-index: 10001;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        margin: 0 !important;
    }

    /* Garantir que o modal n√£o ultrapasse os limites da tela */
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10000;
    }

    /* Modal de produtos com z-index mais alto */
    #produtosModal {
        z-index: 10050;
    }

    #produtosModal .modal-content {
        z-index: 10051;
    }

    /* Scrollbar customizada para containers que precisam */
    .itens-table-container::-webkit-scrollbar,
    .resumo-itens::-webkit-scrollbar {
        width: 6px;
    }

    .itens-table-container::-webkit-scrollbar-track,
    .resumo-itens::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
    }

    .itens-table-container::-webkit-scrollbar-thumb,
    .resumo-itens::-webkit-scrollbar-thumb {
        background: var(--cor-destaque, #9B64E3);
        border-radius: 3px;
    }

    .itens-table-container::-webkit-scrollbar-thumb:hover,
    .resumo-itens::-webkit-scrollbar-thumb:hover {
        background: #D8CEFE;
    }

    .modal-body {
        padding: 20px;
        max-height: 70vh;
        overflow-y: auto;
    }

    /* Cabe√ßalho do modal */
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        border-bottom: 1px solid var(--cor-destaque, #9B64E3);
        padding-bottom: 6px;
    }

    .close-button {
        color: var(--sidebar-text-color, white);
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        line-height: 1;
        padding: 0;
        background: none;
        border: none;
        position: absolute;
        top: 10px;
        right: 15px;
        z-index: 1001;
    }

    .close-button:hover,
    .close-button:focus {
        color: var(--cor-destaque, #D8CEFE);
        text-decoration: none;
    }

    /* Estilos para os modais de confirma√ß√£o e notifica√ß√£o - baseado no estoque.html */
    .notification-modal-content {
        max-width: 400px;
        text-align: center;
        padding: 30px;
    }
    .notification-modal-content .btn-primary {
        margin: 0 auto; /* Centraliza o bot√£o OK */
        display: block; /* Garante que o margin auto funcione */
    }
    .notification-modal-content h2 {
        border-bottom: none;
        margin-bottom: 15px;
        font-size: 1.5em;
    }
    .notification-modal-content p {
        margin-bottom: 20px;
        font-size: 1.1em;
    }
    .notification-modal-content .btn-primary {
        margin-top: 0;
        padding: 10px 20px;
    }
    .notification-modal-content.success h2 {
        color: #4CAF50; /* Verde para sucesso */
    }
    .notification-modal-content.error h2 {
        color: #F44336; /* Vermelho para erro */
    }
    .modal-buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 20px auto 0;
        width: 100%;
        max-width: 300px;
    }
    .modal-buttons button {
        min-width: 100px;
        transition: all 0.3s ease;
    }
    
    .modal-buttons button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
    
    .btn-secondary {
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid #ccc;
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    
    .btn-secondary:hover {
        background-color: rgba(255, 255, 255, 0.2);
    }

    /* Modal de notifica√ß√£o deve aparecer acima de todos os outros */
    #successModal,
    #errorModal,
    #confirmModal {
        z-index: 15000 !important;
    }

    #successModal .modal-content,
    #errorModal .modal-content,
    #confirmModal .modal-content {
        z-index: 15001 !important;
    }

    /* Estilos para bot√µes de a√ß√£o - baseado no estoque.html */
    .action-btn {
        position: relative;
    }
    
    .action-btn:hover {
        background-color: rgba(155, 100, 227, 0.2);
        color: var(--cor-destaque, #9B64E3);
    }
    
    .action-btn[data-tooltip]:hover::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
        white-space: nowrap;
        z-index: 10;
        margin-bottom: 5px;
    }

    .modal-content h2 {
        color: var(--sidebar-text-color, white);
        margin: 0;
        font-size: 1.3em;
    }

    .form-group {
        margin-bottom: 4px;
    }

    .form-group label {
        display: block;
        margin-bottom: 2px;
        font-weight: bold;
        color: var(--sidebar-text-color, white);
        font-size: 12px;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    input[type="datetime-local"],
    select,
    textarea {
        padding: 4px 8px;
        border: 1px solid var(--cor-destaque, #9B64E3);
        border-radius: 4px;
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 12px;
        width: 100%;
        box-sizing: border-box;
    }

    /* Espec√≠fico para select de parcelas */
    select {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23D8CEFE' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6,9 12,15 18,9'%3E%3C/polyline%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 8px center;
        background-size: 12px;
        padding-right: 30px;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
    }

    select option {
        background-color: rgba(19, 4, 60, 0.95);
        color: white;
        padding: 8px;
    }

    /* Espec√≠fico para textarea de observa√ß√µes */
    textarea {
        resize: vertical;
        min-height: 60px;
        max-height: 120px;
    }

    /* Estilos para input-group e bot√£o de busca */
    .input-group {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .input-group input {
        flex: 1;
    }

    .search-btn {
        background-color: var(--cor-destaque, #9B64E3);
        border: 1px solid var(--cor-destaque, #9B64E3);
        border-radius: 4px;
        padding: 6px 10px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 36px;
        height: 32px;
    }

    .search-btn:hover {
        background-color: var(--cor-destaque-hover, #7B4BAB);
        border-color: var(--cor-destaque-hover, #7B4BAB);
        transform: scale(1.05);
    }

    .search-btn:active {
        transform: scale(0.95);
    }

    .search-btn img {
        width: 16px;
        height: 16px;
        filter: brightness(0) invert(1);
    }

    /* Foco nos campos de entrada */
    input:focus,
    select:focus,
    textarea:focus {
        outline: none;
        border-color: var(--cor-destaque, #D8CEFE);
        box-shadow: 0 0 0 2px rgba(155, 100, 227, 0.2);
    }

    /* Elementos select customizados */
    .select.custom-select {
        position: relative;
    }

    .custom-select button {
        width: 100%;
        padding: 4px 8px;
        border: 1px solid var(--cor-destaque, #9B64E3);
        border-radius: 4px;
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 12px;
        text-align: left;
        cursor: pointer;
        box-sizing: border-box;
    }

    /* Estilos para o dropdown customizado - baseado no produtos.html */
    .dropdown.custom-select {
        position: relative;
        width: 100%;
    }

    .dropdown.custom-select > button {
        width: 100%;
        padding: 4px 8px;
        border: 1px solid var(--cor-destaque, #9B64E3);
        border-radius: 4px;
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 12px;
        text-align: left;
        cursor: pointer;
        box-sizing: border-box;
        position: relative;
        padding-right: 25px;
    }

    .dropdown.custom-select > button:after {
        content: "‚ñº";
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: #9B64E3;
        font-size: 0.8em;
        pointer-events: none;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background-color: rgba(19, 4, 60, 0.95);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        border-radius: 10px;
        z-index: 10100;
        box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        max-height: 200px;
        overflow-y: auto;
        overflow-x: hidden;
        border: 1px solid rgba(155, 100, 227, 0.3);
    }

    /* Scroll personalizado para dropdowns */
    .dropdown-content::-webkit-scrollbar {
        width: 12px;
    }

    .dropdown-content::-webkit-scrollbar-track {
        background: rgba(155, 100, 227, 0.1);
        border-radius: 4px;
        margin-right: 2px;
    }

    .dropdown-content::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #9B64E3, #D8CEFE);
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(155, 100, 227, 0.3);
        border: 2px solid transparent;
        background-clip: padding-box;
    }

    .dropdown-content::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #8A4FD3, #C7B7FE);
        box-shadow: 0 4px 8px rgba(155, 100, 227, 0.5);
        border: 2px solid transparent;
        background-clip: padding-box;
    }

    /* Firefox */
    .dropdown-content {
        scrollbar-width: thin;
        scrollbar-color: #9B64E3 rgba(155, 100, 227, 0.1);
    }

    .dropdown-content > div {
        display: block;
        padding: 10px;
        color: white;
        cursor: pointer;
        text-decoration: none;
        position: relative;
        transition: background-color 0.2s ease;
    }

    .dropdown-content > div:hover,
    .dropdown-content > div:focus {
        background-color: rgba(155, 100, 227, 0.2);
        color: var(--cor-destaque, #D8CEFE);
    }

    .dropdown:hover .dropdown-content,
    .dropdown:focus-within .dropdown-content {
        display: block;
    }

    .btn-search {
        padding: 6px 8px;
        background-color: rgba(155, 100, 227, 0.1);
        border: 1px solid var(--cor-destaque, #9B64E3);
        border-radius: 5px;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 32px;
        height: 32px;
    }

    .btn-search:hover {
        background-color: rgba(155, 100, 227, 0.2);
        transform: translateY(-1px);
    }

    .btn-primary {
        background-color: rgba(155, 100, 227, 0.1);
        border: 1px solid #9B64E3;
        color: white;
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .btn-primary:hover {
        background-color: #D8CEFE;
        color: #3B0C79;
    }

    /* CSS para lista de clientes no modal */
    .cliente-item {
        padding: 12px;
        margin: 5px 0;
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(155, 100, 227, 0.3);
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
        color: white;
    }

    .cliente-item:hover {
        background-color: rgba(155, 100, 227, 0.2);
        border-color: var(--cor-destaque, #9B64E3);
        transform: translateY(-1px);
    }

    .cliente-nome {
        font-weight: bold;
        font-size: 1.1em;
        color: var(--cor-destaque, #D8CEFE);
        margin-bottom: 5px;
    }

    .cliente-info {
        font-size: 0.9em;
        color: rgba(255, 255, 255, 0.8);
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
    }

    .cliente-info span {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .btn-secondary {
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }

    .btn-secondary:hover {
        background-color: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.5);
    }

    /* CSS para modal de novo cliente */
    .modal-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        align-items: start;
    }

    .modal-form, .modal-profile {
        display: grid;
        gap: 10px;
        width: 100%;
    }

    .modal-form {
        grid-column: 1;
    }

    .modal-profile {
        grid-column: 2;
        border-left: 1px solid rgba(155, 100, 227, 0.3);
        padding-left: 20px;
    }

    .form-group {
        display: grid;
        gap: 5px;
        margin-bottom: 10px;
    }

    .form-group label {
        font-weight: bold;
        font-size: 0.9em;
        color: var(--cor-destaque, #D8CEFE);
    }

    /* CSS espec√≠fico para modal de novo cliente - sem scroll desnecess√°rio */
    #novoClienteModal .modal-content {
        max-height: none !important;
        overflow: visible !important;
        height: auto !important;
        width: 90%;
        max-width: 700px;
    }

    #novoClienteModal .modal-body {
        overflow: visible !important;
        max-height: none !important;
        padding: 20px;
    }

    /* Layout do Modal de Or√ßamento */
    .orcamento-section {
        margin-bottom: 30px;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(155, 100, 227, 0.3);
        border-radius: 8px;
    }

    .section-title {
        color: var(--cor-destaque, #D8CEFE);
        font-size: 1.1em;
        font-weight: 600;
        margin: 0 0 15px 0;
        padding-bottom: 8px;
        border-bottom: 2px solid var(--cor-destaque, #9B64E3);
    }

    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
    }

    .form-col-1 {
        flex: 1;
    }

    .form-col-2 {
        flex: 0 0 calc(50% - 10px);
    }

    /* Se√ß√£o de Itens dentro da aba */
    .itens-actions {
        display: flex;
        gap: 15px;
        margin-bottom: 10px; /* Margem reduzida para economizar espa√ßo */
        align-items: flex-start;
        flex-shrink: 0;
        width: 100%; /* Garante largura total */
    }

    .item-search {
        flex: 1;
        position: relative;
    }

    .item-search input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--cor-destaque, #9B64E3);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
    }

    .dropdown-results {
        display: none;
        position: absolute;
        width: 100%;
        max-height: 200px;
        overflow-y: auto;
        background-color: rgba(30, 30, 30, 0.95);
        border: 1px solid var(--cor-destaque, #9B64E3);
        border-radius: 5px;
        margin-top: 4px;
        z-index: 1000;
    }

    .btn-add-produtos {
        padding: 10px 16px;
        border: 1px solid var(--cor-destaque, #9B64E3);
        border-radius: 5px;
        background-color: rgba(155, 100, 227, 0.1);
        color: white;
        cursor: pointer;
        white-space: nowrap;
        font-weight: 500;
        transition: background-color 0.3s ease;
        flex-shrink: 0;
    }

    .btn-add-produtos:hover {
        background-color: rgba(155, 100, 227, 0.2);
    }

    /* Tabela de Itens */
    .itens-table-container {
        border: 1px solid rgba(155, 100, 227, 0.3);
        border-radius: 5px;
        overflow-y: auto; /* Permite scroll vertical quando necess√°rio */
        overflow-x: hidden; /* Evita scroll horizontal */
        min-height: 0;
        height: 100%; /* Ocupa toda a altura dispon√≠vel */
        width: 100%; /* Garante largura total */
    }

    .itens-table {
        width: 100%;
        border-collapse: collapse;
        background-color: rgba(255, 255, 255, 0.02);
        height: auto; /* Altura autom√°tica baseada no conte√∫do */
    }

    .itens-table thead {
        flex-shrink: 0;
    }

    .itens-table th {
        padding: 12px 8px;
        background-color: rgba(155, 100, 227, 0.1);
        border-bottom: 2px solid var(--cor-destaque, #9B64E3);
        color: var(--cor-destaque, #D8CEFE);
        font-weight: 600;
        text-align: left;
        font-size: 0.9em;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .itens-table th:nth-child(2),
    .itens-table th:nth-child(3),
    .itens-table th:nth-child(4) {
        text-align: right;
    }

    .itens-table th:nth-child(5) {
        text-align: center;
    }

    /* Definir larguras das colunas */
    .itens-table th:nth-child(1),
    .itens-table td:nth-child(1) {
        width: 40%; /* Nome do item - mais espa√ßo */
    }

    .itens-table th:nth-child(2),
    .itens-table td:nth-child(2) {
        width: 15%; /* Quantidade */
    }

    .itens-table th:nth-child(3),
    .itens-table td:nth-child(3) {
        width: 20%; /* Pre√ßo unit√°rio */
    }

    .itens-table th:nth-child(4),
    .itens-table td:nth-child(4) {
        width: 20%; /* Total */
    }

    .itens-table th:nth-child(5),
    .itens-table td:nth-child(5) {
        width: 5%; /* A√ß√µes */
    }

    .itens-table td {
        padding: 10px 8px;
        border-bottom: 1px solid rgba(155, 100, 227, 0.2);
        color: white;
        font-size: 0.9em;
    }

    .itens-table tbody tr:hover {
        background-color: rgba(155, 100, 227, 0.05);
    }

    /* Totais */
    .totais-container {
        border-top: 2px solid var(--cor-destaque, #9B64E3);
        padding: 8px 12px; /* Padding reduzido para economizar espa√ßo */
        background-color: rgba(255, 255, 255, 0.02);
        width: 100%;
        box-sizing: border-box;
        margin-top: auto; /* Empurra para o fundo usando flexbox */
    }

    .total-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .total-row:last-child {
        margin-bottom: 0;
    }

    .total-label {
        font-weight: 600;
        color: white;
        font-size: 1em;
    }

    .total-value {
        padding: 8px 12px;
        background-color: rgba(155, 100, 227, 0.1);
        border: 1px solid var(--cor-destaque, #9B64E3);
        border-radius: 5px;
        color: var(--cor-destaque, #D8CEFE);
        font-weight: 600;
        font-size: 1em;
    }

    /* Aba Resumo */
    .resumo-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
        height: 100%;
        overflow-y: auto;
    }

    .resumo-container h4 {
        color: var(--cor-destaque, #D8CEFE);
        margin: 0 0 15px 0;
        font-size: 1.1em;
        padding-bottom: 8px;
        border-bottom: 2px solid var(--cor-destaque, #9B64E3);
    }

    .resumo-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(155, 100, 227, 0.3);
        border-radius: 5px;
    }

    .resumo-label {
        font-weight: 600;
        color: white;
    }

    .resumo-value {
        font-weight: 600;
        color: var(--cor-destaque, #D8CEFE);
    }

    .resumo-lista-itens {
        flex: 1;
        min-height: 0;
    }

    .resumo-lista-itens h5 {
        color: var(--cor-destaque, #D8CEFE);
        margin: 0 0 10px 0;
        font-size: 1em;
    }

    .resumo-itens {
        max-height: 300px;
        overflow-y: auto;
        padding: 10px;
        background-color: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(155, 100, 227, 0.3);
        border-radius: 5px;
    }

    .resumo-itens .no-items {
        text-align: center;
        color: rgba(255, 255, 255, 0.5);
        margin: 20px 0;
    }

    .resumo-item-entry {
        padding: 8px 0;
        border-bottom: 1px solid rgba(155, 100, 227, 0.2);
        color: white;
        font-size: 0.9em;
    }

    .resumo-item-entry:last-child {
        border-bottom: none;
    }

    /* A√ß√µes do Formul√°rio */
    .form-actions {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 2px solid rgba(155, 100, 227, 0.3);
        text-align: center;
    }

    .form-actions .btn-primary {
        padding: 12px 30px;
        font-size: 1em;
        font-weight: 600;
    }

    /* Scrollbar customizada para manter consist√™ncia visual */
    #itens-tab .itens-table-container::-webkit-scrollbar,
    #listaClientesModal::-webkit-scrollbar,
    #listaProdutos::-webkit-scrollbar {
        width: 8px;
    }

    #itens-tab .itens-table-container::-webkit-scrollbar-track,
    #listaClientesModal::-webkit-scrollbar-track,
    #listaProdutos::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
    }

    #itens-tab .itens-table-container::-webkit-scrollbar-thumb,
    #listaClientesModal::-webkit-scrollbar-thumb,
    #listaProdutos::-webkit-scrollbar-thumb {
        background: var(--cor-destaque, #9B64E3);
        border-radius: 4px;
        opacity: 0.7;
    }

    #itens-tab .itens-table-container::-webkit-scrollbar-thumb:hover,
    #listaClientesModal::-webkit-scrollbar-thumb:hover,
    #listaProdutos::-webkit-scrollbar-thumb:hover {
        background: rgba(155, 100, 227, 0.9);
        opacity: 1;
    }

    /* Scrollbar para Firefox */
    #itens-tab .itens-table-container,
    #listaClientesModal,
    #listaProdutos {
        scrollbar-width: thin;
        scrollbar-color: var(--cor-destaque, #9B64E3) rgba(255, 255, 255, 0.1);
    }

    /* Regra geral para scrollbars em modais para consist√™ncia total */
    .modal-content *::-webkit-scrollbar {
        width: 8px;
    }

    .modal-content *::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
    }

    .modal-content *::-webkit-scrollbar-thumb {
        background: var(--cor-destaque, #9B64E3);
        border-radius: 4px;
        opacity: 0.7;
    }

    .modal-content *::-webkit-scrollbar-thumb:hover {
        background: rgba(155, 100, 227, 0.9);
        opacity: 1;
    }

    /* Responsividade */
    @media (max-width: 768px) {
        .form-row {
            flex-direction: column;
            gap: 0;
        }
        
        .form-col-2 {
            flex: 1;
        }
        
        .itens-actions {
            flex-direction: column;
            gap: 10px;
        }
        
        .modal-content {
            width: 95%;
            margin: 10px auto;
        }
        
        .orcamento-section {
            padding: 15px;
        }
        
        /* Estilos para dropdowns desabilitados no modal de visualiza√ß√£o */
        .dropdown.disabled {
            pointer-events: none;
            cursor: default !important;
        }
        
        .dropdown.disabled button {
            cursor: default !important;
            opacity: 0.7 !important;
            background: rgba(255, 255, 255, 0.05) !important;
            color: #ccc !important;
        }
        
        .dropdown.disabled button:hover {
            background: rgba(255, 255, 255, 0.05) !important;
            transform: none !important;
        }
        
        .dropdown.disabled .dropdown-content {
            display: none !important;
        }
        
        /* Fazer as abas do modal de visualiza√ß√£o herdarem as mesmas regras das abas originais */
        #visualizar-itens-tab {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            height: 100%;
            gap: 0;
            justify-content: flex-start;
            padding: 8px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        #visualizar-resumo-tab {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            height: 100%;
            gap: 0;
            justify-content: flex-start;
            padding: 8px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        #visualizar-itens-tab:not(.active) {
            display: none !important;
            visibility: hidden;
            opacity: 0;
            height: 0;
            overflow: hidden;
            position: absolute;
            left: -9999px;
        }
        
        #visualizar-resumo-tab:not(.active) {
            display: none !important;
            visibility: hidden;
            opacity: 0;
            height: 0;
            overflow: hidden;
            position: absolute;
            left: -9999px;
        }
        
        #visualizar-itens-tab.active {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
            height: 100% !important;
            position: relative !important;
            left: auto !important;
        }
        
        #visualizar-resumo-tab.active {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
            height: 100% !important;
            position: relative !important;
            left: auto !important;
        }
        
        /* Fazer o container de tabela do modal de visualiza√ß√£o seguir as mesmas regras */
        #visualizar-itens-tab .itens-table-container {
            flex: 1 1 0;
            align-self: stretch;
            width: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            display: block;
            max-height: 45vh;
            margin: 0;
            padding: 0;
            min-height: 100px;
        }
        
        /* As regras CSS para o modal de visualiza√ß√£o s√£o as mesmas do modal de inclus√£o */
    }
</style>

<!-- Modal de detalhes de material -->
<div id="materialDetalhesModal" class="detalhes-modal">
    <div class="detalhes-modal-content">
        <div class="detalhes-modal-header">
            <div>
                <h3 id="materialDetalhesNome" class="detalhes-modal-title">Material</h3>
                <p id="materialDetalhesSubtitle" class="detalhes-modal-subtitle">Produtos que utilizam este material</p>
            </div>
            <button class="detalhes-modal-close" onclick="fecharDetalhesModal('materialDetalhesModal')">&times;</button>
        </div>
        <div class="detalhes-modal-body">
            <div id="materialDetalhesList" class="detalhes-list">
                <!-- Lista ser√° preenchida dinamicamente -->
            </div>
        </div>
    </div>
</div>

<!-- Modal de detalhes de m√°quina -->
<div id="maquinaDetalhesModal" class="detalhes-modal">
    <div class="detalhes-modal-content">
        <div class="detalhes-modal-header">
            <div>
                <h3 id="maquinaDetalhesNome" class="detalhes-modal-title">M√°quina</h3>
                <p id="maquinaDetalhesSubtitle" class="detalhes-modal-subtitle">Etapas que utilizam esta m√°quina</p>
            </div>
            <button class="detalhes-modal-close" onclick="fecharDetalhesModal('maquinaDetalhesModal')">&times;</button>
        </div>
        <div class="detalhes-modal-body">
            <div id="maquinaDetalhesList" class="detalhes-list">
                <!-- Lista ser√° preenchida dinamicamente -->
            </div>
        </div>
    </div>
</div>

<script>
    // Fun√ß√£o global para formatar moeda - dispon√≠vel desde o in√≠cio
    window.formatarMoeda = function(valor) {
        // Tratar valores null, undefined ou vazios
        if (valor === null || valor === undefined || valor === '' || isNaN(valor)) {
            valor = 0;
        }
        
        // Converter para n√∫mero se for string
        if (typeof valor === 'string') {
            valor = parseFloat(valor) || 0;
        }
        
        return new Intl.NumberFormat('pt-BR', { 
            style: 'currency', 
            currency: 'BRL' 
        }).format(valor);
    };

    let clientesData = [];
    let produtosData = [];
    let kitsData = [];
    let itensOrcamento = [];
    let filtroAtivo = 'todos'; // 'todos', 'produtos', 'kits'
    let modoEdicao = false; // false = incluir, true = editar
    let orcamentoIdEdicao = null; // ID do or√ßamento sendo editado

    // Fun√ß√£o para calcular automaticamente o prazo de entrega
    function calcularPrazoEntrega() {
        const dataAtual = new Date();
        const dataEntregaInput = document.getElementById('dataEntrega');
        const prazoEntregaInput = document.getElementById('prazoEntrega');
        
        if (dataEntregaInput && dataEntregaInput.value && prazoEntregaInput) {
            const dataEntrega = new Date(dataEntregaInput.value);
            
            // Calcular diferen√ßa em dias √∫teis (excluindo s√°bados e domingos)
            const diffTime = dataEntrega - dataAtual;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays > 0) {
                // Calcular dias √∫teis
                let diasUteis = 0;
                let dataTemp = new Date(dataAtual);
                
                for (let i = 0; i < diffDays; i++) {
                    dataTemp.setDate(dataTemp.getDate() + 1);
                    const diaSemana = dataTemp.getDay();
                    // 0 = domingo, 6 = s√°bado
                    if (diaSemana !== 0 && diaSemana !== 6) {
                        diasUteis++;
                    }
                }
                
                // Determinar formato do texto
                if (diasUteis <= 30) {
                    prazoEntregaInput.value = `${diasUteis} dia${diasUteis > 1 ? 's' : ''} √∫teis`;
                } else {
                    const semanas = Math.floor(diasUteis / 5); // 5 dias √∫teis por semana
                    if (semanas === 1) {
                        prazoEntregaInput.value = '1 semana √∫til';
                    } else if (semanas < 5) {
                        prazoEntregaInput.value = `${semanas} semanas √∫teis`;
                    } else {
                        const meses = Math.floor(diasUteis / 20); // Aproximadamente 20 dias √∫teis por m√™s
                        prazoEntregaInput.value = `${meses} m√™s${meses > 1 ? 'es' : ''} √∫teis`;
                    }
                }
            } else if (diffDays === 0) {
                prazoEntregaInput.value = 'Entrega hoje';
            } else {
                prazoEntregaInput.value = 'Data de entrega inv√°lida (passado)';
            }
        } else {
            // Limpar campo se n√£o h√° data selecionada
            if (prazoEntregaInput) {
                prazoEntregaInput.value = '';
            }
        }
    }

    // Carregar lista de or√ßamentos
    async function carregarListaOrcamentos() {
        console.log('üìã Carregando lista de or√ßamentos...');
        
        try {
            const response = await fetch('/api/orcamentos');
            const result = await response.json();
            
            if (response.ok && result.success) {
                console.log('‚úÖ Lista de or√ßamentos carregada com sucesso');
                renderizarListaOrcamentos(result.orcamentos);
                renderizarTabelaOrcamentos(result.orcamentos);
            } else {
                throw new Error(result.message || 'Erro ao carregar or√ßamentos');
            }
        } catch (error) {
            console.error('‚ùå Erro ao carregar or√ßamentos:', error);
            const container = document.getElementById('orcamentosList');
            if (container) {
                container.innerHTML = 
                    '<div class="alert alert-danger">Erro ao carregar or√ßamentos: ' + error.message + '</div>';
            }
            const tabelaContainer = document.querySelector('.orcamentos-list');
            if (tabelaContainer) {
                tabelaContainer.innerHTML = 
                    '<div style="padding: 20px; text-align: center; color: var(--error-color);">Erro ao carregar or√ßamentos: ' + error.message + '</div>';
            }
        }
    }
    
    // Renderizar lista de or√ßamentos
    function renderizarListaOrcamentos(orcamentos) {
        const container = document.getElementById('orcamentosList');
        if (!container) return;
        
        if (!orcamentos || orcamentos.length === 0) {
            container.innerHTML = `
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    Nenhum or√ßamento encontrado. Crie seu primeiro or√ßamento!
                </div>
            `;
            return;
        }
        
        const orcamentosHtml = orcamentos.map(orcamento => `
            <div class="card mb-3">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title mb-0">Or√ßamento #${orcamento.numero}</h5>
                        <small class="text-muted">
                            <i class="fas fa-calendar"></i> ${formatarDataHora(orcamento.data_criacao)}
                            ${orcamento.status ? `- <span class="badge badge-${getStatusColor(orcamento.status)}">${orcamento.status}</span>` : ''}
                        </small>
                    </div>
                    <div class="text-right">
                        <h6 class="text-primary mb-0">R$ ${orcamento.total.toFixed(2)}</h6>
                        <small class="text-muted">${orcamento.total_itens} itens</small>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <strong><i class="fas fa-user"></i> Cliente:</strong> ${orcamento.cliente_nome}<br>
                            ${orcamento.vendedor_nome ? `<strong><i class="fas fa-user-tie"></i> Vendedor:</strong> ${orcamento.vendedor_nome}<br>` : ''}
                            ${orcamento.data_validade ? `<strong><i class="fas fa-clock"></i> V√°lido at√©:</strong> ${formatarData(orcamento.data_validade)}<br>` : ''}
                        </div>
                        <div class="col-md-6">
                            ${orcamento.prazo_entrega ? `<strong><i class="fas fa-truck"></i> Prazo:</strong> ${orcamento.prazo_entrega}<br>` : ''}
                            ${orcamento.condicoes_pagamento ? `<strong><i class="fas fa-credit-card"></i> Pagamento:</strong> ${orcamento.condicoes_pagamento}<br>` : ''}
                            ${orcamento.parcelas ? `<strong><i class="fas fa-list-ol"></i> Parcelas:</strong> ${orcamento.parcelas}x<br>` : ''}
                        </div>
                    </div>
                    ${orcamento.observacoes ? `
                        <div class="mt-3">
                            <strong><i class="fas fa-comment"></i> Observa√ß√µes:</strong>
                            <p class="mb-0">${orcamento.observacoes}</p>
                        </div>
                    ` : ''}
                    <div class="mt-3">
                        <button class="action-btn" data-tooltip="Editar" onclick="editarOrcamento(${orcamento.id})" style="background: none; border: none; cursor: pointer; padding: 5px; border-radius: 4px; transition: background-color 0.2s ease; color: var(--action-icon-color);">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 14.66V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h5.34"></path>
                                <polygon points="18 2 22 6 12 16 8 16 8 12 18 2"></polygon>
                            </svg>
                        </button>
                        <button class="action-btn" data-tooltip="Imprimir" onclick="imprimirOrcamento(${orcamento.id})" style="background: none; border: none; cursor: pointer; padding: 5px; border-radius: 4px; transition: background-color 0.2s ease; color: var(--action-icon-color);">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="6,9 6,2 18,2 18,9"></polyline>
                                <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                                <rect x="6" y="14" width="12" height="8"></rect>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        `).join('');
        
        container.innerHTML = orcamentosHtml;
    }
    
    // Renderizar or√ßamentos na tabela
    function renderizarTabelaOrcamentos(orcamentos) {
        const container = document.querySelector('.orcamentos-list');
        if (!container) return;
        
        if (!orcamentos || orcamentos.length === 0) {
            container.innerHTML = `
                <div style="padding: 40px; text-align: center; color: var(--text-muted, #888);">
                    <div style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;">üìã</div>
                    <h3 style="color: var(--text-color, white); margin-bottom: 10px;">Nenhum or√ßamento encontrado</h3>
                    <p style="color: var(--text-muted, #888);">Crie seu primeiro or√ßamento clicando no bot√£o "Incluir Or√ßamento"</p>
                </div>
            `;
            return;
        }
        
        const orcamentosHtml = orcamentos.map(orcamento => {
            console.log('üîß Debug renderiza√ß√£o - orcamento:', orcamento);
            console.log('üîß Debug renderiza√ß√£o - orcamento.id:', orcamento.id, 'tipo:', typeof orcamento.id);
            
            // Capturar o ID em uma vari√°vel local para garantir closure correto
            const orcamentoId = orcamento.id;
            console.log('üîß Debug - orcamentoId capturado:', orcamentoId);
            
            // Fun√ß√£o para formatar data (apenas data)
            const formatarDataTabela = (data) => {
                if (!data) return '-';
                const date = new Date(data);
                return date.toLocaleDateString('pt-BR');
            };
            
            // Fun√ß√£o para formatar data com hora
            const formatarDataHoraTabela = (data) => {
                if (!data) return '-';
                const date = new Date(data);
                return date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            };
            
            // Fun√ß√£o para formatar moeda
            const formatarMoeda = (valor) => {
                // Tratar valores null, undefined ou vazios
                if (valor === null || valor === undefined || valor === '' || isNaN(valor)) {
                    valor = 0;
                }
                
                // Converter para n√∫mero se for string
                if (typeof valor === 'string') {
                    valor = parseFloat(valor) || 0;
                }
                
                return new Intl.NumberFormat('pt-BR', { 
                    style: 'currency', 
                    currency: 'BRL' 
                }).format(valor);
            };
            
            // Fun√ß√£o para truncar texto longo
            const truncarTexto = (texto, maxLength = 25) => {
                if (!texto) return '-';
                return texto.length > maxLength ? texto.substring(0, maxLength) + '...' : texto;
            };
            
            const orcamentoRow = document.createElement('div');
            orcamentoRow.className = 'orcamento-row';
            orcamentoRow.style.cssText = `
                display: grid; 
                grid-template-columns: 0.8fr 2.2fr 1.2fr 1fr 1fr 1fr 1.3fr 1fr 1fr 1.2fr; 
                gap: 15px; 
                padding: 12px 20px; 
                margin: 8px 0; 
                border-radius: 6px; 
                transition: all 0.2s ease; 
                align-items: center;
                background-color: var(--table-row-bg, rgba(255, 255, 255, 0.05));
                border: 1px solid rgba(155, 100, 227, 0.2);
                cursor: pointer;
            `;
            
            // Configurar evento de clique usando addEventListener para evitar problemas de interpola√ß√£o
            orcamentoRow.addEventListener('click', function() {
                console.log('üîß Clique na linha! ID:', orcamentoId);
                console.log('üîß Tipo do ID:', typeof orcamentoId);
                console.log('üîß Valor exato:', orcamentoId);
                
                // Garantir que o ID seja um n√∫mero
                const idNumerico = parseInt(orcamentoId);
                console.log('üîß ID convertido para n√∫mero:', idNumerico);
                
                // Chamar fun√ß√£o com log adicional
                console.log('üîß Chamando openOrcamentoModal com:', idNumerico);
                openOrcamentoModal(idNumerico);
            });
            
            // Configurar eventos de hover
            orcamentoRow.addEventListener('mouseenter', function() {
                this.style.backgroundColor = 'rgba(155, 100, 227, 0.1)';
                this.style.transform = 'translateY(-2px)';
                this.style.boxShadow = '0 4px 12px rgba(155, 100, 227, 0.3)';
            });
            
            orcamentoRow.addEventListener('mouseleave', function() {
                this.style.backgroundColor = 'var(--table-row-bg, rgba(255, 255, 255, 0.05))';
                this.style.transform = 'translateY(0)';
                this.style.boxShadow = 'none';
            });
            
            orcamentoRow.innerHTML = `
                <div style="color: var(--text-color, white); font-weight: 600; font-family: 'Courier New', monospace; text-align: center;">
                    #${orcamento.numero || '-'}
                </div>
                
                <div style="color: var(--text-color, white); text-align: left;" title="${orcamento.cliente_nome || '-'}">
                    ${truncarTexto(orcamento.cliente_nome)}
                </div>
                
                <div style="color: var(--text-color, white); text-align: left;" title="${orcamento.vendedor_nome || '-'}">
                    ${truncarTexto(orcamento.vendedor_nome)}
                </div>
                
                <div style="color: var(--text-color, white); font-size: 0.9em; text-align: center;">
                    ${formatarDataHoraTabela(orcamento.data_criacao)}
                </div>
                
                <div style="color: var(--text-color, white); font-size: 0.9em; text-align: center;">
                    ${formatarDataTabela(orcamento.data_validade)}
                </div>
                
                <div style="color: var(--text-color, white); font-size: 0.9em; text-align: center;">
                    ${formatarDataHoraTabela(orcamento.data_hora_entrega)}
                </div>
                
                <div style="color: var(--text-color, white); font-size: 0.9em; text-align: center;" title="${orcamento.condicoes_pagamento || '-'}">
                    ${truncarTexto(orcamento.condicoes_pagamento, 15)}
                </div>
                
                <div style="color: var(--success-color, #2ecc71); font-weight: 500; text-align: right;">
                    ${formatarMoeda(orcamento.subtotal)}
                </div>
                
                <div style="color: var(--success-color, #2ecc71); font-weight: 700; text-align: right; font-size: 1.05em;">
                    ${formatarMoeda(orcamento.total)}
                </div>
                
                <div style="display: flex; gap: 6px; justify-content: center;">
                    <button class="action-btn" data-tooltip="Editar" onclick="editarOrcamento(${orcamento.id})" style="background: none; border: none; cursor: pointer; padding: 5px; border-radius: 4px; transition: background-color 0.2s ease; color: var(--action-icon-color);">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 14.66V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h5.34"></path>
                            <polygon points="18 2 22 6 12 16 8 16 8 12 18 2"></polygon>
                        </svg>
                    </button>
                    
                    <button class="action-btn" data-tooltip="Imprimir" onclick="imprimirOrcamento(${orcamento.id})" style="background: none; border: none; cursor: pointer; padding: 5px; border-radius: 4px; transition: background-color 0.2s ease; color: var(--action-icon-color);">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6,9 6,2 18,2 18,9"></polyline>
                            <path d="M6,18H4a2,2 0,0,1-2-2v-5a2,2 0,0,1,2-2H20a2,2 0,0,1,2,2v5a2,2 0,0,1-2,2H18"></path>
                            <rect x="6" y="14" width="12" height="8"></rect>
                        </svg>
                    </button>
                </div>
            `;
            
            // Configurar eventos dos bot√µes de a√ß√£o
            const btnEditar = orcamentoRow.querySelector('.action-btn[data-tooltip="Editar"]');
            const btnImprimir = orcamentoRow.querySelector('.action-btn[data-tooltip="Imprimir"]');
            
            // Configurar hover effects
            [btnEditar, btnImprimir].forEach(btn => {
                if (btn) {
                    btn.addEventListener('mouseenter', function() {
                        this.style.backgroundColor = 'rgba(155, 100, 227, 0.2)';
                        this.style.color = 'var(--cor-destaque, #9B64E3)';
                        this.style.transform = 'scale(1.05)';
                    });
                    
                    btn.addEventListener('mouseleave', function() {
                        this.style.backgroundColor = '';
                        this.style.color = 'var(--action-icon-color)';
                        this.style.transform = 'scale(1)';
                    });
                }
            });
            
            // Configurar eventos de clique dos bot√µes
            if (btnEditar) {
                btnEditar.addEventListener('click', function(event) {
                    event.stopPropagation();
                    editarOrcamento(orcamentoId);
                });
            }
            
            if (btnImprimir) {
                btnImprimir.addEventListener('click', function(event) {
                    event.stopPropagation();
                    imprimirOrcamento(orcamentoId);
                });
            }
            
            return orcamentoRow;
        });
        
        // Limpar container e adicionar elementos
        container.innerHTML = '';
        orcamentosHtml.forEach(elemento => {
            container.appendChild(elemento);
        });
    }
    
    // Fun√ß√µes auxiliares
    function formatarData(data) {
        if (!data) return '';
        const date = new Date(data);
        return date.toLocaleDateString('pt-BR');
    }
    
    function formatarDataHora(data) {
        if (!data) return '';
        const date = new Date(data);
        return date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
    }
    
    function getStatusColor(status) {
        const colors = {
            'rascunho': 'secondary',
            'enviado': 'primary',
            'aprovado': 'success',
            'rejeitado': 'danger',
            'vencido': 'warning'
        };
        return colors[status] || 'secondary';
    }
    
    // Fun√ß√µes para a√ß√µes dos or√ßamentos

    
    function editarOrcamento(id) {
        console.log('Editando or√ßamento:', id);
        // Abrir modal em modo de edi√ß√£o
        openOrcamentoModal(id);
    }
    
    function imprimirOrcamento(id) {
        console.log('Imprimindo or√ßamento:', id);
        // Implementar impress√£o
        alert('Funcionalidade de impress√£o ser√° implementada em breve.');
    }

    // Carregar dados do backend ao carregar a p√°gina
    function initializeOrcamentosScripts() {
        console.log('üîß Inicializando scripts de or√ßamentos...');
        carregarClientes();
        carregarProdutos();
        carregarKits();
        carregarListaOrcamentos();
        
        // Configurar pesquisa de or√ßamentos
        const searchInput = document.getElementById('searchOrcamento');
        if (searchInput) {
            searchInput.addEventListener('input', function() {
                filtrarOrcamentos(this.value);
            });
        }
    }
    
    // Fun√ß√£o para filtrar or√ßamentos na tabela
    function filtrarOrcamentos(termo) {
        const linhas = document.querySelectorAll('.orcamentos-list > div');
        termo = termo.toLowerCase().trim();
        
        linhas.forEach(linha => {
            const textoLinha = linha.textContent.toLowerCase();
            if (textoLinha.includes(termo)) {
                linha.style.display = 'grid';
            } else {
                linha.style.display = 'none';
            }
        });
    }

    // Para compatibilidade quando carregado diretamente
    document.addEventListener('DOMContentLoaded', function() {
        initializeOrcamentosScripts();
    });

    // Expor a fun√ß√£o globalmente para o dashboard
    window.initializeOrcamentosScripts = initializeOrcamentosScripts;
    window.carregarKits = carregarKits;
    window.adicionarKitAoOrcamento = adicionarKitAoOrcamento;
    window.mostrarTodosProdutos = mostrarTodosProdutos;
    window.mostrarApenasProdutos = mostrarApenasProdutos;
    window.mostrarApenasKits = mostrarApenasKits;
    window.carregarListaOrcamentos = carregarListaOrcamentos;
    window.salvarOrcamento = salvarOrcamento;
    window.editarOrcamento = editarOrcamento;
    window.imprimirOrcamento = imprimirOrcamento;
    window.imprimirDescritivo = imprimirDescritivo;
    window.formatarMoeda = formatarMoeda;
    window.filtrarOrcamentos = filtrarOrcamentos;
    window.renderizarTabelaOrcamentos = renderizarTabelaOrcamentos;

    // Fun√ß√£o para carregar clientes do backend
    async function carregarClientes() {
        console.log('üîÑ Carregando clientes...');
        try {
            const response = await fetch('/api/clientes');
            if (response.ok) {
                const data = await response.json();
                if (data.status === 'success' && data.clientes) {
                    clientesData = data.clientes;
                    console.log('‚úÖ Clientes carregados:', clientesData.length);
                    atualizarDropdownClientes();
                } else {
                    console.error('‚ùå Erro na estrutura da resposta:', data);
                    clientesData = [];
                }
            } else {
                console.error('‚ùå Erro ao carregar clientes:', response.statusText);
                clientesData = [];
            }
        } catch (error) {
            console.error('‚ùå Erro ao carregar clientes:', error);
            clientesData = [];
        }
    }

    // Fun√ß√£o para atualizar o dropdown de clientes
    function atualizarDropdownClientes() {
        const dropdown = document.querySelector('#cliente .dropdown-content');
        if (!dropdown) {
            console.error('‚ùå Elemento dropdown de clientes n√£o encontrado');
            return;
        }
        
        dropdown.innerHTML = '';
        
        if (clientesData && clientesData.length > 0) {
            clientesData.forEach(cliente => {
                const div = document.createElement('div');
                div.textContent = `${cliente.nome}${cliente.email ? ' - ' + cliente.email : ''}`;
                div.onclick = function() {
                    selecionarCliente(cliente);
                };
                dropdown.appendChild(div);
            });
            
            console.log('‚úÖ Dropdown de clientes atualizado com', clientesData.length, 'clientes');
        } else {
            dropdown.innerHTML = '<div style="color: #999; padding: 8px;">Nenhum cliente encontrado</div>';
            console.log('‚ö†Ô∏è Nenhum cliente dispon√≠vel para o dropdown');
        }
    }

    // Fun√ß√£o para selecionar cliente
    function selecionarCliente(cliente) {
        const button = document.querySelector('#cliente button');
        if (button) {
            const textoCliente = `${cliente.nome}${cliente.email ? ' - ' + cliente.email : ''}`;
            button.textContent = textoCliente;
            button.setAttribute('data-cliente-id', cliente.id);
            button.dataset.value = cliente.id; // Para compatibilidade com outras fun√ß√µes
            
            console.log('‚úÖ Cliente selecionado:', textoCliente);
        }
        
        // Fechar dropdown
        const clienteSelect = document.getElementById('cliente');
        if (clienteSelect) {
            clienteSelect.blur();
        }
    }

    // Fun√ß√£o para carregar produtos do backend
    async function carregarProdutos() {
        console.log('üîÑ Carregando produtos...');
        try {
            const response = await fetch('/api/produtos');
            if (response.ok) {
                const data = await response.json();
                produtosData = data.produtos || [];
                console.log('‚úÖ Produtos carregados:', produtosData.length);
            } else {
                console.error('‚ùå Erro ao carregar produtos:', response.statusText);
            }
        } catch (error) {
            console.error('‚ùå Erro ao carregar produtos:', error);
        }
    }

    // Fun√ß√£o para carregar kits do backend
    async function carregarKits() {
        console.log('üîÑ Carregando kits...');
        try {
            const response = await fetch('/api/kits');
            if (response.ok) {
                const data = await response.json();
                kitsData = data.kits || [];
                console.log('‚úÖ Kits carregados:', kitsData.length);
            } else {
                console.error('‚ùå Erro ao carregar kits:', response.statusText);
            }
        } catch (error) {
            console.error('‚ùå Erro ao carregar kits:', error);
        }
    }

    // Fun√ß√£o para abrir modal de produtos
    function abrirModalProdutos() {
        console.log('üîÑ Abrindo modal de produtos e kits...');
        
        // Verificar se precisamos carregar dados
        const precisaCarregarProdutos = produtosData.length === 0;
        const precisaCarregarKits = kitsData.length === 0;
        
        if (precisaCarregarProdutos || precisaCarregarKits) {
            console.log('‚ö†Ô∏è Dados n√£o carregados, tentando carregar...');
            
            const promises = [];
            if (precisaCarregarProdutos) promises.push(carregarProdutos());
            if (precisaCarregarKits) promises.push(carregarKits());
            
            Promise.all(promises).then(() => {
                if (produtosData.length > 0 || kitsData.length > 0) {
                    document.getElementById('produtosModal').style.display = 'block';
                    renderizarListaItens();
                } else {
                    console.error('‚ùå Nenhum produto ou kit encontrado ap√≥s carregamento');
                    showErrorModal('Produtos n√£o dispon√≠veis', 'Nenhum produto ou kit dispon√≠vel');
                }
            });
        } else {
            document.getElementById('produtosModal').style.display = 'block';
            renderizarListaItens();
        }
    }

    // Fun√ß√£o para fechar modal de produtos
    function fecharModalProdutos() {
        document.getElementById('produtosModal').style.display = 'none';
    }

    // Fun√ß√µes para controlar as abas de filtro
    function mostrarTodosProdutos() {
        filtroAtivo = 'todos';
        atualizarBotoesAba();
        renderizarListaItens();
    }

    function mostrarApenasProdutos() {
        filtroAtivo = 'produtos';
        atualizarBotoesAba();
        renderizarListaItens();
    }

    function mostrarApenasKits() {
        filtroAtivo = 'kits';
        atualizarBotoesAba();
        renderizarListaItens();
    }

    function atualizarBotoesAba() {
        // Reset todos os bot√µes
        document.getElementById('btnTodosProdutos').style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
        document.getElementById('btnApenasProdutos').style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
        document.getElementById('btnApenasKits').style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
        
        // Destacar o bot√£o ativo
        if (filtroAtivo === 'todos') {
            document.getElementById('btnTodosProdutos').style.backgroundColor = 'rgba(155, 100, 227, 0.3)';
        } else if (filtroAtivo === 'produtos') {
            document.getElementById('btnApenasProdutos').style.backgroundColor = 'rgba(155, 100, 227, 0.3)';
        } else if (filtroAtivo === 'kits') {
            document.getElementById('btnApenasKits').style.backgroundColor = 'rgba(155, 100, 227, 0.3)';
        }
    }

    // Fun√ß√£o para renderizar lista de itens (produtos e kits)
    function renderizarListaItens(filtro = '') {
        console.log('üîÑ Renderizando lista de itens. Produtos:', produtosData.length, 'Kits:', kitsData.length);
        
        const listaProdutos = document.getElementById('listaProdutos');
        if (!listaProdutos) {
            console.error('‚ùå Elemento listaProdutos n√£o encontrado');
            return;
        }
        
        listaProdutos.innerHTML = '';
        let itensParaMostrar = [];

        // Filtrar produtos
        if (filtroAtivo === 'todos' || filtroAtivo === 'produtos') {
            const produtosFiltrados = produtosData.filter(produto => 
                produto.nome.toLowerCase().includes(filtro.toLowerCase()) ||
                (produto.descricao && produto.descricao.toLowerCase().includes(filtro.toLowerCase())) ||
                (produto.codigo && produto.codigo.toLowerCase().includes(filtro.toLowerCase()))
            );
            
            itensParaMostrar = itensParaMostrar.concat(produtosFiltrados.map(produto => ({
                ...produto,
                tipo: 'produto'
            })));
        }

        // Filtrar kits
        if (filtroAtivo === 'todos' || filtroAtivo === 'kits') {
            const kitsFiltrados = kitsData.filter(kit => 
                kit.nome.toLowerCase().includes(filtro.toLowerCase()) ||
                (kit.descricao && kit.descricao.toLowerCase().includes(filtro.toLowerCase())) ||
                (kit.codigo && kit.codigo.toLowerCase().includes(filtro.toLowerCase()))
            );
            
            itensParaMostrar = itensParaMostrar.concat(kitsFiltrados.map(kit => ({
                ...kit,
                tipo: 'kit'
            })));
        }

        console.log('üìã Itens filtrados:', itensParaMostrar.length);

        if (itensParaMostrar.length === 0) {
            listaProdutos.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">Nenhum item encontrado</div>';
            return;
        }

        // Ordenar por tipo (produtos primeiro, depois kits)
        itensParaMostrar.sort((a, b) => {
            if (a.tipo !== b.tipo) {
                return a.tipo === 'produto' ? -1 : 1;
            }
            return a.nome.localeCompare(b.nome);
        });

        itensParaMostrar.forEach(item => {
            const div = document.createElement('div');
            div.style.cssText = `
                padding: 15px; 
                border-bottom: 1px solid rgba(155, 100, 227, 0.3);
                cursor: pointer;
                transition: background-color 0.2s ease;
                display: flex;
                justify-content: space-between;
                align-items: center;
            `;
            
            if (item.tipo === 'produto') {
                div.innerHTML = `
                    <div>
                        <div style="display: flex; align-items: center; margin-bottom: 5px;">
                            <span style="background: rgba(100, 150, 255, 0.2); color: #64a0ff; padding: 2px 6px; border-radius: 3px; font-size: 0.75em; margin-right: 8px;">PRODUTO</span>
                            <span style="font-weight: bold;">${item.nome}</span>
                        </div>
                        <div style="font-size: 0.9em; color: #ccc;">${item.descricao || ''}</div>
                        <div style="font-size: 0.85em; color: #9B64E3; margin-top: 5px;">
                            C√≥digo: ${item.codigo || 'N/A'} | 
                            Pre√ßo: R$ ${parseFloat(item.preco || 0).toFixed(2)} | 
                            Custo: R$ ${(parseFloat(item.custo_materiais || 0) + parseFloat(item.custo_etapas || 0)).toFixed(2)}
                        </div>
                    </div>
                    <button onclick="adicionarProdutoAoOrcamento(${item.id})" 
                            style="padding: 8px 12px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 5px; background-color: rgba(155, 100, 227, 0.1); color: white; cursor: pointer;">
                        Adicionar
                    </button>
                `;
            } else if (item.tipo === 'kit') {
                div.innerHTML = `
                    <div>
                        <div style="display: flex; align-items: center; margin-bottom: 5px;">
                            <span style="background: rgba(255, 150, 100, 0.2); color: #ff9664; padding: 2px 6px; border-radius: 3px; font-size: 0.75em; margin-right: 8px;">KIT</span>
                            <span style="font-weight: bold;">${item.nome}</span>
                        </div>
                        <div style="font-size: 0.9em; color: #ccc;">${item.descricao || ''}</div>
                        <div style="font-size: 0.85em; color: #9B64E3; margin-top: 5px;">
                            C√≥digo: ${item.codigo || 'N/A'} | 
                            Produtos: ${item.total_produtos || item.produtos?.length || 0} itens
                        </div>
                    </div>
                    <button onclick="adicionarKitAoOrcamento(${item.id})" 
                            style="padding: 8px 12px; border: 1px solid #ff9664; border-radius: 5px; background-color: rgba(255, 150, 100, 0.1); color: #ff9664; cursor: pointer;">
                        Adicionar Kit
                    </button>
                `;
            }
            
            div.onmouseover = function() {
                this.style.backgroundColor = 'rgba(155, 100, 227, 0.1)';
            };
            div.onmouseout = function() {
                this.style.backgroundColor = 'transparent';
            };
            
            listaProdutos.appendChild(div);
        });
    }

    // Fun√ß√£o para filtrar itens (produtos e kits)
    function filtrarItens(filtro) {
        renderizarListaItens(filtro);
    }

    // Fun√ß√£o para adicionar produto ao or√ßamento
    function adicionarProdutoAoOrcamento(produtoId) {
        const produto = produtosData.find(p => p.id === produtoId);
        if (!produto) return;

        // Verificar se o produto j√° est√° no or√ßamento
        if (itensOrcamento.find(item => item.id === produtoId)) {
            showErrorModal('Produto j√° adicionado', 'Este produto j√° foi adicionado ao or√ßamento');
            return;
        }

        const item = {
            id: produtoId,
            nome: produto.nome,
            quantidade: 1,
            preco_unitario: parseFloat(produto.preco || 0),
            custo_unitario: parseFloat(produto.custo_materiais || 0) + parseFloat(produto.custo_etapas || 0),
            total: parseFloat(produto.preco || 0),
            desconto: 0, // Desconto padr√£o
            // Informa√ß√µes adicionais para o descritivo
            codigo: produto.codigo || '',
            categoria: produto.categoria || '',
            descricao: produto.descricao || '',
            especificacoes: produto.especificacoes || '',
            unidade: 'un', // Pode ser obtido dos dados do produto quando dispon√≠vel
            // Campos que podem ser expandidos quando mais dados estiverem dispon√≠veis
            dimensoes: produto.dimensoes || '',
            peso: produto.peso || '',
            material: produto.material || ''
        };

        itensOrcamento.push(item);
        atualizarTabelaItens();
        atualizarDescontoGeral();
        atualizarTextoParcelas();
        fecharModalProdutos();
        
        // Exibir modal de sucesso
        showSuccessModal('Produto Adicionado!', `${produto.nome} foi adicionado ao or√ßamento com sucesso!`);
        
        // Atualizar dados de produ√ß√£o se a aba estiver ativa
        const producaoTab = document.getElementById('producao-tab');
        if (producaoTab && producaoTab.classList.contains('active')) {
            atualizarProducao();
        }
    }

    // Fun√ß√£o para adicionar kit ao or√ßamento
    async function adicionarKitAoOrcamento(kitId) {
        const kit = kitsData.find(k => k.id === kitId);
        if (!kit) {
            console.error('‚ùå Kit n√£o encontrado:', kitId);
            return;
        }

        console.log('üîÑ Adicionando kit ao or√ßamento:', kit.nome);

        // Buscar detalhes completos do kit com produtos
        try {
            const response = await fetch(`/api/kits/${kitId}`);
            if (!response.ok) {
                throw new Error(`Erro ao buscar kit: ${response.statusText}`);
            }
            
            const kitDetalhado = await response.json();
            if (!kitDetalhado.success || !kitDetalhado.kit) {
                throw new Error('Kit n√£o encontrado ou inv√°lido');
            }

            const kitCompleto = kitDetalhado.kit;
            const produtosDoKit = kitCompleto.produtos || [];

            console.log('‚úÖ Kit carregado com produtos:', produtosDoKit.length);

            if (produtosDoKit.length === 0) {
                showErrorModal('Kit sem produtos', 'Este kit n√£o possui produtos associados');
                return;
            }

            // Verificar se algum produto do kit j√° est√° no or√ßamento
            const produtosJaAdicionados = [];
            produtosDoKit.forEach(produtoKit => {
                if (itensOrcamento.find(item => item.id === produtoKit.produto_id)) {
                    produtosJaAdicionados.push(produtoKit.nome);
                }
            });

            if (produtosJaAdicionados.length > 0) {
                const mensagem = `Os seguintes produtos do kit j√° est√£o no or√ßamento:\n${produtosJaAdicionados.join(', ')}\n\nDeseja continuar mesmo assim?`;
                showConfirmModal(mensagem, () => {
                    processarAdicaoKit(produtosDoKit, kit, kitId);
                });
                return;
            }

            // Se n√£o h√° produtos duplicados, adicionar diretamente
            processarAdicaoKit(produtosDoKit, kit, kitId);

        } catch (error) {
            console.error('‚ùå Erro ao carregar kit:', error);
            showErrorModal('Erro ao carregar kit', 'Erro ao carregar detalhes do kit: ' + error.message);
        }
    }

    // Fun√ß√£o para processar adi√ß√£o do kit ao or√ßamento
    function processarAdicaoKit(produtosDoKit, kit, kitId) {
        // Adicionar todos os produtos do kit
        let produtosAdicionados = 0;
        produtosDoKit.forEach(produtoKit => {
            // Verificar se o produto j√° est√° no or√ßamento
            const jaExiste = itensOrcamento.find(item => item.id === produtoKit.produto_id);
            
            if (!jaExiste) {
                console.log('üîß Debug produto do kit:', {
                    nome: produtoKit.nome,
                    descricao_original: produtoKit.descricao,
                    produto_id: produtoKit.produto_id
                });
                
                const item = {
                    id: produtoKit.produto_id,
                    nome: `${produtoKit.nome} (Kit: ${kit.nome})`,
                    quantidade: produtoKit.quantidade || 1,
                    preco_unitario: parseFloat(produtoKit.preco || 0),
                    custo_unitario: parseFloat(produtoKit.custo_materiais || 0) + parseFloat(produtoKit.custo_etapas || 0),
                    total: parseFloat(produtoKit.preco || 0) * (produtoKit.quantidade || 1),
                    desconto: 0, // Desconto padr√£o
                    // Informa√ß√µes adicionais
                    codigo: produtoKit.produto_codigo || '',
                    categoria: produtoKit.categoria_nome || '',
                    descricao: produtoKit.descricao || '',
                    kit_origem: kit.nome,
                    kit_id: kitId,
                    unidade: 'un'
                };
                
                console.log('‚úÖ Item criado com descri√ß√£o:', item.descricao);

                itensOrcamento.push(item);
                produtosAdicionados++;
            }
        });

        if (produtosAdicionados > 0) {
            console.log(`‚úÖ ${produtosAdicionados} produtos do kit adicionados ao or√ßamento`);
            atualizarTabelaItens();
            atualizarDescontoGeral();
            atualizarTextoParcelas();
            fecharModalProdutos();
            
            // Exibir modal de sucesso
            showSuccessModal('Kit Adicionado!', `Kit "${kit.nome}" adicionado com sucesso!\n${produtosAdicionados} produtos foram inclu√≠dos no or√ßamento.`);
            
            // Atualizar dados de produ√ß√£o se a aba estiver ativa
            const producaoTab = document.getElementById('producao-tab');
            if (producaoTab && producaoTab.classList.contains('active')) {
                atualizarProducao();
            }
        } else {
            showErrorModal('Produtos j√° existem', 'Todos os produtos deste kit j√° est√£o no or√ßamento');
        }
    }

    // Fun√ß√£o para atualizar a tabela de itens
    function atualizarTabelaItens() {
        const tbody = document.getElementById('itensTabela');
        if (!tbody) {
            console.error('‚ùå Elemento itensTabela n√£o encontrado');
            return;
        }
        
        tbody.innerHTML = '';

        let precoTotal = 0;
        let custoTotal = 0;

        itensOrcamento.forEach((item, index) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td style="padding: 8px;">${item.nome}</td>
                <td style="padding: 8px; text-align: right;">
                    <input type="number" min="1" value="${item.quantidade}" 
                           onchange="atualizarQuantidade(${index}, this.value)"
                           style="width: 60px; padding: 4px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 3px; background-color: rgba(255, 255, 255, 0.1); color: white; text-align: center;">
                </td>
                <td style="padding: 8px; text-align: right;">R$ ${item.preco_unitario.toFixed(2)}</td>
                <td style="padding: 8px; text-align: right;">
                    <input type="number" min="0" max="100" step="0.01" value="${item.desconto || 0}" 
                           onchange="atualizarDesconto(${index}, this.value)"
                           style="width: 70px; padding: 4px; border: 1px solid var(--cor-destaque, #9B64E3); border-radius: 3px; background-color: rgba(255, 255, 255, 0.1); color: white; text-align: center;">%
                </td>
                <td style="padding: 8px; text-align: right;">R$ ${item.total.toFixed(2)}</td>
                <td style="padding: 8px; text-align: center;">
                    <button onclick="removerItem(${index})" 
                            style="background: none; border: none; cursor: pointer; padding: 5px; border-radius: 4px; transition: background-color 0.2s ease; color: var(--action-icon-color);"
                            onmouseover="this.style.backgroundColor='rgba(255, 100, 100, 0.2)'; this.style.color='#ff6464'" 
                            onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--action-icon-color)'"
                            title="Remover item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 6h18"></path>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                    </button>
                </td>
            `;
            tbody.appendChild(tr);

            precoTotal += item.total;
            custoTotal += item.custo_unitario * item.quantidade;
        });

        // Atualizar totais
        const precoTotalElement = document.getElementById('precoTotal');
        const custoTotalElement = document.getElementById('custoTotal');
        
        if (precoTotalElement) {
            precoTotalElement.textContent = `R$ ${precoTotal.toFixed(2)}`;
        }
        
        if (custoTotalElement) {
            custoTotalElement.textContent = `R$ ${custoTotal.toFixed(2)}`;
        }
        
        // Atualizar dados de produ√ß√£o se a aba estiver ativa
        const producaoTab = document.getElementById('producao-tab');
        if (producaoTab && producaoTab.classList.contains('active')) {
            atualizarProducao();
        }
    }

    // Fun√ß√£o para atualizar quantidade de um item
    function atualizarQuantidade(index, novaQuantidade) {
        const quantidade = parseInt(novaQuantidade) || 1;
        itensOrcamento[index].quantidade = quantidade;
        
        // Recalcular total considerando desconto
        const precoBase = itensOrcamento[index].preco_unitario * quantidade;
        const desconto = itensOrcamento[index].desconto || 0;
        itensOrcamento[index].total = precoBase * (1 - desconto / 100);
        
        atualizarTabelaItens();
        atualizarDescontoGeral();
        atualizarTextoParcelas();
        
        // Atualizar descritivo se estiver na aba ativa
        const resumoTab = document.getElementById('resumo-tab');
        if (resumoTab && resumoTab.classList.contains('active')) {
            atualizarResumoOrcamento();
        }
    }

    // Fun√ß√£o para atualizar desconto de um item
    function atualizarDesconto(index, novoDesconto) {
        const desconto = parseFloat(novoDesconto) || 0;
        itensOrcamento[index].desconto = Math.max(0, Math.min(100, desconto)); // Limitar entre 0 e 100
        
        // Recalcular total
        const precoBase = itensOrcamento[index].preco_unitario * itensOrcamento[index].quantidade;
        itensOrcamento[index].total = precoBase * (1 - itensOrcamento[index].desconto / 100);
        
        atualizarTabelaItens();
        atualizarDescontoGeral();
        atualizarTextoParcelas();
        
        // Atualizar descritivo se estiver na aba ativa
        const resumoTab = document.getElementById('resumo-tab');
        if (resumoTab && resumoTab.classList.contains('active')) {
            atualizarResumoOrcamento();
        }
    }

    // Fun√ß√£o para calcular o valor total atual do or√ßamento
    function calcularValorTotalOrcamento() {
        let total = 0;
        itensOrcamento.forEach(item => {
            total += item.total;
        });
        return total;
    }

    // Fun√ß√£o para atualizar o texto das parcelas quando o valor total mudar
    function atualizarTextoParcelas() {
        const parcelasDropdown = document.getElementById('parcelas');
        if (!parcelasDropdown) return;
        
        const button = parcelasDropdown.querySelector('button');
        const options = parcelasDropdown.querySelectorAll('.dropdown-content div');
        
        if (!button) return;
        
        const valorTotal = calcularValorTotalOrcamento();
        
        // Atualizar todas as op√ß√µes do dropdown com os valores das parcelas
        options.forEach(option => {
            const valor = option.getAttribute('data-value');
            if (valor && valorTotal > 0) {
                const valorParcela = valorTotal / parseInt(valor);
                option.textContent = `${valor}x de R$ ${valorParcela.toFixed(2).replace('.', ',')}`;
            }
        });
        
        // Atualizar o bot√£o selecionado
        const valorSelecionado = button.getAttribute('data-value');
        if (valorSelecionado && valorSelecionado !== '' && !button.textContent.includes('Selecione') && valorTotal > 0) {
            const valorParcela = valorTotal / parseInt(valorSelecionado);
            const textoFormatado = `${valorSelecionado}x de R$ ${valorParcela.toFixed(2).replace('.', ',')}`;
            button.textContent = textoFormatado;
        }
    }

    // Fun√ß√£o para calcular e atualizar o desconto geral proporcional
    function atualizarDescontoGeral() {
        if (itensOrcamento.length === 0) {
            document.getElementById('desconto').value = 'R$ 0,00';
            return;
        }
        
        let totalSemDesconto = 0;
        let totalComDesconto = 0;
        
        itensOrcamento.forEach(item => {
            const precoBase = item.preco_unitario * item.quantidade;
            totalSemDesconto += precoBase;
            totalComDesconto += item.total;
        });
        
        const valorDesconto = totalSemDesconto - totalComDesconto;
        document.getElementById('desconto').value = `R$ ${valorDesconto.toFixed(2).replace('.', ',')}`;
    }

    // Fun√ß√£o para remover item
    function removerItem(index) {
        itensOrcamento.splice(index, 1);
        atualizarTabelaItens();
        atualizarDescontoGeral();
        atualizarTextoParcelas();
        
        // Atualizar descritivo se estiver na aba ativa
        const resumoTab = document.getElementById('resumo-tab');
        if (resumoTab && resumoTab.classList.contains('active')) {
            atualizarResumoOrcamento();
        }
        
        // Atualizar dados de produ√ß√£o se a aba estiver ativa
        const producaoTab = document.getElementById('producao-tab');
        if (producaoTab && producaoTab.classList.contains('active')) {
            atualizarProducao();
        }
    }

    // Sobrescrever as fun√ß√µes do script anterior
    let originalOpenOrcamentoModal = openOrcamentoModal;
    const originalCloseOrcamentoModal = closeOrcamentoModal;
    const originalWindowOnclick = window.onclick;

    // Fun√ß√£o para abrir o modal de or√ßamento (incluir ou editar)
    function openOrcamentoModal(orcamentoId = null) {
        console.log('üîÑ Abrindo modal de or√ßamento...');
        console.log('üîß Debug - Par√¢metro recebido orcamentoId:', orcamentoId, 'tipo:', typeof orcamentoId);
        
        // Configurar modo de edi√ß√£o
        modoEdicao = orcamentoId !== null && orcamentoId !== undefined;
        orcamentoIdEdicao = orcamentoId;
        
        console.log('üîß Debug - modoEdicao:', modoEdicao, 'orcamentoIdEdicao:', orcamentoIdEdicao);
        console.log('üîß Debug - Condi√ß√µes: orcamentoId !== null =', orcamentoId !== null, 'orcamentoId !== undefined =', orcamentoId !== undefined);
        
        var modal = document.getElementById("orcamentoModal");
        modal.style.display = "block";
        
        // Atualizar t√≠tulo do modal
        const titulo = document.getElementById("modalOrcamentoTitulo");
        const botaoSalvar = document.getElementById("btnSalvarOrcamento");
        
        console.log('üîß Debug - titulo element:', titulo);
        console.log('üîß Debug - botaoSalvar element:', botaoSalvar);
        
        if (modoEdicao) {
            console.log('üîß Configurando modo de EDI√á√ÉO para or√ßamento ID:', orcamentoId);
            if (titulo) titulo.textContent = "Editar Or√ßamento";
            if (botaoSalvar) botaoSalvar.textContent = "Atualizar Or√ßamento";
        } else {
            console.log('üîß Configurando modo de INCLUS√ÉO');
            if (titulo) titulo.textContent = "Incluir Or√ßamento";
            if (botaoSalvar) botaoSalvar.textContent = "Salvar Or√ßamento";
        }
        
        // Carregar dados b√°sicos se necess√°rio PRIMEIRO
        const promises = [];
        
        if (clientesData.length === 0) {
            console.log('‚ö†Ô∏è Clientes n√£o carregados, tentando carregar...');
            promises.push(carregarClientes());
        }
        
        if (produtosData.length === 0) {
            console.log('‚ö†Ô∏è Produtos n√£o carregados, tentando carregar...');
            promises.push(carregarProdutos());
        }
        
        if (kitsData.length === 0) {
            console.log('‚ö†Ô∏è Kits n√£o carregados, tentando carregar...');
            promises.push(carregarKits());
        }
        
        // Aguardar carregamento dos dados b√°sicos antes de prosseguir
        Promise.all(promises).then(() => {
            // Configurar dropdowns ap√≥s dados carregados
            carregarClientesDropdown();
            configurarDropdowns();
            
            if (modoEdicao) {
                // Limpar formul√°rio primeiro para evitar dados residuais, mas preservar modo de edi√ß√£o
                limparFormularioModal(true);
                
                // Carregar dados do or√ßamento para edi√ß√£o DEPOIS dos dropdowns configurados
                setTimeout(() => {
                    carregarDadosOrcamento(orcamentoId);
                }, 100); // Pequeno delay para garantir que dropdowns est√£o prontos
            } else {
                // Limpar formul√°rio para novo or√ßamento
                limparFormularioModal();
                
                // Auto-preencher a data atual
                var today = new Date().toISOString().split('T')[0];
                document.getElementById("dataOrcamento").value = today;
                
                // Gerar n√∫mero automaticamente ao abrir o modal
                generateOrcamentoNumber();
            }
        }).catch(error => {
            console.error('‚ùå Erro ao carregar dados b√°sicos:', error);
            
            // Continuar mesmo com erro, mas configurar dropdowns
            carregarClientesDropdown();
            configurarDropdowns();
            
            if (modoEdicao) {
                // Limpar formul√°rio primeiro para evitar dados residuais
                limparFormularioModal();
                
                setTimeout(() => {
                    carregarDadosOrcamento(orcamentoId);
                }, 100);
            } else {
                limparFormularioModal();
                var today = new Date().toISOString().split('T')[0];
                document.getElementById("dataOrcamento").value = today;
                generateOrcamentoNumber();
            }
        });
    }

    // Fun√ß√£o para fechar o modal de or√ßamento (nova vers√£o)
    function closeOrcamentoModal() {
        var modal = document.getElementById("orcamentoModal");
        modal.style.display = "none";
        
        // Limpar o formul√°rio ao fechar o modal para evitar dados residuais
        limparFormularioModal();
        
        console.log('üîí Modal de or√ßamento fechado e formul√°rio limpo');
    }

    // Fun√ß√£o para carregar dados do or√ßamento para edi√ß√£o
    async function carregarDadosOrcamento(orcamentoId) {
        try {
            console.log('üîÑ Carregando dados do or√ßamento para edi√ß√£o:', orcamentoId);
            
            const response = await fetch(`/api/orcamentos/${orcamentoId}`);
            if (!response.ok) {
                throw new Error(`Erro ao carregar or√ßamento: ${response.status}`);
            }
            
            const data = await response.json();
            console.log('üìÑ Dados do or√ßamento carregados:', data);
            
            if (data.success && data.orcamento) {
                const orcamento = data.orcamento;
                
                // Debug para validade
                console.log('üîß Debug validade - orcamento.validade:', orcamento.validade);
                console.log('üîß Debug validade - orcamento.data_validade:', orcamento.data_validade);
                console.log('üîß Debug validade - todas as chaves:', Object.keys(orcamento));
                
                // Preencher campos b√°sicos
                document.getElementById('numeroOrcamento').value = orcamento.numero || '';
                
                // Data do or√ßamento
                if (orcamento.data_criacao) {
                    const dataOrcamento = new Date(orcamento.data_criacao);
                    document.getElementById('dataOrcamento').value = dataOrcamento.toISOString().split('T')[0];
                }
                
                // Cliente
                if (orcamento.cliente_id && orcamento.cliente_nome) {
                    const clienteDropdown = document.getElementById('cliente');
                    const clienteButton = clienteDropdown.querySelector('button');
                    if (clienteButton) {
                        clienteButton.textContent = orcamento.cliente_nome;
                        clienteButton.dataset.value = orcamento.cliente_id;
                    }
                }
                
                // Vendedor
                if (orcamento.vendedor_nome) {
                    document.getElementById('vendedor').value = orcamento.vendedor_nome;
                }
                
                // Validade
                const validadeField = orcamento.validade || orcamento.data_validade;
                console.log('üîß Debug validade - campo usado:', validadeField);
                if (validadeField) {
                    const dataValidade = new Date(validadeField);
                    console.log('üîß Debug validade - data convertida:', dataValidade);
                    document.getElementById('validadeOrcamento').value = dataValidade.toISOString().split('T')[0];
                    console.log('üîß Debug validade - valor definido no input:', document.getElementById('validadeOrcamento').value);
                }
                
                // Data e hora de entrega
                if (orcamento.data_hora_entrega) {
                    const dataEntrega = new Date(orcamento.data_hora_entrega);
                    const isoString = dataEntrega.toISOString();
                    document.getElementById('dataEntrega').value = isoString.slice(0, 16); // formato para datetime-local
                }
                
                // Condi√ß√µes de pagamento
                if (orcamento.condicoes_pagamento) {
                    const condicoesDropdown = document.getElementById('condicoesPagamento');
                    const condicoesButton = condicoesDropdown.querySelector('button');
                    if (condicoesButton) {
                        condicoesButton.textContent = orcamento.condicoes_pagamento;
                        condicoesButton.dataset.value = orcamento.condicoes_pagamento;
                    }
                }
                
                // Parcelas
                if (orcamento.parcelas) {
                    const parcelasDropdown = document.getElementById('parcelas');
                    const parcelasButton = parcelasDropdown.querySelector('button');
                    if (parcelasButton) {
                        parcelasButton.textContent = `${orcamento.parcelas}x`;
                        parcelasButton.dataset.value = orcamento.parcelas;
                        document.getElementById('parcelamentoGroup').style.display = 'block';
                    }
                }
                
                // Prazo de entrega
                if (orcamento.prazo_entrega) {
                    document.getElementById('prazoEntrega').value = orcamento.prazo_entrega;
                }
                
                // Observa√ß√µes
                if (orcamento.observacoes) {
                    document.getElementById('observacoesOrcamento').value = orcamento.observacoes;
                }
                
                // Carregar itens do or√ßamento se estiverem inclu√≠dos
                if (orcamento.itens && Array.isArray(orcamento.itens)) {
                    console.log('üì¶ Itens encontrados no or√ßamento:', orcamento.itens.length);
                    console.log('üì¶ Dados dos itens:', orcamento.itens);
                    
                    // Limpar itens atuais
                    itensOrcamento = [];
                    
                    // Adicionar itens carregados
                    orcamento.itens.forEach((item, index) => {
                        console.log(`üì¶ Processando item ${index}:`, item);
                        
                        const itemOrcamento = {
                            id: item.produto_id,
                            nome: item.produto_nome,
                            quantidade: parseFloat(item.quantidade) || 1,
                            preco_unitario: parseFloat(item.preco_unitario) || 0,
                            total: parseFloat(item.preco_total) || 0,
                            descricao: item.descricao || '',
                            kit_origem: item.kit_origem || '',
                            kit_id: item.kit_id || null,
                            custo_unitario: parseFloat(item.custo_unitario) || 0,
                            desconto: parseFloat(item.desconto_item) || 0,
                            subtotal: parseFloat(item.subtotal) || parseFloat(item.preco_total) || 0,
                            // Campos adicionais para compatibilidade
                            codigo: item.codigo || '',
                            categoria: item.categoria || '',
                            especificacoes: item.especificacoes || '',
                            unidade: 'un',
                            dimensoes: '',
                            peso: '',
                            material: ''
                        };
                        
                        console.log(`üì¶ Item processado ${index}:`, itemOrcamento);
                        itensOrcamento.push(itemOrcamento);
                    });
                    
                    console.log('üì¶ Total de itens carregados:', itensOrcamento.length);
                    console.log('üì¶ Array itensOrcamento final:', itensOrcamento);
                    
                    // Atualizar visualiza√ß√£o dos itens
                    atualizarTabelaItens();
                    
                    // Atualizar c√°lculos de totais
                    atualizarDescontoGeral();
                    atualizarTextoParcelas();
                    
                    console.log('‚úÖ Itens do or√ßamento carregados e tabela atualizada');
                } else {
                    console.log('‚ö†Ô∏è Nenhum item encontrado no or√ßamento ou itens n√£o √© um array');
                    console.log('üì¶ orcamento.itens:', orcamento.itens);
                }
                
                console.log('‚úÖ Dados do or√ßamento carregados com sucesso');
                
            } else {
                throw new Error(data.message || 'Erro ao carregar dados do or√ßamento');
            }
            
        } catch (error) {
            console.error('‚ùå Erro ao carregar or√ßamento:', error);
            showErrorModal('Erro ao carregar or√ßamento', 'Erro ao carregar dados do or√ßamento: ' + error.message);
        }
    }

    // ===== FUN√á√ïES DO MODAL DE VISUALIZAR OR√áAMENTO =====
    
    // Fun√ß√£o para abrir o modal de visualiza√ß√£o de or√ßamento
    function abrirModalVisualizarOrcamento(orcamentoId) {
        console.log('üîç Abrindo modal de visualiza√ß√£o para or√ßamento ID:', orcamentoId);
        
        // Buscar dados do or√ßamento
        fetch(`/api/orcamentos/${orcamentoId}`)
            .then(response => response.json())
            .then(data => {
                if (data.success && data.orcamento) {
                    preencherModalVisualizacao(data.orcamento);
                    document.getElementById("visualizarOrcamentoModal").style.display = "block";
                } else {
                    showErrorModal('Erro ao carregar or√ßamento', 'Erro ao carregar dados do or√ßamento: ' + (data.message || 'Erro desconhecido'));
                }
            })
            .catch(error => {
                console.error('Erro ao buscar or√ßamento:', error);
                showErrorModal('Erro ao carregar or√ßamento', 'Erro ao carregar dados do or√ßamento');
            });
    }
    
    // Fun√ß√£o para preencher o modal com os dados do or√ßamento
    function preencherModalVisualizacao(orcamento) {
        console.log('üìã Preenchendo modal com dados:', orcamento);
        
        // Preencher campos b√°sicos
        document.getElementById('visualizarNumeroOrcamento').value = orcamento.numero || '-';
        document.getElementById('visualizarDataOrcamento').value = formatarDataHora(orcamento.data_criacao) || '-';
        
        // Cliente - buscar o dropdown button e configurar como readonly
        const clienteDropdown = document.querySelector('#visualizarCliente button');
        if (clienteDropdown) {
            clienteDropdown.textContent = orcamento.cliente_nome || 'Cliente n√£o informado';
            clienteDropdown.style.cursor = 'default';
            clienteDropdown.style.opacity = '0.7';
        }
        
        document.getElementById('visualizarValidadeOrcamento').value = formatarData(orcamento.data_validade) || '-';
        document.getElementById('visualizarDataEntrega').value = formatarDataHora(orcamento.data_hora_entrega) || '-';
        document.getElementById('visualizarVendedor').value = orcamento.vendedor_nome || '-';
        
        // Condi√ß√µes de pagamento - dropdown button
        const condicoesDropdown = document.querySelector('#visualizarCondicoesPagamento button');
        if (condicoesDropdown) {
            condicoesDropdown.textContent = orcamento.condicoes_pagamento || 'N√£o informado';
            condicoesDropdown.style.cursor = 'default';
            condicoesDropdown.style.opacity = '0.7';
        }
        
        document.getElementById('visualizarPrazoEntrega').value = orcamento.prazo_entrega || '-';
        document.getElementById('visualizarDesconto').value = orcamento.desconto ? `R$ ${orcamento.desconto.toFixed(2)}` : 'R$ 0,00';
        document.getElementById('visualizarObservacoesOrcamento').value = orcamento.observacoes || '';
        
        // Mostrar parcelas se houver
        const parcelasGroup = document.getElementById('visualizarParcelamentoGroup');
        if (orcamento.parcelas && orcamento.parcelas > 1) {
            const parcelasDropdown = document.querySelector('#visualizarParcelas button');
            if (parcelasDropdown) {
                parcelasDropdown.textContent = `${orcamento.parcelas}x`;
                parcelasDropdown.style.cursor = 'default';
                parcelasDropdown.style.opacity = '0.7';
            }
            parcelasGroup.style.display = 'block';
        } else {
            parcelasGroup.style.display = 'none';
        }
        
        // Preencher totais
        document.getElementById('visualizarPrecoTotal').textContent = `R$ ${(orcamento.valor_total || 0).toFixed(2)}`;
        document.getElementById('visualizarCustoTotal').textContent = `R$ ${(orcamento.custo_total || 0).toFixed(2)}`;
        
        // Preencher itens se j√° est√£o dispon√≠veis
        if (orcamento.itens && orcamento.itens.length > 0) {
            preencherTabelaItensVisualizacao(orcamento.itens);
            preencherDescritivoVisualizacao(orcamento.itens, orcamento);
        } else {
            // Caso os itens n√£o venham no objeto, buscar separadamente
            carregarItensVisualizacao(orcamento.id);
        }
    }
    
    // Fun√ß√£o para carregar itens do or√ßamento na visualiza√ß√£o
    function carregarItensVisualizacao(orcamentoId) {
        // Os itens j√° vem no objeto orcamento, ent√£o vamos buscar novamente para ter certeza
        fetch(`/api/orcamentos/${orcamentoId}`)
            .then(response => response.json())
            .then(data => {
                if (data.success && data.orcamento && data.orcamento.itens) {
                    preencherTabelaItensVisualizacao(data.orcamento.itens);
                    preencherDescritivoVisualizacao(data.orcamento.itens, data.orcamento);
                } else {
                    const tbody = document.getElementById('visualizarItensTabela');
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #ccc;">Nenhum item encontrado</td></tr>';
                }
            })
            .catch(error => {
                console.error('Erro ao carregar itens:', error);
                const tbody = document.getElementById('visualizarItensTabela');
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #ff6b6b;">Erro ao carregar itens</td></tr>';
            });
    }
    
    // Fun√ß√£o para preencher a tabela de itens na visualiza√ß√£o
    function preencherTabelaItensVisualizacao(itens) {
        const tbody = document.getElementById('visualizarItensTabela');
        
        if (!itens || itens.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #ccc;">Nenhum item encontrado</td></tr>';
            return;
        }
        
        tbody.innerHTML = itens.map(item => {
            const quantidade = parseFloat(item.quantidade || 0);
            const precoUnitario = parseFloat(item.preco_unitario || 0);
            const desconto = parseFloat(item.desconto_item || 0);
            const total = parseFloat(item.preco_total || 0);
            
            return `
                <tr>
                    <td style="color: white; padding: 8px;">${item.produto_nome || '-'}</td>
                    <td style="color: white; padding: 8px; text-align: center;">${quantidade}</td>
                    <td style="color: white; padding: 8px; text-align: right;">R$ ${precoUnitario.toFixed(2)}</td>
                    <td style="color: white; padding: 8px; text-align: center;">${desconto.toFixed(1)}%</td>
                    <td style="color: white; padding: 8px; text-align: right; font-weight: bold;">R$ ${total.toFixed(2)}</td>
                    <td style="color: white; padding: 8px; text-align: center;">
                        <span style="opacity: 0.5; color: #666;">‚Äî</span>
                    </td>
                </tr>
            `;
        }).join('');
    }
    
    // Fun√ß√£o para preencher o descritivo na visualiza√ß√£o
    function preencherDescritivoVisualizacao(itens, orcamento) {
        const container = document.getElementById('visualizarDescritivoListaProdutos');
        const totalItensEl = document.getElementById('visualizarDescritivoTotalItens');
        const valorTotalEl = document.getElementById('visualizarDescritivoValorTotal');
        
        if (!itens || itens.length === 0) {
            container.innerHTML = '<div class="no-products"><p>Nenhum produto encontrado neste or√ßamento</p></div>';
            totalItensEl.textContent = '0';
            valorTotalEl.textContent = 'R$ 0,00';
            return;
        }
        
        // Atualizar totais
        totalItensEl.textContent = itens.length;
        valorTotalEl.textContent = `R$ ${(orcamento.valor_total || 0).toFixed(2)}`;
        
        // Gerar HTML dos produtos
        const produtosHtml = itens.map(item => {
            const quantidade = parseFloat(item.quantidade || 0);
            const precoUnitario = parseFloat(item.preco_unitario || 0);
            const desconto = parseFloat(item.desconto_item || 0);
            const total = parseFloat(item.preco_total || 0);
            
            return `
                <div class="produto-descritivo">
                    <div class="produto-info">
                        <h5 style="color: var(--cor-destaque, #D8CEFE); margin: 0 0 8px 0;">${item.produto_nome || 'Produto sem nome'}</h5>
                        <div class="produto-detalhes">
                            <div class="detalhe-item">
                                <span class="label">Quantidade:</span>
                                <span class="value">${quantidade}</span>
                            </div>
                            <div class="detalhe-item">
                                <span class="label">Pre√ßo unit√°rio:</span>
                                <span class="value">R$ ${precoUnitario.toFixed(2)}</span>
                            </div>
                            ${desconto > 0 ? `
                                <div class="detalhe-item">
                                    <span class="label">Desconto:</span>
                                    <span class="value">${desconto.toFixed(1)}%</span>
                                </div>
                            ` : ''}
                            <div class="detalhe-item total">
                                <span class="label">Total:</span>
                                <span class="value">R$ ${total.toFixed(2)}</span>
                            </div>
                        </div>
                        ${item.descricao ? `
                            <div class="produto-descricao">
                                <span class="label">Descri√ß√£o:</span>
                                <p>${item.descricao}</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }).join('');
        
        container.innerHTML = produtosHtml;
    }
    
    // Fun√ß√£o para alternar abas no modal de visualiza√ß√£o
    function switchVisualizarOrcamentoTab(tabName, button) {
        // Remover classe active de todas as abas
        document.querySelectorAll('#visualizarOrcamentoModal .tab-button').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelectorAll('#visualizarOrcamentoModal .tab-content').forEach(content => {
            content.classList.remove('active');
        });
        
        // Ativar aba clicada
        button.classList.add('active');
        document.getElementById(tabName + '-tab').classList.add('active');
    }
    
    // Fun√ß√£o para fechar o modal de visualiza√ß√£o
    function fecharModalVisualizarOrcamento() {
        document.getElementById("visualizarOrcamentoModal").style.display = "none";
    }
    
    // Fun√ß√£o para imprimir descritivo na visualiza√ß√£o
    function imprimirDescritivoVisualizar(event) {
        event.preventDefault();
        // TODO: Implementar impress√£o do descritivo
        console.log('Implementar impress√£o do descritivo');
        alert('Funcionalidade de impress√£o ser√° implementada em breve');
    }

    // Fechar o modal se clicar fora dele (nova vers√£o)
    window.onclick = function(event) {
        var modal = document.getElementById("orcamentoModal");
        var produtosModal = document.getElementById("produtosModal");
        var visualizarModal = document.getElementById("visualizarOrcamentoModal");
        
        if (event.target == modal) {
            modal.style.display = "none";
        }
        if (event.target == produtosModal) {
            produtosModal.style.display = "none";
        }
        if (event.target == visualizarModal) {
            visualizarModal.style.display = "none";
        }
    }

    // Atualizar fun√ß√£o de buscar itens existente
    function buscarItens(termo) {
        // Esta fun√ß√£o pode ser implementada para busca gen√©rica de itens
        console.log('Buscando itens:', termo);
    }

    // Fun√ß√£o para alternar entre abas do or√ßamento
    function switchOrcamentoTab(tabName, clickedButton) {
        console.log(`üîÑ Alternando para aba: ${tabName}`);
        
        // Remover classe active de todos os bot√µes de aba
        document.querySelectorAll('.tab-button').forEach(button => {
            button.classList.remove('active');
        });
        
        // Adicionar classe active ao bot√£o clicado
        clickedButton.classList.add('active');
        
        // Esconder TODOS os conte√∫dos de aba de forma mais expl√≠cita
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
            // Garantir que est√° realmente escondido
            content.style.display = 'none';
            content.style.visibility = 'hidden';
            content.style.opacity = '0';
        });
        
        // Mostrar APENAS o conte√∫do da aba selecionada
        const targetTab = document.getElementById(tabName + '-tab');
        if (targetTab) {
            targetTab.classList.add('active');
            // Garantir que est√° realmente vis√≠vel
            targetTab.style.display = 'flex';
            targetTab.style.visibility = 'visible';
            targetTab.style.opacity = '1';
            
            // Se for a aba de descritivo, atualizar os dados
            if (tabName === 'resumo') {
                atualizarResumoOrcamento();
            }
            
            // Se for a aba de produ√ß√£o, atualizar dados de produ√ß√£o
            if (tabName === 'producao') {
                atualizarProducao();
            }
        } else {
            console.error(`‚ùå Aba ${tabName}-tab n√£o encontrada!`);
        }
        
        console.log(`‚úÖ Aba ${tabName} ativada com sucesso`);
        
        // Feedback visual
        clickedButton.style.transform = 'scale(0.98)';
        setTimeout(() => {
            clickedButton.style.transform = '';
        }, 150);
    }

    // Fun√ß√£o para atualizar os dados do descritivo
    function atualizarResumoOrcamento() {
        console.log('üìä Atualizando descritivo do or√ßamento...');
        
        // Fun√ß√£o local para formatar moeda (caso n√£o esteja dispon√≠vel globalmente)
        const formatarMoedaLocal = (valor) => {
            if (valor === null || valor === undefined || valor === '' || isNaN(valor)) {
                valor = 0;
            }
            
            if (typeof valor === 'string') {
                valor = parseFloat(valor.replace(/[^\d.,]/g, '').replace(',', '.'));
            }
            
            if (isNaN(valor)) {
                valor = 0;
            }
            
            return valor.toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        };
        
        // Usar fun√ß√£o global se dispon√≠vel, sen√£o usar local
        const moedaFormatter = (typeof formatarMoeda !== 'undefined') ? formatarMoeda : formatarMoedaLocal;
        
        // Calcular totais
        let precoTotal = 0;
        let totalItens = itensOrcamento.length;
        
        itensOrcamento.forEach(item => {
            precoTotal += item.total;
        });
        
        // Atualizar elementos do cabe√ßalho
        const descritivoTotalItens = document.getElementById('descritivoTotalItens');
        const descritivoValorTotal = document.getElementById('descritivoValorTotal');
        const descritivoListaProdutos = document.getElementById('descritivoListaProdutos');
        
        if (descritivoTotalItens) descritivoTotalItens.textContent = totalItens;
        if (descritivoValorTotal) descritivoValorTotal.textContent = moedaFormatter(precoTotal);
        
        // Atualizar lista detalhada de produtos
        if (descritivoListaProdutos) {
            if (itensOrcamento.length === 0) {
                descritivoListaProdutos.innerHTML = `
                    <div class="no-products">
                        <p>Nenhum produto adicionado ao or√ßamento</p>
                        <p class="sub-text">Adicione produtos na aba "Itens/Servi√ßos" para visualizar o descritivo</p>
                    </div>
                `;
            } else {
                let html = '';
                itensOrcamento.forEach((item, index) => {
                    // Criar HTML para detalhes do produto se houver informa√ß√µes dispon√≠veis
                    let detalhesHTML = '';
                    const detalhes = [];
                    
                    // Adicionar detalhes se dispon√≠veis (estas informa√ß√µes viriam dos dados do produto)
                    if (item.dimensoes) detalhes.push({ label: 'Dimens√µes', valor: item.dimensoes });
                    if (item.peso) detalhes.push({ label: 'Peso', valor: item.peso });
                    if (item.material) detalhes.push({ label: 'Material', valor: item.material });
                    
                    if (detalhes.length > 0) {
                        detalhesHTML = `
                            <div class="produto-detalhes">
                                ${detalhes.map(detalhe => `
                                    <div class="detalhe-item">
                                        <span class="detalhe-label">${detalhe.label}</span>
                                        <span class="detalhe-valor">${detalhe.valor}</span>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    }

                    html += `
                        <div class="produto-descritivo">
                            <div class="produto-header">
                                <div>
                                    <h3 class="produto-nome">${item.nome}</h3>
                                    <div class="produto-quantidade">Quantidade: ${item.quantidade} ${item.unidade || 'un'}</div>
                                </div>
                                <div class="produto-valor">
                                    <div>${moedaFormatter(item.total)}</div>
                                    <div class="produto-quantidade">Unit: ${moedaFormatter(item.preco_unitario)}</div>
                                </div>
                            </div>
                            
                            ${item.descricao ? `
                                <div class="produto-descricao">
                                    ${item.descricao}
                                </div>
                            ` : ''}
                            
                            ${detalhesHTML}
                        </div>
                    `;
                });
                descritivoListaProdutos.innerHTML = html;
                
                // Verificar se precisa de scroll e ajustar visibilidade
                setTimeout(() => {
                    const container = document.querySelector('.descritivo-produtos');
                    if (container) {
                        // For√ßar rec√°lculo do layout
                        container.style.height = 'auto';
                        container.offsetHeight; // Trigger reflow
                        
                        // Verificar se o conte√∫do excede a altura dispon√≠vel
                        if (container.scrollHeight > container.clientHeight) {
                            container.style.paddingRight = '10px'; // Mais espa√ßo para scrollbar
                        } else {
                            container.style.paddingRight = '5px'; // Espa√ßo normal
                        }
                    }
                }, 10);
            }
        }
    }

    // ========================================
    // FUN√á√ïES DA ABA DE PRODU√á√ÉO
    // ========================================

    // Fun√ß√£o para atualizar dados de produ√ß√£o
    async function atualizarProducao() {
        console.log('üè≠ Atualizando dados de produ√ß√£o...');
        console.log('üìä Itens no or√ßamento:', itensOrcamento.length);
        
        if (!itensOrcamento || itensOrcamento.length === 0) {
            console.log('‚ö†Ô∏è Nenhum item no or√ßamento, limpando dados de produ√ß√£o');
            limparDadosProducao();
            return;
        }

        console.log('üîÑ Iniciando c√°lculos de produ√ß√£o...');
        
        // Calcular materiais necess√°rios
        await calcularMateriaisNecessarios();
        
        // Calcular tempo de m√°quinas
        await calcularTempoMaquinas();
        
        // Pequeno delay para garantir que DOM foi atualizado
        setTimeout(() => {
            // Atualizar totais
            atualizarTotaisProducao();
        }, 100);
        
        console.log('‚úÖ Dados de produ√ß√£o atualizados');
    }

    // Fun√ß√£o para calcular materiais necess√°rios
    async function calcularMateriaisNecessarios() {
        console.log('üì¶ Calculando materiais necess√°rios...');
        
        const materiaisResumo = {};
        let totalMateriaisCarregados = 0;
        
        try {
            // Para cada produto no or√ßamento, buscar seus materiais
            for (const item of itensOrcamento) {
                if (!item.id) continue;
                
                try {
                    // Buscar dados completos do produto incluindo materiais
                    const response = await fetch(`/api/produtos/${item.id}`);
                    if (!response.ok) continue;
                    
                    const resultado = await response.json();
                    if (!resultado.status === 'success' || !resultado.produto) continue;
                    
                    const produto = resultado.produto;
                    const materiais = produto.materiais || [];
                    
                    console.log(`üì¶ Produto ${produto.nome}: ${materiais.length} materiais encontrados`);
                    
                    // Processar materiais do produto
                    materiais.forEach(material => {
                        const materialId = material.material_id || material.id;
                        const materialNome = material.material_nome || material.nome || `Material ${materialId}`;
                        const quantidadeUnitaria = parseFloat(material.quantidade_necessaria || material.quantidade || 0);
                        const quantidadeTotalNecessaria = quantidadeUnitaria * item.quantidade;
                        
                        if (materiaisResumo[materialId]) {
                            // Material j√° existe, somar quantidade
                            materiaisResumo[materialId].quantidade += quantidadeTotalNecessaria;
                            materiaisResumo[materialId].produtos.push({
                                nome: item.nome,
                                quantidade: item.quantidade,
                                quantidadeMaterial: quantidadeUnitaria
                            });
                        } else {
                            // Novo material
                            materiaisResumo[materialId] = {
                                id: materialId,
                                nome: materialNome,
                                quantidade: quantidadeTotalNecessaria,
                                unidade: material.unidade || 'un',
                                tipo: material.tipo || 'Material',
                                produtos: [{
                                    nome: item.nome,
                                    quantidade: item.quantidade,
                                    quantidadeMaterial: quantidadeUnitaria
                                }]
                            };
                        }
                    });
                    
                    totalMateriaisCarregados++;
                } catch (error) {
                    console.warn(`‚ö†Ô∏è Erro ao carregar materiais do produto ${item.nome}:`, error);
                }
            }
            
            // Renderizar lista de materiais
            renderizarListaMateriais(materiaisResumo);
            
        } catch (error) {
            console.error('‚ùå Erro ao calcular materiais:', error);
            exibirErroMateriais();
        }
    }

    // Fun√ß√£o para calcular tempo de m√°quinas
    async function calcularTempoMaquinas() {
        console.log('‚öôÔ∏è Calculando tempo de m√°quinas...');
        
        const maquinasResumo = {};
        let totalMaquinasCarregadas = 0;
        
        try {
            // Para cada produto no or√ßamento, buscar suas etapas
            for (const item of itensOrcamento) {
                if (!item.id) continue;
                
                try {
                    // Buscar dados completos do produto incluindo etapas
                    const response = await fetch(`/api/produtos/${item.id}`);
                    if (!response.ok) {
                        console.log(`‚ùå Erro na requisi√ß√£o para produto ${item.id}: ${response.status}`);
                        continue;
                    }
                    
                    const resultado = await response.json();
                    console.log(`üì° Resposta da API para produto ${item.id}:`, resultado);
                    
                    if (resultado.status !== 'success' || !resultado.produto) {
                        console.log(`‚ùå Resposta inv√°lida para produto ${item.id}:`, resultado);
                        continue;
                    }
                    
                    const produto = resultado.produto;
                    const etapas = produto.etapas || [];
                    
                    console.log(`‚öôÔ∏è Produto ${produto.nome}: ${etapas.length} etapas encontradas`);
                    if (etapas.length > 0) {
                        console.log(`üìã Etapas detalhadas:`, etapas);
                    }
                    
                    // Processar etapas do produto
                    etapas.forEach((etapa, etapaIndex) => {
                        console.log(`üîç Etapa ${etapaIndex + 1}/${etapas.length}:`, etapa);
                        console.log(`üîç Dados da etapa:`, {
                            nome: etapa.nome,
                            tempo_estimado: etapa.tempo_estimado,
                            tempo: etapa.tempo,
                            equipamento_id: etapa.equipamento_id,
                            equipamento: etapa.equipamento,
                            equipamento_nome: etapa.equipamento_nome,
                            tipo: etapa.tipo,
                            tipo_etapa: etapa.tipo_etapa
                        });
                        
                        const equipamentoId = etapa.equipamento_id;
                        const equipamentoNome = etapa.equipamento || etapa.equipamento_nome || 'Manual';
                        
                        // Fun√ß√£o para converter tempo do formato "0:01:11" para minutos
                        const converterTempo = (tempoStr) => {
                            if (!tempoStr) return 0;
                            
                            // Se j√° for um n√∫mero, retornar diretamente
                            if (typeof tempoStr === 'number') return tempoStr;
                            
                            // Converter string para minutos
                            const tempoString = String(tempoStr);
                            
                            // Formato "0:01:11" (horas:minutos:segundos)
                            if (tempoString.includes(':')) {
                                const partes = tempoString.split(':');
                                if (partes.length === 3) {
                                    const horas = parseInt(partes[0]) || 0;
                                    const minutos = parseInt(partes[1]) || 0;
                                    const segundos = parseInt(partes[2]) || 0;
                                    return horas * 60 + minutos + segundos / 60; // Converter tudo para minutos
                                } else if (partes.length === 2) {
                                    const minutos = parseInt(partes[0]) || 0;
                                    const segundos = parseInt(partes[1]) || 0;
                                    return minutos + segundos / 60;
                                }
                            }
                            
                            // Tentar parseFloat como fallback
                            return parseFloat(tempoString) || 0;
                        };
                        
                        let tempoUnitario = converterTempo(etapa.tempo_estimado || etapa.tempo);
                        
                        console.log(`üïê Tempo original: ${etapa.tempo_estimado}, Convertido: ${tempoUnitario}min`);
                        
                        // Se tempo for 0, aplicar tempos estimados padr√£o baseados no equipamento
                        if (tempoUnitario === 0 && equipamentoId && equipamentoNome !== 'Manual') {
                            const nomeEquipamento = equipamentoNome.toLowerCase();
                            if (nomeEquipamento.includes('impressora') || nomeEquipamento.includes('epson')) {
                                tempoUnitario = 5; // 5 minutos para impress√£o
                            } else if (nomeEquipamento.includes('recorte') || nomeEquipamento.includes('scanncut')) {
                                tempoUnitario = 3; // 3 minutos para recorte
                            } else if (nomeEquipamento.includes('prensa')) {
                                tempoUnitario = 2; // 2 minutos para prensa
                            } else {
                                tempoUnitario = 1; // 1 minuto padr√£o para outros equipamentos
                            }
                            console.log(`‚è∞ Tempo padr√£o aplicado para ${equipamentoNome}: ${tempoUnitario}min`);
                        }
                        
                        const tempoTotalNecessario = tempoUnitario * item.quantidade;
                        const tipoEtapa = etapa.tipo || etapa.tipo_etapa || 'Manual';
                        
                        console.log(`üîß Etapa: ${etapa.nome}, Equipamento ID: ${equipamentoId}, Nome: ${equipamentoNome}, Tempo: ${tempoUnitario}min, Total: ${tempoTotalNecessario}min`);
                        
                        // Processar se h√° equipamento/m√°quina definida (removendo valida√ß√£o de tempo > 0)
                        if (equipamentoId && equipamentoNome !== 'Manual') {
                            const chave = `${tipoEtapa}_${equipamentoId}`;
                            
                            if (maquinasResumo[chave]) {
                                // M√°quina j√° existe, somar tempo
                                maquinasResumo[chave].tempoTotal += tempoTotalNecessario;
                                maquinasResumo[chave].etapas.push({
                                    produto: item.nome,
                                    quantidade: item.quantidade,
                                    tempoUnitario: tempoUnitario,
                                    nomeEtapa: etapa.nome || 'Etapa sem nome'
                                });
                            } else {
                                // Nova m√°quina
                                maquinasResumo[chave] = {
                                    id: equipamentoId,
                                    nome: equipamentoNome,
                                    tipo: tipoEtapa,
                                    tempoTotal: tempoTotalNecessario,
                                    etapas: [{
                                        produto: item.nome,
                                        quantidade: item.quantidade,
                                        tempoUnitario: tempoUnitario,
                                        nomeEtapa: etapa.nome || 'Etapa sem nome'
                                    }]
                                };
                            }
                            
                            console.log(`‚úÖ M√°quina ${equipamentoNome}: ${maquinasResumo[chave].tempoTotal}min total`);
                        } else {
                            console.log(`‚è≠Ô∏è Etapa ${etapa.nome} ignorada - ID: ${equipamentoId}, Nome: ${equipamentoNome}, Tempo: ${tempoUnitario}`);
                        }
                    });
                    
                    totalMaquinasCarregadas++;
                } catch (error) {
                    console.warn(`‚ö†Ô∏è Erro ao carregar etapas do produto ${item.nome}:`, error);
                }
            }
            
            console.log('üìä Resumo de m√°quinas encontradas:', Object.keys(maquinasResumo).length);
            Object.values(maquinasResumo).forEach(maq => {
                console.log(`üîß ${maq.nome}: ${maq.tempoTotal}min (${maq.etapas.length} etapas)`);
            });
            
            // Renderizar lista de m√°quinas
            renderizarListaMaquinas(maquinasResumo);
            
        } catch (error) {
            console.error('‚ùå Erro ao calcular tempo de m√°quinas:', error);
            exibirErroMaquinas();
        }
    }

    // Fun√ß√£o para renderizar lista de materiais
    function renderizarListaMateriais(materiaisResumo) {
        const listaMateriais = document.getElementById('listaMateriais');
        if (!listaMateriais) return;
        
        const materiais = Object.values(materiaisResumo);
        
        if (materiais.length === 0) {
            listaMateriais.innerHTML = `
                <div class="no-materials">
                    <p>Nenhum material encontrado</p>
                    <p class="sub-text">Adicione produtos com materiais especificados para ver o resumo</p>
                </div>
            `;
            return;
        }
        
        // Ordenar materiais por nome
        materiais.sort((a, b) => a.nome.localeCompare(b.nome));
        
        const html = materiais.map(material => {
            const produtosCount = material.produtos.length;
            const produtosText = produtosCount === 1 ? 'produto' : 'produtos';
            
            // Fun√ß√£o para formatar n√∫meros removendo decimais desnecess√°rios
            const formatarQuantidade = (valor) => {
                return valor % 1 === 0 ? valor.toString() : valor.toFixed(2).replace(/\.?0+$/, '');
            };
            
            return `
                <div class="material-item" onclick="abrirDetalhesModal('material', ${JSON.stringify(material).replace(/"/g, '&quot;')})">
                    <div class="material-info">
                        <div class="material-nome">${material.nome}</div>
                        <div class="material-total">
                            Total necess√°rio: <strong>${formatarQuantidade(material.quantidade)} ${material.unidade}</strong>
                        </div>
                        <div class="material-total">
                            Usado em <strong>${produtosCount} ${produtosText}</strong>
                        </div>
                    </div>
                    <div class="click-indicator">
                        <span>Clique para detalhes</span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9,18 15,12 9,6"></polyline>
                        </svg>
                    </div>
                </div>
            `;
        }).join('');
        
        listaMateriais.innerHTML = html;
        
        console.log(`‚úÖ ${materiais.length} materiais √∫nicos calculados`);
        
        // Tentar atualizar totais ap√≥s renderizar
        setTimeout(() => {
            atualizarTotaisProducao();
        }, 50);
    }

    // Fun√ß√£o para renderizar lista de m√°quinas
    function renderizarListaMaquinas(maquinasResumo) {
        const listaMaquinas = document.getElementById('listaMaquinas');
        if (!listaMaquinas) return;
        
        const maquinas = Object.values(maquinasResumo);
        
        if (maquinas.length === 0) {
            listaMaquinas.innerHTML = `
                <div class="no-machines">
                    <p>Nenhuma m√°quina com tempo definido</p>
                    <p class="sub-text">Verifique se os produtos t√™m etapas com equipamentos e tempos cadastrados</p>
                    <p class="sub-text">Tempos padr√£o foram aplicados: Impress√£o 5min, Recorte 3min, Prensa 2min, Outros 1min</p>
                </div>
            `;
            return;
        }
        
        // Ordenar m√°quinas por tempo total (maior primeiro)
        maquinas.sort((a, b) => b.tempoTotal - a.tempoTotal);
        
        const html = maquinas.map(maquina => {
            // Formatar tempo no formato 0h 0m 0s
            const tempoTotalSegundos = Math.round(maquina.tempoTotal * 60); // converter minutos para segundos
            const horas = Math.floor(tempoTotalSegundos / 3600);
            const minutos = Math.floor((tempoTotalSegundos % 3600) / 60);
            const segundos = tempoTotalSegundos % 60;
            
            const tempoFormatado = `${horas}h ${minutos}m ${segundos}s`;
            
            const etapasCount = maquina.etapas.length;
            const etapasText = etapasCount === 1 ? 'etapa' : 'etapas';
            
            console.log(`‚è∞ M√°quina ${maquina.nome}: ${maquina.tempoTotal}min = ${tempoFormatado}`);
            
            return `
                <div class="maquina-item" onclick="abrirDetalhesModal('maquina', ${JSON.stringify(maquina).replace(/"/g, '&quot;')})">
                    <div class="maquina-info">
                        <div class="maquina-nome">${maquina.nome}</div>
                        <div class="maquina-tipo">Tipo: ${maquina.tipo}</div>
                        <div class="maquina-tempo-total">
                            Tempo total: <strong>${tempoFormatado}</strong>
                        </div>
                        <div class="maquina-total">
                            <strong>${etapasCount} ${etapasText}</strong> de produ√ß√£o
                        </div>
                    </div>
                    <div class="click-indicator">
                        <span>Clique para detalhes</span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9,18 15,12 9,6"></polyline>
                        </svg>
                    </div>
                </div>
            `;
        }).join('');
        
        listaMaquinas.innerHTML = html;
        
        console.log(`‚úÖ ${maquinas.length} m√°quinas calculadas`);
        
        // Tentar atualizar totais ap√≥s renderizar
        setTimeout(() => {
            atualizarTotaisProducao();
        }, 50);
    }

    // Fun√ß√£o para atualizar totais de produ√ß√£o
    function atualizarTotaisProducao() {
        console.log('üîÑ Iniciando atualiza√ß√£o de totais de produ√ß√£o...');
        
        // Contar materiais √∫nicos
        const listaMateriais = document.getElementById('listaMateriais');
        const materiaisCount = listaMateriais ? listaMateriais.querySelectorAll('.material-item').length : 0;
        console.log(`üì¶ Materiais encontrados: ${materiaisCount}`);
        
        // Contar m√°quinas envolvidas
        const listaMaquinas = document.getElementById('listaMaquinas');
        const maquinasCount = listaMaquinas ? listaMaquinas.querySelectorAll('.maquina-item').length : 0;
        console.log(`‚öôÔ∏è M√°quinas encontradas: ${maquinasCount}`);
        
        // Calcular tempo total
        let tempoTotalSegundos = 0;
        if (listaMaquinas) {
            console.log('üîç Buscando elementos de tempo...');
            
            // Primeiro, vamos ver todos os elementos strong dentro das m√°quinas
            const todosStrongs = listaMaquinas.querySelectorAll('strong');
            console.log(`üîç Total de elementos <strong> encontrados: ${todosStrongs.length}`);
            todosStrongs.forEach((strong, index) => {
                console.log(`Strong ${index}: "${strong.textContent}"`);
            });
            
            // Agora vamos tentar diferentes seletores
            let maquinasItems = listaMaquinas.querySelectorAll('.maquina-tempo-total strong');
            console.log(`üîç Elementos com '.maquina-tempo-total strong': ${maquinasItems.length}`);
            
            if (maquinasItems.length === 0) {
                // Tentar outros seletores
                maquinasItems = listaMaquinas.querySelectorAll('.maquina-item strong');
                console.log(`üîç Elementos com '.maquina-item strong': ${maquinasItems.length}`);
            }
            
            if (maquinasItems.length === 0) {
                // Tentar pegar todos os strong que cont√™m texto de tempo
                const allStrongs = listaMaquinas.querySelectorAll('strong');
                maquinasItems = Array.from(allStrongs).filter(strong => {
                    const texto = strong.textContent.trim();
                    return texto.match(/\d+h\s+\d+m\s+\d+s/);
                });
                console.log(`üîç Elementos <strong> com formato de tempo: ${maquinasItems.length}`);
            }
            
            maquinasItems.forEach((item, index) => {
                const texto = item.textContent.trim();
                console.log(`‚è∞ Processando tempo ${index + 1}: "${texto}"`);
                
                // Parse do formato "0h 0m 0s"
                const horasMatch = texto.match(/(\d+)h/);
                const minutosMatch = texto.match(/(\d+)m/);
                const segundosMatch = texto.match(/(\d+)s/);
                
                const horas = horasMatch ? parseInt(horasMatch[1]) : 0;
                const minutos = minutosMatch ? parseInt(minutosMatch[1]) : 0;
                const segundos = segundosMatch ? parseInt(segundosMatch[1]) : 0;
                
                console.log(`‚è∞ Tempo parseado: ${horas}h ${minutos}m ${segundos}s`);
                tempoTotalSegundos += (horas * 3600) + (minutos * 60) + segundos;
            });
        }
        
        console.log(`‚è∞ Tempo total em segundos: ${tempoTotalSegundos}`);
        
        // Converter segundos para h:m:s
        const horasTotal = Math.floor(tempoTotalSegundos / 3600);
        const minutosTotal = Math.floor((tempoTotalSegundos % 3600) / 60);
        const segundosTotal = tempoTotalSegundos % 60;
        
        // Atualizar elementos
        const totalMateriaisElement = document.getElementById('totalMateriaisUnicos');
        const tempoTotalElement = document.getElementById('tempoTotalProducao');
        const totalMaquinasElement = document.getElementById('totalMaquinasEnvolvidas');
        
        if (totalMateriaisElement) {
            totalMateriaisElement.textContent = materiaisCount;
            console.log(`‚úÖ Materiais atualizados: ${materiaisCount}`);
        } else {
            console.error('‚ùå Elemento totalMateriaisUnicos n√£o encontrado');
        }
        
        if (tempoTotalElement) {
            tempoTotalElement.textContent = `${horasTotal}h ${minutosTotal}m ${segundosTotal}s`;
            console.log(`‚úÖ Tempo total atualizado: ${horasTotal}h ${minutosTotal}m ${segundosTotal}s`);
        } else {
            console.error('‚ùå Elemento tempoTotalProducao n√£o encontrado');
        }
        
        if (totalMaquinasElement) {
            totalMaquinasElement.textContent = maquinasCount;
            console.log(`‚úÖ M√°quinas atualizadas: ${maquinasCount}`);
        } else {
            console.error('‚ùå Elemento totalMaquinasEnvolvidas n√£o encontrado');
        }
        
        console.log(`üìä Totais finais: ${materiaisCount} materiais, ${maquinasCount} m√°quinas, ${horasTotal}h ${minutosTotal}m ${segundosTotal}s`);
    }

    // Fun√ß√£o para limpar dados de produ√ß√£o
    function limparDadosProducao() {
        const listaMateriais = document.getElementById('listaMateriais');
        const listaMaquinas = document.getElementById('listaMaquinas');
        
        if (listaMateriais) {
            listaMateriais.innerHTML = `
                <div class="no-materials">
                    <p>Nenhum material encontrado</p>
                    <p class="sub-text">Adicione produtos com materiais especificados para ver o resumo</p>
                </div>
            `;
        }
        
        if (listaMaquinas) {
            listaMaquinas.innerHTML = `
                <div class="no-machines">
                    <p>Nenhuma m√°quina identificada</p>
                    <p class="sub-text">Adicione produtos com etapas de produ√ß√£o para ver o tempo necess√°rio</p>
                </div>
            `;
        }
        
        // Resetar totais
        const totalMateriaisElement = document.getElementById('totalMateriaisUnicos');
        const tempoTotalElement = document.getElementById('tempoTotalProducao');
        const totalMaquinasElement = document.getElementById('totalMaquinasEnvolvidas');
        
        if (totalMateriaisElement) totalMateriaisElement.textContent = '0';
        if (tempoTotalElement) tempoTotalElement.textContent = '0h 0m 0s';
        if (totalMaquinasElement) totalMaquinasElement.textContent = '0';
    }

    // Fun√ß√£o para exibir erro nos materiais
    function exibirErroMateriais() {
        const listaMateriais = document.getElementById('listaMateriais');
        if (listaMateriais) {
            listaMateriais.innerHTML = `
                <div class="no-materials">
                    <p>Erro ao carregar materiais</p>
                    <p class="sub-text">Verifique se os produtos t√™m materiais cadastrados</p>
                </div>
            `;
        }
    }

    // Fun√ß√£o para exibir erro nas m√°quinas
    function exibirErroMaquinas() {
        const listaMaquinas = document.getElementById('listaMaquinas');
        if (listaMaquinas) {
            listaMaquinas.innerHTML = `
                <div class="no-machines">
                    <p>Erro ao carregar dados de m√°quinas</p>
                    <p class="sub-text">Verifique se os produtos t√™m etapas de produ√ß√£o cadastradas</p>
                </div>
            `;
        }
    }

    // Fun√ß√£o para gerar HTML dos produtos com cores alternadas apenas para impress√£o
    function gerarHtmlProdutosParaImpressao() {
        // Fun√ß√£o local para formatar moeda (garantir que esteja dispon√≠vel)
        const formatarMoeda = (valor) => {
            if (valor === null || valor === undefined || valor === '' || isNaN(valor)) {
                valor = 0;
            }
            
            if (typeof valor === 'string') {
                valor = parseFloat(valor.replace(/[^\d.,]/g, '').replace(',', '.'));
            }
            
            if (isNaN(valor)) {
                valor = 0;
            }
            
            return valor.toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        };
        
        if (!itensOrcamento || itensOrcamento.length === 0) {
            return `
                <div class="no-products">
                    <p>Nenhum produto adicionado ao or√ßamento</p>
                    <p class="sub-text">Adicione produtos na aba "Itens/Servi√ßos" para visualizar o descritivo</p>
                </div>
            `;
        }

        let html = '';
        itensOrcamento.forEach((item, index) => {
            // Cores alternadas: branco (par) e roxo da marca (√≠mpar)
            const isEven = index % 2 === 0;
            const backgroundColor = isEven ? '#ffffff' : 'rgba(155, 100, 227, 0.15)';
            const textColor = isEven ? '#333' : '#333';
            const headerTextColor = isEven ? '#9B64E3' : '#7B4BAB';
            
            // Criar HTML para detalhes do produto se houver informa√ß√µes dispon√≠veis
            let detalhesHTML = '';
            const detalhes = [];
            
            // Adicionar detalhes se dispon√≠veis (estas informa√ß√µes viriam dos dados do produto)
            if (item.dimensoes) detalhes.push({ label: 'Dimens√µes', valor: item.dimensoes });
            if (item.peso) detalhes.push({ label: 'Peso', valor: item.peso });
            if (item.material) detalhes.push({ label: 'Material', valor: item.material });
            
            if (detalhes.length > 0) {
                detalhesHTML = `
                    <div class="produto-detalhes">
                        ${detalhes.map(detalhe => `
                            <div class="detalhe-item">
                                <span class="detalhe-label">${detalhe.label}</span>
                                <span class="detalhe-valor">${detalhe.valor}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            html += `
                <div class="produto-descritivo" style="background-color: ${backgroundColor} !important; color: ${textColor} !important;">
                    <div class="produto-header">
                        <div class="produto-info">
                            <h3 class="produto-nome" style="color: ${headerTextColor} !important;">${item.nome}</h3>
                            <div class="produto-quantidade" style="color: ${textColor} !important;">
                                Quantidade: <strong>${item.quantidade} ${item.unidade || 'un'}</strong>
                            </div>
                        </div>
                        <div class="produto-valor">
                            <div class="valor-total" style="color: ${textColor} !important;">
                                ${item.desconto && item.desconto > 0 ? 
                                    `<div class="valor-original" style="text-decoration: line-through; color: #666; font-size: 11px;">
                                        ${formatarMoeda(item.quantidade * item.preco_unitario)}
                                    </div>
                                    <div class="valor-com-desconto">
                                        ${formatarMoeda(item.total)}
                                    </div>
                                    <div class="desconto-aplicado" style="color: #e74c3c; font-size: 11px;">
                                        Desconto: ${item.desconto}%
                                    </div>` :
                                    `${formatarMoeda(item.total)}`
                                }
                            </div>
                            <div class="valor-unitario" style="color: ${textColor} !important;">
                                Unit: ${formatarMoeda(item.preco_unitario)}
                            </div>
                        </div>
                    </div>
                    
                    ${item.descricao ? `
                        <div class="produto-descricao" style="color: ${textColor} !important;">
                            <strong>Descri√ß√£o:</strong> ${item.descricao}
                        </div>
                    ` : ''}
                    
                    ${detalhes.length > 0 ? detalhesHTML : ''}
                </div>
            `;
        });
        
        return html;
    }

    // Fun√ß√£o para imprimir o descritivo do or√ßamento
    function imprimirDescritivo(event) {
        // Prevenir comportamento padr√£o do bot√£o/formul√°rio
        if (event) {
            event.preventDefault();
            event.stopPropagation();
        }
        
        // Fun√ß√£o local para formatar moeda (caso n√£o esteja dispon√≠vel no contexto)
        const formatarMoeda = (valor) => {
            if (valor === null || valor === undefined || valor === '' || isNaN(valor)) {
                valor = 0;
            }
            
            if (typeof valor === 'string') {
                valor = parseFloat(valor.replace(/[^\d.,]/g, '').replace(',', '.'));
            }
            
            if (isNaN(valor)) {
                valor = 0;
            }
            
            return valor.toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        };
        
        // Verificar se h√° itens no or√ßamento
        if (!itensOrcamento || itensOrcamento.length === 0) {
            showErrorModal('Nenhum produto para imprimir', 'N√£o h√° produtos no or√ßamento para imprimir.');
            return;
        }
        
        // Obter dados do or√ßamento atual
        const clienteButton = document.querySelector('#cliente button');
        let cliente = 'Cliente n√£o selecionado';
        
        // Verificar se h√° cliente selecionado no dropdown
        if (clienteButton && clienteButton.textContent && clienteButton.textContent.trim() !== 'Selecione o Cliente') {
            cliente = clienteButton.textContent.trim();
        }
        
        // Se ainda n√£o encontrou, tentar buscar de outras formas (input hidden ou data attribute)
        if (cliente === 'Cliente n√£o selecionado') {
            const clienteDataValue = clienteButton?.getAttribute('data-value');
            const clienteDataText = clienteButton?.getAttribute('data-text');
            if (clienteDataText) {
                cliente = clienteDataText;
            } else if (clienteDataValue) {
                cliente = `Cliente ID: ${clienteDataValue}`;
            }
        }
            
        // Obter vendedor selecionado
        const vendedorInput = document.getElementById('vendedor');
        const vendedor = vendedorInput && vendedorInput.value && vendedorInput.value.trim() !== '' 
            ? vendedorInput.value 
            : 'Vendedor n√£o selecionado';
            
        // Obter condi√ß√µes de pagamento
        const condicoesButton = document.querySelector('#condicoesPagamento button');
        const condicoesPagamento = condicoesButton && condicoesButton.textContent !== 'Selecionar condi√ß√£o'
            ? condicoesButton.textContent
            : 'N√£o informado';
            
        // Obter parcelas se for cr√©dito
        const valorParcelas = obterValorDropdown('parcelas');
        const textoButton = document.querySelector('#parcelas button')?.textContent || '';
        const parcelas = valorParcelas && !textoButton.includes('Selecione')
            ? textoButton
            : '';
            
        // Obter n√∫mero do or√ßamento
        const numeroOrcamento = document.getElementById('numeroOrcamento')?.value || 'N√£o informado';
        
        // Obter prazo de entrega do campo do formul√°rio
        const prazoEntregaInput = document.getElementById('prazoEntrega');
        const prazoEntrega = prazoEntregaInput && prazoEntregaInput.value.trim() !== '' 
            ? prazoEntregaInput.value 
            : '15 dias √∫teis'; // Padr√£o
            
        const dataOrcamento = new Date().toLocaleDateString('pt-BR');
        const totalItensElement = document.getElementById('descritivoTotalItens');
        const valorTotalElement = document.getElementById('descritivoValorTotal');
        const totalItens = totalItensElement ? totalItensElement.textContent : '0';
        const valorTotal = valorTotalElement ? valorTotalElement.textContent : 'R$ 0,00';        // Obter conte√∫do dos produtos com cores alternadas para impress√£o
        const produtos = gerarHtmlProdutosParaImpressao();
        
        // Calcular resumo financeiro
        let subtotalSemDesconto = 0;
        let totalComDesconto = 0;
        let totalDescontos = 0;
        
        itensOrcamento.forEach(item => {
            const valorSemDesconto = item.quantidade * item.preco_unitario;
            subtotalSemDesconto += valorSemDesconto;
            totalComDesconto += item.total;
            
            if (item.desconto && item.desconto > 0) {
                const valorDesconto = valorSemDesconto - item.total;
                totalDescontos += valorDesconto;
            }
        });
        
        const subtotalFormatado = formatarMoeda(subtotalSemDesconto);
        const totalComDescontoFormatado = formatarMoeda(totalComDesconto);
        const totalDescontosFormatado = formatarMoeda(totalDescontos);
        
        // Criar janela de impress√£o com configura√ß√µes otimizadas
        const printWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=no,resizable=no,location=no,menubar=no,toolbar=no,status=no');
        
        if (!printWindow) {
            showErrorModal('Erro na impress√£o', 'N√£o foi poss√≠vel abrir a janela de impress√£o. Verifique se o bloqueador de pop-ups est√° desabilitado.');
            return;
        }
        
        const printContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title></title>
                <style>
                    * {
                        margin: 0;
                        padding: 0;
                        box-sizing: border-box;
                        -webkit-print-color-adjust: exact !important;
                        color-adjust: exact !important;
                    }
                    
                    body {
                        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                        line-height: 1.2;
                        color: #333;
                        padding: 0;
                        margin: 0;
                        background: white;
                        font-size: 12px;
                        overflow: hidden;
                    }
                    
                    .document-container {
                        max-width: 210mm;
                        margin: 0 auto;
                        padding: 8mm;
                        background: white;
                        page-break-after: avoid;
                        overflow: hidden;
                    }
                    
                    /* Cabe√ßalho com logo */
                    .document-header {
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        margin-bottom: 8px;
                        padding-bottom: 6px;
                        border-bottom: 2px solid #9B64E3;
                    }
                    
                    .logo-section {
                        display: flex;
                        align-items: center;
                        gap: 6px;
                    }
                    
                    .logo {
                        width: 35px;
                        height: 35px;
                    }
                    
                    .company-info {
                        display: flex;
                        flex-direction: column;
                    }
                    
                    .company-name {
                        font-size: 18px;
                        font-weight: bold;
                        color: #2B0261;
                        margin-bottom: 1px;
                        letter-spacing: 0.5px;
                    }
                    
                    .company-tagline {
                        font-size: 10px;
                        color: #9B64E3;
                        font-weight: 500;
                    }
                    
                    .document-title {
                        text-align: right;
                        color: #2B0261;
                    }
                    
                    .document-title h1 {
                        font-size: 14px;
                        margin-bottom: 1px;
                        color: #2B0261;
                    }
                    
                    .document-subtitle {
                        font-size: 9px;
                        color: #9B64E3;
                    }
                    
                    /* Informa√ß√µes do or√ßamento */
                    .orcamento-info {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 8px;
                        margin-bottom: 8px;
                        padding: 6px;
                        background: linear-gradient(135deg, #f8f6ff 0%, #ffffff 100%);
                        border-radius: 4px;
                        border: 1px solid #e0e0e0;
                    }
                    
                    .info-section h3 {
                        color: #2B0261;
                        font-size: 10px;
                        margin-bottom: 3px;
                        border-bottom: 1px solid #9B64E3;
                        padding-bottom: 1px;
                        line-height: 1.1;
                    }
                    
                    .info-item {
                        display: flex;
                        justify-content: space-between;
                        margin-bottom: 2px;
                        padding: 0;
                        line-height: 1.1;
                    }
                    
                    .info-label {
                        font-weight: 600;
                        color: #555;
                        font-size: 9px;
                    }
                    
                    .info-value {
                        color: #2B0261;
                        font-weight: 500;
                        font-size: 9px;
                    }
                    
                    /* Se√ß√£o de produtos */
                    .produtos-section {
                        margin-bottom: 8px;
                    }
                    
                    .section-title {
                        font-size: 12px;
                        color: #2B0261;
                        margin-bottom: 4px;
                        padding: 2px 0;
                        border-bottom: 1px solid #9B64E3;
                        display: flex;
                        align-items: center;
                        gap: 4px;
                        line-height: 1.1;
                    }
                    
                    .section-icon {
                        width: 14px;
                        height: 14px;
                        background: #9B64E3;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-weight: bold;
                        font-size: 8px;
                    }
                    
                    .produto-descritivo {
                        margin-bottom: 