<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDV - Midnight (iOS 12 Compatible)</title>
    <style>
        :root {
            --primary-color: #9B64E3;
            --primary-dark: #7B4AC3;
            --text-color: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --background-dark: #1a1a1a;
            --card-bg: rgba(155, 100, 227, 0.05);
            --border-color: #9B64E3;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background-dark);
            color: var(--text-color);
        }

        .pdv-container {
            padding: 20px;
            margin-top: 70px;
        }

        .pdv-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            min-height: calc(100vh - 200px);
        }

        @media (max-width: 768px) {
            .pdv-content {
                grid-template-columns: 1fr;
            }
        }

        .product-list {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 0 15px rgba(155, 100, 227, 0.1);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .search-container {
            display: flex;
            gap: 10px;
            padding: 10px;
            background: rgba(82, 40, 136, 0.4);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(155, 100, 227, 0.2);
        }

        .search-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(155, 100, 227, 0.3);
            background: rgba(255, 255, 255, 0.15);
        }

        .search-buttons {
            display: flex;
            gap: 8px;
        }

        .barcode-btn {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: rgba(155, 100, 227, 0.1);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .barcode-btn:hover {
            background: rgba(155, 100, 227, 0.2);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            padding: 10px;
            overflow-y: auto;
            max-height: calc(100vh - 250px);
        }

        .product-card {
            background: rgba(82, 40, 136, 0.4);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 5px rgba(155, 100, 227, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 10px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 25px rgba(155, 100, 227, 0.4);
            background: rgba(82, 40, 136, 0.6);
        }

        .product-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 6px;
            background: #f0f0f0;
        }

        .product-name {
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
            font-size: 0.9rem;
            line-height: 1.2;
        }

        .product-price {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.1rem;
            margin: 0;
        }

        .product-stock {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .quantity-btn {
            width: 36px;
            height: 28px;
            border: 1px solid var(--border-color);
            background: rgba(155, 100, 227, 0.1);
            color: var(--text-color);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: bold;
        }

        .quantity-btn:hover {
            background: rgba(155, 100, 227, 0.2);
        }

        .quantity-input {
            width: 50px;
            text-align: center;
            border: 1px solid var(--border-color);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            border-radius: 4px;
            padding: 4px;
            font-size: 0.9rem;
        }

        .add-to-cart-btn {
            background: rgba(155, 100, 227, 0.2);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            border-radius: 4px;
            padding: 4px 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            min-height: 28px;
        }

        .add-to-cart-btn:hover {
            background: rgba(155, 100, 227, 0.3);
        }

        .cart-panel {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 0 15px rgba(155, 100, 227, 0.1);
            position: sticky;
            top: 90px;
            height: fit-content;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .cart-title {
            color: var(--text-color);
            margin: 0;
            font-size: 1.2em;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(155, 100, 227, 0.3);
        }

        .cart-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: calc(100vh - 350px);
            overflow-y: auto;
        }

        .cart-item {
            background: rgba(82, 40, 136, 0.2);
            border-radius: 6px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            border: 1px solid rgba(155, 100, 227, 0.3);
        }

        .cart-item-info {
            flex: 1;
            min-width: 0;
        }

        .cart-item-name {
            color: var(--text-color);
            font-size: 0.9em;
            margin: 0 0 5px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 5px 0;
        }

        .cart-quantity-btn {
            width: 24px;
            height: 24px;
            border: 1px solid var(--border-color);
            background: rgba(155, 100, 227, 0.1);
            color: var(--text-color);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: bold;
        }

        .cart-quantity {
            color: var(--text-color);
            font-weight: bold;
            min-width: 20px;
            text-align: center;
            font-size: 0.9em;
        }

        .cart-item-total {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 0.95em;
            text-align: right;
        }

        .cart-item-remove {
            background: rgba(255, 50, 50, 0.1);
            border: 1px solid rgba(255, 50, 50, 0.3);
            color: rgba(255, 50, 50, 0.8);
            border-radius: 4px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .cart-summary {
            margin-top: auto;
            padding-top: 15px;
            border-top: 1px solid rgba(155, 100, 227, 0.3);
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-color);
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .cart-total-value {
            color: var(--primary-color);
            font-weight: bold;
        }

        .checkout-btn {
            width: 100%;
            padding: 12px;
            background: rgba(155, 100, 227, 0.2);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .checkout-btn:hover {
            background: rgba(155, 100, 227, 0.3);
        }

        .cart-empty {
            color: var(--text-secondary);
            text-align: center;
            padding: 20px 0;
        }

        /* Loading indicator */
        .loading {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
        }

        /* Status messages */
        .status-message {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .status-success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #22c55e;
        }

        .status-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .debug-panel {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-width: 300px;
            z-index: 1000;
            display: none;
        }

        .debug-panel.show {
            display: block;
        }

        /* Favoritos */
        .favorites-container {
            margin-bottom: 20px;
            display: none;
        }

        .favorites-container.has-favorites {
            display: block;
        }

        .favorites-title {
            color: var(--text-color);
            font-size: 1.1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }

        .favorite-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(155, 100, 227, 0.2);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1;
        }

        .favorite-btn.active {
            background: rgba(255, 107, 107, 0.2);
            border-color: #ff6b6b;
            color: #ff6b6b;
        }

        .favorite-btn:hover {
            background: rgba(155, 100, 227, 0.3);
            transform: scale(1.1);
        }

        .favorite-btn.active:hover {
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
            color: #ff6b6b;
        }

        /* Se√ß√£o de Desconto */
        .discount-section {
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(155, 100, 227, 0.1);
            border: 1px solid rgba(155, 100, 227, 0.3);
            border-radius: 6px;
        }

        .discount-title {
            color: var(--text-color);
            font-size: 1em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .discount-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .discount-type-btn {
            flex: 1;
            padding: 8px 12px;
            background: transparent;
            border: 1px solid rgba(155, 100, 227, 0.5);
            color: var(--text-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .discount-type-btn.active {
            background: rgba(155, 100, 227, 0.3);
            border-color: var(--border-color);
        }

        .discount-type-btn:hover {
            background: rgba(155, 100, 227, 0.2);
        }

        .discount-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .discount-input {
            width: 100%;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(155, 100, 227, 0.3);
            color: var(--text-color);
            border-radius: 4px;
            font-size: 1em;
        }

        .discount-input:focus {
            outline: none;
            border-color: var(--border-color);
            box-shadow: 0 0 0 2px rgba(155, 100, 227, 0.2);
        }

        .discount-info {
            margin-top: 10px;
            padding: 8px;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 4px;
            color: #22c55e;
            font-size: 0.9em;
            display: none;
        }

        .subtotal-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-color);
            font-size: 0.95em;
            margin-bottom: 5px;
        }

        .discount-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #22c55e;
            font-size: 0.95em;
            margin-bottom: 5px;
            display: none;
        }

        /* Modal de Checkout */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.4);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow: hidden;
            padding: 10px;
            box-sizing: border-box;
        }

        .modal-overlay.show {
            display: flex;
        }

        .checkout-modal {
            background-color: rgba(59, 12, 121, 0.29);
            color: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            max-width: min(950px, 100vw - 40px);
            width: 95%;
            max-height: 85vh;
            margin-top: 80px;
            overflow-y: auto;
            overflow-x: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(155, 100, 227, 0.3);
            flex-shrink: 0;
        }

        .modal-title {
            color: white;
            font-size: 1.5em;
            font-weight: bold;
            margin: 0;
        }

        .modal-close {
            background: transparent;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
            position: absolute;
            right: 15px;
            top: 15px;
        }

        .modal-close:hover {
            color: var(--border-color);
            text-shadow: 0 0 8px rgba(155, 100, 227, 0.8);
        }

        .checkout-section {
            margin-bottom: 15px;
            box-sizing: border-box;
            width: 100%;
            min-width: 0;
        }

        .checkout-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            min-height: 0;
            width: 100%;
            box-sizing: border-box;
        }

        @media (max-width: 768px) {
            .checkout-content {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .checkout-modal {
                width: 95%;
                max-height: 90vh;
                margin-top: 20px;
            }
        }

        .section-title {
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 12px;
            width: 100%;
            box-sizing: border-box;
        }

        .payment-method {
            padding: 12px;
            background: rgba(155, 100, 227, 0.1);
            border: 2px solid rgba(155, 100, 227, 0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            color: white;
            min-height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
            width: 100%;
            min-width: 0;
        }

        .payment-method:hover {
            background: rgba(155, 100, 227, 0.2);
        }

        .payment-method.selected {
            background: rgba(155, 100, 227, 0.3);
            border-color: var(--border-color);
        }

        .payment-method-icon {
            font-size: 1.5em;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 24px;
        }

        .installments-section {
            display: none;
            margin-top: 15px;
        }

        .installments-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .installment-option {
            padding: 10px;
            background: rgba(155, 100, 227, 0.1);
            border: 1px solid rgba(155, 100, 227, 0.3);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            color: white;
            font-size: 0.9em;
        }

        .installment-option:hover {
            background: rgba(155, 100, 227, 0.2);
        }

        .installment-option.selected {
            background: rgba(155, 100, 227, 0.3);
            border-color: var(--border-color);
        }

        .cash-section {
            display: none;
            margin-top: 10px;
            background: rgba(155, 100, 227, 0.1);
            border: 1px solid rgba(155, 100, 227, 0.3);
            border-radius: 8px;
            padding: 15px;
            width: 100%;
            box-sizing: border-box;
        }

        .seller-section {
            margin-top: 12px;
            background: rgba(155, 100, 227, 0.1);
            border: 1px solid rgba(155, 100, 227, 0.3);
            border-radius: 8px;
            padding: 15px;
            width: 100%;
            box-sizing: border-box;
        }

        .seller-select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(155, 100, 227, 0.5);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1.0em;
            box-sizing: border-box;
        }

        .seller-select:focus {
            outline: none;
            border-color: var(--border-color);
            box-shadow: 0 0 8px rgba(155, 100, 227, 0.5);
        }

        .cash-input-group {
            margin-bottom: 10px;
        }

        .cash-input-group label {
            display: block;
            color: white;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .cash-input {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(155, 100, 227, 0.5);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1.1em;
            text-align: center;
            box-sizing: border-box;
        }

        .cash-input:focus {
            outline: none;
            border-color: var(--border-color);
            box-shadow: 0 0 8px rgba(155, 100, 227, 0.5);
        }

        .troco-display {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid #22c55e;
            border-radius: 6px;
            padding: 10px;
            text-align: center;
            margin-top: 8px;
        }

        .troco-display.negative {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
        }

        .troco-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #22c55e;
        }

        .troco-value.negative {
            color: #ef4444;
        }

        .troco-label {
            color: white;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .order-summary {
            background: rgba(155, 100, 227, 0.1);
            border: 1px solid rgba(155, 100, 227, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: white;
            font-size: 1em;
        }

        .summary-row.total {
            font-weight: bold;
            font-size: 1.2em;
            color: var(--border-color);
            padding-top: 12px;
            border-top: 1px solid rgba(155, 100, 227, 0.3);
            margin-top: 8px;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-shrink: 0;
        }

        .modal-btn {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
            min-height: 50px;
        }

        .modal-btn.cancel {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #ef4444;
        }

        .modal-btn.cancel:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .modal-btn.confirm {
            background: rgba(155, 100, 227, 0.2);
            border: 1px solid var(--border-color);
            color: white;
        }

        .modal-btn.confirm:hover:not(:disabled) {
            background: var(--border-color);
            box-shadow: 0 0 15px rgba(155, 100, 227, 0.8);
        }

        .modal-btn.confirm:disabled {
            background: rgba(155, 100, 227, 0.1);
            border-color: rgba(155, 100, 227, 0.3);
            color: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
        }

        /* Modal de Notifica√ß√£o PDV */
        .pdv-notification-modal {
            background-color: rgba(59, 12, 121, 0.29);
            color: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            max-height: 90vh;
            margin-top: 80px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            text-align: center;
        }

        .pdv-notification-modal .close-button {
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
            position: absolute;
            right: 15px;
            top: 15px;
        }

        .pdv-notification-modal .close-button:hover {
            color: var(--border-color);
            text-shadow: 0 0 8px rgba(155, 100, 227, 0.8);
        }

        .pdv-notification-modal h2 {
            color: white;
            font-size: 1.5em;
            font-weight: bold;
            margin: 0 0 15px 0;
            border-bottom: none;
        }

        .pdv-notification-modal p {
            color: white;
            font-size: 1.1em;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .pdv-notification-modal.success h2 {
            color: #4CAF50;
        }

        .pdv-notification-modal.error h2 {
            color: #F44336;
        }

        /* Anima√ß√µes */
        @keyframes addToCartAnimation {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
            100% {
                transform: scale(0.8);
                opacity: 0;
            }
        }

        .add-to-cart-animation {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <!-- Debug Panel -->
    <div id="debugPanel" class="debug-panel">
        <strong>Debug Info (iOS 12):</strong><br>
        <div id="debugContent"></div>
    </div>

    <div class="pdv-container">
        <div class="pdv-content">
            <!-- Lista de Produtos -->
            <div class="product-list">
                <div class="search-container">
                    <input type="text" id="productSearch" class="search-input" placeholder="Buscar produtos..." oninput="searchProducts(event)">
                    <div class="search-buttons">
                        <button class="barcode-btn" onclick="openBarcodeScanner()">üì∑</button>
                    </div>
                </div>

                <!-- Status de carregamento -->
                <div id="loadingStatus" class="status-message" style="display: none;"></div>

                <!-- Se√ß√£o de Favoritos -->
                <div id="favoritesContainer" class="favorites-container">
                    <div class="favorites-title">
                        ‚≠ê Favoritos
                    </div>
                    <div id="favoritesGrid" class="favorites-grid">
                    </div>
                </div>

                <!-- Grade de produtos -->
                <div id="productsGrid" class="products-grid">
                    <div class="loading">Carregando produtos...</div>
                </div>
            </div>

            <!-- Painel do Carrinho -->
            <div class="cart-panel">
                <h2 class="cart-title">üõí Carrinho</h2>
                
                <div id="cartItems" class="cart-items">
                    <div class="cart-empty">
                        Carrinho vazio<br>
                        <small>Clique nos produtos para adicionar</small>
                    </div>
                </div>

                <!-- Se√ß√£o de Desconto -->
                <div class="discount-section">
                    <div class="discount-title">üí∞ Desconto</div>
                    
                    <div class="discount-type-selector">
                        <button class="discount-type-btn active" data-type="percentage" onclick="setDiscountType('percentage')">%</button>
                        <button class="discount-type-btn" data-type="value" onclick="setDiscountType('value')">R$</button>
                    </div>
                    
                    <div class="discount-input-container">
                        <input type="number" id="discountInput" class="discount-input" placeholder="0" step="0.01" min="0" max="100" oninput="handleDiscountInput(this)">
                    </div>
                    
                    <div id="discountInfo" class="discount-info">
                        <span id="discountDescription">Desconto aplicado</span>
                    </div>
                </div>

                <div class="cart-summary">
                    <div id="cartSubtotal" class="subtotal-row">
                        <span>Subtotal:</span>
                        <span id="cartSubtotalValue">R$ 0,00</span>
                    </div>
                    
                    <div id="discountRow" class="discount-row">
                        <span>Desconto:</span>
                        <span id="discountAmount">- R$ 0,00</span>
                    </div>
                    
                    <div class="cart-total">
                        <span>Total:</span>
                        <span id="cartTotal" class="cart-total-value">R$ 0,00</span>
                    </div>
                    
                    <button id="checkoutBtn" class="checkout-btn" onclick="checkout()" disabled>
                        Finalizar Compra
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Checkout -->
    <div class="modal-overlay" id="checkoutModal">
        <div class="checkout-modal">
            <div class="modal-header">
                <h2 class="modal-title">Finalizar Venda</h2>
                <button class="modal-close" onclick="closeCheckoutModal()">&times;</button>
            </div>

            <div class="checkout-content">
                <!-- M√©todo de Pagamento -->
                <div class="checkout-section">
                    <div class="section-title">M√©todo de Pagamento</div>
                    <div class="payment-methods">
                        <div class="payment-method" data-method="dinheiro" onclick="selectPaymentMethod('dinheiro')">
                            <div class="payment-method-icon">üíµ</div>
                            Dinheiro
                        </div>
                        <div class="payment-method" data-method="debito" onclick="selectPaymentMethod('debito')">
                            <div class="payment-method-icon">üí≥</div>
                            D√©bito
                        </div>
                        <div class="payment-method" data-method="credito" onclick="selectPaymentMethod('credito')">
                            <div class="payment-method-icon">üí≥</div>
                            Cr√©dito
                        </div>
                        <div class="payment-method" data-method="pix" onclick="selectPaymentMethod('pix')">
                            <div class="payment-method-icon">üì±</div>
                            PIX
                        </div>
                    </div>

                    <!-- Se√ß√£o de Parcelamento (apenas para cr√©dito) -->
                    <div id="installmentsSection" class="installments-section">
                        <div class="section-title">Parcelamento</div>
                        <div id="installmentsGrid" class="installments-grid">
                        </div>
                    </div>

                    <!-- Se√ß√£o de Dinheiro -->
                    <div id="cashSection" class="cash-section">
                        <div class="cash-input-group">
                            <label for="valorRecebido">Valor Recebido</label>
                            <input type="text" id="valorRecebido" class="cash-input" placeholder="R$ 0,00" oninput="formatCashInput(this); calculateChange();">
                        </div>
                        <div id="trocoDisplay" class="troco-display" style="display: none;">
                            <div class="troco-label">Troco</div>
                            <div id="trocoValue" class="troco-value">R$ 0,00</div>
                        </div>
                    </div>

                    <!-- Se√ß√£o de Vendedor -->
                    <div class="seller-section">
                        <div class="section-title">Vendedor</div>
                        <select id="checkoutSellerSelect" class="seller-select">
                            <option value="">Carregando vendedores...</option>
                        </select>
                    </div>
                </div>

                <!-- Resumo do Pedido -->
                <div class="checkout-section">
                    <div class="section-title">Resumo do Pedido</div>
                    <div class="order-summary" id="orderSummary">
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button class="modal-btn cancel" onclick="closeCheckoutModal()">Cancelar</button>
                <button class="modal-btn confirm" id="confirmSaleBtn" onclick="confirmSale()" disabled>Confirmar Venda</button>
            </div>
        </div>
    </div>

    <!-- Modal de Notifica√ß√£o PDV -->
    <div id="pdvNotificationModal" class="modal-overlay">
        <div class="pdv-notification-modal">
            <span class="close-button" onclick="closePdvNotificationModal()">&times;</span>
            <div id="pdvNotificationIcon" style="margin: 0 auto 20px; width: 64px; height: 64px;"></div>
            <h2 id="pdvNotificationModalTitle"></h2>
            <p id="pdvNotificationModalMessage"></p>
            <button class="modal-btn confirm" onclick="closePdvNotificationModal()">OK</button>
        </div>
    </div>

    <script>
        console.log('[PDV-iOS12] üöÄ Script iniciado - Verificando compatibilidade...');
        
        // Verificar se √© iOS 12
        var userAgent = navigator.userAgent;
        var isIOS12 = /iPad.*CPU.*OS 12_/.test(userAgent);
        console.log('[PDV-iOS12] User Agent:', userAgent);
        console.log('[PDV-iOS12] Detectado iOS 12:', isIOS12);

        // Vari√°veis globais ES5
        var products = [];
        var cart = [];
        var searchTimeout = null;
        var selectedUserId = null;
        var favorites = [];
        var usuarioLogado = null;
        var checkoutData = {
            paymentMethod: null,
            installments: 1,
            valorRecebido: 0,
            troco: 0
        };
        var currentDiscount = {
            type: 'percentage',
            amount: 0,
            appliedValue: 0
        };

        // SVG padr√£o para produtos
        var defaultProductImage = 'data:image/svg+xml;base64,' + btoa(
            '<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">' +
                '<rect width="100" height="100" fill="#f0f0f0"/>' +
                '<text x="50" y="50" text-anchor="middle" dy=".3em" fill="#999" font-size="12">Produto</text>' +
            '</svg>'
        );

        // Fun√ß√£o de debug
        function debugLog(message) {
            console.log('[PDV-iOS12] ' + message);
            
            var debugPanel = document.getElementById('debugPanel');
            var debugContent = document.getElementById('debugContent');
            
            if (debugContent) {
                var timestamp = new Date().toLocaleTimeString();
                debugContent.innerHTML = timestamp + ': ' + message + '<br>' + debugContent.innerHTML;
                
                // Mostrar painel em caso de erro ou warning
                if (message.indexOf('‚ùå') !== -1 || message.indexOf('‚ö†Ô∏è') !== -1) {
                    debugPanel.classList.add('show');
                }
            }
        }

        // Fun√ß√£o para carregar produtos (ES5 puro)
        function loadProducts(search) {
            if (typeof search === 'undefined') {
                search = '';
            }

            debugLog('üì¶ Iniciando carregamento de produtos... Busca: "' + search + '"');
            
            var loadingStatus = document.getElementById('loadingStatus');
            if (loadingStatus) {
                loadingStatus.innerHTML = 'Carregando produtos...';
                loadingStatus.className = 'status-message';
                loadingStatus.style.display = 'block';
            }

            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/api/produtos', true);
            
            xhr.onreadystatechange = function() {
                debugLog('üì° XHR State Change - ReadyState: ' + xhr.readyState + ', Status: ' + xhr.status);
                
                if (xhr.readyState === 4) {
                    debugLog('üì° Response recebido - Status: ' + xhr.status);
                    debugLog('üì° Response Text Length: ' + (xhr.responseText ? xhr.responseText.length : 0));
                    debugLog('üì° Response Text Preview: ' + (xhr.responseText ? xhr.responseText.substring(0, 200) : 'vazio'));
                    
                    if (xhr.status === 200) {
                        try {
                            var response = JSON.parse(xhr.responseText);
                            debugLog('‚úÖ JSON parseado - Status: ' + response.status);
                            debugLog('‚úÖ Produtos encontrados: ' + (response.produtos ? response.produtos.length : 0));
                            
                            if (response.status === 'success' && response.produtos) {
                                products = response.produtos;
                                debugLog('‚úÖ Products array atualizado: ' + products.length + ' produtos');
                                renderProducts(search);
                                if (loadingStatus) loadingStatus.style.display = 'none';
                            } else {
                                showError('‚ùå Erro na resposta da API: ' + (response.message || 'Status n√£o √© success ou produtos undefined'));
                            }
                        } catch (e) {
                            debugLog('‚ùå Erro detalhado ao fazer parse do JSON: ' + e.message);
                            debugLog('‚ùå Response text que causou erro: ' + xhr.responseText);
                            showError('‚ùå Erro ao fazer parse do JSON: ' + e.message);
                        }
                    } else {
                        debugLog('‚ùå Erro HTTP detalhado - Status: ' + xhr.status + ', StatusText: ' + xhr.statusText);
                        showError('‚ùå Erro HTTP: ' + xhr.status + ' - ' + xhr.statusText);
                    }
                }
            };

            xhr.onerror = function() {
                debugLog('‚ùå Erro de conex√£o - Network Error');
                showError('‚ùå Erro de conex√£o com o servidor');
            };

            xhr.ontimeout = function() {
                debugLog('‚ùå Timeout na requisi√ß√£o');
                showError('‚ùå Timeout na requisi√ß√£o');
            };

            debugLog('üì° Enviando requisi√ß√£o para /api/produtos...');
            xhr.send();
        }

        // Fun√ß√£o para renderizar produtos
        function renderProducts(search) {
            debugLog('üé® === INICIANDO RENDERIZA√á√ÉO DE PRODUTOS ===');
            debugLog('üé® Search term: "' + (search || '') + '"');
            debugLog('üé® Products array length: ' + products.length);
            
            var productsGrid = document.getElementById('productsGrid');
            var favoritesContainer = document.getElementById('favoritesContainer');
            var favoritesGrid = document.getElementById('favoritesGrid');
            
            debugLog('üé® DOM Elements found:');
            debugLog('üé® - productsGrid: ' + !!productsGrid);
            debugLog('üé® - favoritesContainer: ' + !!favoritesContainer);
            debugLog('üé® - favoritesGrid: ' + !!favoritesGrid);
            
            if (!productsGrid) {
                debugLog('‚ùå Elemento productsGrid n√£o encontrado!');
                return;
            }

            debugLog('üé® Limpando grids existentes...');
            productsGrid.innerHTML = '';
            if (favoritesGrid) favoritesGrid.innerHTML = '';

            debugLog('üé® Renderizando produtos... Total: ' + products.length);

            var filteredProducts = products;
            
            debugLog('üé® Pulando favoritos por enquanto para simplificar...');
            // Esconder se√ß√£o de favoritos por enquanto
            if (favoritesContainer) {
                favoritesContainer.classList.remove('has-favorites');
            }

            // Aplicar filtro de busca se necess√°rio
            if (search && search.trim()) {
                filteredProducts = [];
                var searchLower = search.toLowerCase();
                
                for (var i = 0; i < products.length; i++) {
                    var product = products[i];
                    if (product.nome && product.nome.toLowerCase().indexOf(searchLower) !== -1) {
                        filteredProducts.push(product);
                    }
                }
                debugLog('üîç Filtrado por "' + search + '": ' + filteredProducts.length + ' produtos');
            }

            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = '<div class="cart-empty" style="grid-column: 1/-1;">Nenhum produto encontrado</div>';
                return;
            }

            // Criar cards dos produtos
            debugLog('üé® Criando ' + filteredProducts.length + ' cards de produtos...');
            for (var j = 0; j < filteredProducts.length; j++) {
                var product = filteredProducts[j];
                debugLog('üé® Criando card para produto: ' + (product.nome || 'sem nome') + ' (ID: ' + product.id + ')');
                createProductCard(product, productsGrid);
            }

            debugLog('‚úÖ ' + filteredProducts.length + ' produtos renderizados com sucesso!');
            debugLog('üé® === FIM DA RENDERIZA√á√ÉO DE PRODUTOS ===');
        }

        // Fun√ß√£o para criar card do produto
        function createProductCard(product, container) {
            debugLog('üéØ Criando card para produto: ' + (product.nome || 'sem nome'));
            debugLog('üéØ Product data: ' + JSON.stringify(product).substring(0, 100) + '...');
            
            if (!container) {
                debugLog('‚ùå Container n√£o fornecido para createProductCard');
                return;
            }
            
            var card = document.createElement('div');
            card.className = 'product-card';
            
            var price = parseFloat(product.preco) || 0;
            var priceFormatted = formatCurrency(price);
            var productId = 'product-' + product.id;
            
            debugLog('üéØ Price: ' + price + ' -> ' + priceFormatted);
            debugLog('üéØ Product ID: ' + productId);
            
            // Simplificado sem favoritos por enquanto
            card.innerHTML = 
                '<img src="' + defaultProductImage + '" alt="' + (product.nome || '') + '" class="product-image">' +
                '<h3 class="product-name">' + (product.nome || 'Produto sem nome') + '</h3>' +
                '<p class="product-price">' + priceFormatted + '</p>' +
                '<p class="product-stock">Estoque: ' + (product.estoque || 0) + '</p>' +
                '<div class="quantity-controls">' +
                    '<button class="quantity-btn" onclick="decrementQuantity(\'' + productId + '\')">‚àí</button>' +
                    '<input type="number" id="' + productId + '-qty" class="quantity-input" value="1" min="1" max="' + (product.estoque || 999) + '" onchange="validateQuantity(\'' + productId + '\')">' +
                    '<button class="quantity-btn" onclick="incrementQuantity(\'' + productId + '\')">+</button>' +
                    '<button class="add-to-cart-btn" onclick="addToCartWithQuantity(\'' + product.id + '\', \'' + productId + '\')">üõí</button>' +
                '</div>';
            
            debugLog('üéØ Card HTML criado, tamanho: ' + card.innerHTML.length);
            
            // Adicionar event listener para clique no card (simplificado)
            card.addEventListener('click', function(event) {
                debugLog('üéØ Card clicado!');
                if (!event.target.closest('.quantity-controls')) {
                    addToCartSingle(product.id, product);
                }
            });
            
            debugLog('üéØ Adicionando card ao container...');
            container.appendChild(card);
            debugLog('üéØ ‚úÖ Card criado e adicionado com sucesso!');
        }

        // Fun√ß√µes de controle de quantidade
        function validateQuantity(productId) {
            var input = document.getElementById(productId + '-qty');
            if (!input) return;
            
            var value = parseInt(input.value) || 1;
            var max = parseInt(input.max) || 999;
            
            if (value < 1) value = 1;
            if (value > max) value = max;
            
            input.value = value;
        }

        function incrementQuantity(productId) {
            var input = document.getElementById(productId + '-qty');
            if (!input) return;
            
            var current = parseInt(input.value) || 1;
            var max = parseInt(input.max) || 999;
            
            if (current < max) {
                input.value = current + 1;
            }
        }

        function decrementQuantity(productId) {
            var input = document.getElementById(productId + '-qty');
            if (!input) return;
            
            var current = parseInt(input.value) || 1;
            
            if (current > 1) {
                input.value = current - 1;
            }
        }

        // Fun√ß√£o para adicionar ao carrinho com quantidade espec√≠fica
        function addToCartWithQuantity(productId, productElementId) {
            debugLog('üõí Adicionando produto ao carrinho com quantidade: ID ' + productId);
            
            // Encontrar o produto
            var product = null;
            for (var i = 0; i < products.length; i++) {
                if (products[i].id == productId) {
                    product = products[i];
                    break;
                }
            }
            
            if (!product) {
                debugLog('‚ùå Produto n√£o encontrado: ' + productId);
                return;
            }

            // Pegar quantidade
            var quantityInput = document.getElementById(productElementId + '-qty');
            var quantity = quantityInput ? parseInt(quantityInput.value) || 1 : 1;

            // Verificar se produto j√° est√° no carrinho
            var existingItem = null;
            for (var j = 0; j < cart.length; j++) {
                if (cart[j].id == productId) {
                    existingItem = cart[j];
                    break;
                }
            }

            var maxStock = product.estoque || 999;
            if (existingItem) {
                var newTotal = existingItem.quantity + quantity;
                if (newTotal > maxStock) {
                    alert('Estoque insuficiente! Dispon√≠vel: ' + maxStock);
                    return;
                }
                existingItem.quantity = newTotal;
                debugLog('üìà Quantidade atualizada: ' + existingItem.nome + ' -> ' + existingItem.quantity);
            } else {
                if (quantity > maxStock) {
                    alert('Estoque insuficiente! Dispon√≠vel: ' + maxStock);
                    return;
                }
                cart.push({
                    id: product.id,
                    nome: product.nome,
                    preco: parseFloat(product.preco) || 0,
                    quantity: quantity,
                    estoque: product.estoque || 0
                });
                debugLog('‚úÖ Produto adicionado: ' + product.nome + ' (Qtd: ' + quantity + ')');
            }

            // Feedback visual
            var addButton = document.querySelector('#' + productElementId + '-qty').nextElementSibling.nextElementSibling;
            var cartPanel = document.querySelector('.cart-panel');
            
            if (addButton) {
                addButton.style.background = 'rgba(155, 100, 227, 0.4)';
                setTimeout(function() {
                    addButton.style.background = '';
                }, 200);
                createAddToCartAnimation(addButton, cartPanel);
            }

            applyDiscountAutomatically();
            updateCartDisplay();
            
            // Reset quantity input
            if (quantityInput) {
                quantityInput.value = '1';
            }
        }

        // Fun√ß√£o para adicionar produto √∫nico (clique no card)
        function addToCartSingle(productId, product) {
            debugLog('üõí Adicionando produto √∫nico ao carrinho: ID ' + productId);
            
            if (!product) {
                debugLog('‚ùå Produto n√£o fornecido: ' + productId);
                return;
            }

            // Verificar se produto j√° est√° no carrinho
            var existingItem = null;
            for (var j = 0; j < cart.length; j++) {
                if (cart[j].id == productId) {
                    existingItem = cart[j];
                    break;
                }
            }

            var maxStock = product.estoque || 999;
            if (existingItem) {
                if (existingItem.quantity >= maxStock) {
                    alert('Estoque insuficiente! Dispon√≠vel: ' + maxStock);
                    return;
                }
                existingItem.quantity += 1;
                debugLog('üìà Quantidade atualizada: ' + existingItem.nome + ' -> ' + existingItem.quantity);
            } else {
                cart.push({
                    id: product.id,
                    nome: product.nome,
                    preco: parseFloat(product.preco) || 0,
                    quantity: 1,
                    estoque: product.estoque || 0
                });
                debugLog('‚úÖ Produto adicionado: ' + product.nome + ' (Qtd: 1)');
            }

            // Feedback visual
            var productCard = document.querySelector('[data-product-id="' + productId + '"]');
            if (productCard) {
                productCard = productCard.closest('.product-card');
                if (productCard) {
                    productCard.style.background = 'rgba(155, 100, 227, 0.4)';
                    productCard.style.transform = 'scale(0.95)';
                    setTimeout(function() {
                        productCard.style.background = '';
                        productCard.style.transform = '';
                    }, 200);
                }
            }

            applyDiscountAutomatically();
            updateCartDisplay();
        }

        // Fun√ß√£o para remover do carrinho
        function removeFromCart(productId) {
            debugLog('üóëÔ∏è Removendo produto do carrinho: ID ' + productId);
            
            for (var i = 0; i < cart.length; i++) {
                if (cart[i].id == productId) {
                    cart.splice(i, 1);
                    break;
                }
            }
            
            updateCartDisplay();
        }

        // Fun√ß√£o para alterar quantidade no carrinho
        function changeCartQuantity(productId, delta) {
            debugLog('üìä Alterando quantidade: ID ' + productId + ', Delta: ' + delta);
            
            for (var i = 0; i < cart.length; i++) {
                if (cart[i].id == productId) {
                    cart[i].quantity += delta;
                    
                    if (cart[i].quantity <= 0) {
                        cart.splice(i, 1);
                    }
                    break;
                }
            }
            
            updateCartDisplay();
        }

        // Fun√ß√£o para atualizar exibi√ß√£o do carrinho
        function updateCartDisplay() {
            var cartItems = document.getElementById('cartItems');
            var cartTotal = document.getElementById('cartTotal');
            var cartSubtotal = document.getElementById('cartSubtotalValue');
            var checkoutBtn = document.getElementById('checkoutBtn');
            
            if (!cartItems) return;

            if (cart.length === 0) {
                cartItems.innerHTML = '<div class="cart-empty">Carrinho vazio<br><small>Clique nos produtos para adicionar</small></div>';
                cartTotal.textContent = 'R$ 0,00';
                if (cartSubtotal) cartSubtotal.textContent = 'R$ 0,00';
                checkoutBtn.disabled = true;
                clearDiscount();
                return;
            }

            var html = '';
            var subtotal = 0;

            for (var i = 0; i < cart.length; i++) {
                var item = cart[i];
                var itemTotal = item.preco * item.quantity;
                subtotal += itemTotal;

                html += 
                    '<div class="cart-item">' +
                        '<div class="cart-item-info">' +
                            '<div class="cart-item-name">' + item.nome + '</div>' +
                            '<div class="cart-item-price">' + formatCurrency(item.preco) + '</div>' +
                            '<div class="cart-item-controls">' +
                                '<button class="cart-quantity-btn" onclick="decrementCartItem(\'' + item.id + '\')">‚àí</button>' +
                                '<span class="cart-quantity">' + item.quantity + '</span>' +
                                '<button class="cart-quantity-btn" onclick="incrementCartItem(\'' + item.id + '\')">+</button>' +
                            '</div>' +
                        '</div>' +
                        '<div>' +
                            '<div class="cart-item-total">' + formatCurrency(itemTotal) + '</div>' +
                            '<button class="cart-item-remove" onclick="removeFromCart(\'' + item.id + '\')">‚úï</button>' +
                        '</div>' +
                    '</div>';
            }

            var finalTotal = subtotal - currentDiscount.appliedValue;

            cartItems.innerHTML = html;
            cartTotal.textContent = formatCurrency(finalTotal);
            if (cartSubtotal) cartSubtotal.textContent = formatCurrency(subtotal);
            checkoutBtn.disabled = false;

            debugLog('üõí Carrinho atualizado: ' + cart.length + ' itens, Subtotal: ' + formatCurrency(subtotal) + ', Total: ' + formatCurrency(finalTotal));
        }

        function incrementCartItem(productId) {
            var id = String(productId);
            var item = null;
            for (var i = 0; i < cart.length; i++) {
                if (String(cart[i].id) === id) {
                    item = cart[i];
                    break;
                }
            }
            
            if (item) {
                var maxStock = item.estoque || 999;
                if (item.quantity < maxStock) {
                    item.quantity += 1;
                    applyDiscountAutomatically();
                    updateCartDisplay();
                } else {
                    alert('Estoque insuficiente! Dispon√≠vel: ' + maxStock);
                }
            }
        }

        function decrementCartItem(productId) {
            var id = String(productId);
            var item = null;
            var itemIndex = -1;
            for (var i = 0; i < cart.length; i++) {
                if (String(cart[i].id) === id) {
                    item = cart[i];
                    itemIndex = i;
                    break;
                }
            }
            
            if (item) {
                if (item.quantity > 1) {
                    item.quantity -= 1;
                } else {
                    cart.splice(itemIndex, 1);
                }
                applyDiscountAutomatically();
                updateCartDisplay();
            }
        }

        // Fun√ß√£o para buscar produtos com debounce
        function searchProducts(event) {
            if (searchTimeout) {
                clearTimeout(searchTimeout);
            }

            var searchTerm = event.target.value;
            debugLog('üîç Buscando por: "' + searchTerm + '"');

            searchTimeout = setTimeout(function() {
                renderProducts(searchTerm);
            }, 300);
        }

        // Fun√ß√£o para scanner (placeholder)
        function openBarcodeScanner() {
            debugLog('üì∑ Scanner de c√≥digo de barras solicitado');
            alert('Funcionalidade de scanner em desenvolvimento');
        }

        // Fun√ß√£o para checkout
        function checkout() {
            if (cart.length === 0) {
                debugLog('‚ö†Ô∏è Tentativa de checkout com carrinho vazio');
                return;
            }

            debugLog('üí≥ Iniciando checkout com ' + cart.length + ' itens');
            
            // Resetar dados do checkout
            checkoutData.paymentMethod = null;
            checkoutData.installments = 1;
            
            updateOrderSummary();
            loadCheckoutSellers();
            
            document.getElementById('checkoutModal').classList.add('show');
            
            var paymentMethods = document.querySelectorAll('.payment-method');
            for (var i = 0; i < paymentMethods.length; i++) {
                paymentMethods[i].classList.remove('selected');
            }
            document.getElementById('installmentsSection').style.display = 'none';
            document.getElementById('confirmSaleBtn').disabled = true;
        }

        function closeCheckoutModal() {
            document.getElementById('checkoutModal').classList.remove('show');
            
            checkoutData.paymentMethod = null;
            checkoutData.installments = 1;
            checkoutData.valorRecebido = 0;
            checkoutData.troco = 0;
            
            document.getElementById('installmentsSection').style.display = 'none';
            document.getElementById('cashSection').style.display = 'none';
            document.getElementById('valorRecebido').value = '';
            var trocoDisplay = document.getElementById('trocoDisplay');
            if (trocoDisplay) trocoDisplay.style.display = 'none';
            
            var paymentMethods = document.querySelectorAll('.payment-method');
            for (var i = 0; i < paymentMethods.length; i++) {
                paymentMethods[i].classList.remove('selected');
            }
            var installmentOptions = document.querySelectorAll('.installment-option');
            for (var j = 0; j < installmentOptions.length; j++) {
                installmentOptions[j].classList.remove('selected');
            }
            
            document.getElementById('confirmSaleBtn').disabled = true;
        }

        function loadCheckoutSellers() {
            var selectElement = document.getElementById('checkoutSellerSelect');
            if (selectElement && usuarioLogado) {
                selectElement.innerHTML = '<option value="' + usuarioLogado.id + '">' + usuarioLogado.nome + '</option>';
            }
        }

        function updateOrderSummary() {
            var subtotal = 0;
            for (var i = 0; i < cart.length; i++) {
                subtotal += cart[i].preco * cart[i].quantity;
            }
            var discount = currentDiscount.appliedValue;
            var total = subtotal - discount;
            
            var summaryHTML = '<div class="summary-row"><span>Subtotal:</span><span>' + formatCurrency(subtotal) + '</span></div>';
            
            if (discount > 0) {
                summaryHTML += '<div class="summary-row"><span>Desconto:</span><span>- ' + formatCurrency(discount) + '</span></div>';
            }
            
            summaryHTML += '<div class="summary-row total"><span>Total:</span><span>' + formatCurrency(total) + '</span></div>';
            
            document.getElementById('orderSummary').innerHTML = summaryHTML;
        }

        function selectPaymentMethod(method) {
            checkoutData.paymentMethod = method;
            
            var paymentMethods = document.querySelectorAll('.payment-method');
            for (var i = 0; i < paymentMethods.length; i++) {
                paymentMethods[i].classList.remove('selected');
            }
            document.querySelector('[data-method="' + method + '"]').classList.add('selected');
            
            var installmentsSection = document.getElementById('installmentsSection');
            var cashSection = document.getElementById('cashSection');
            
            installmentsSection.style.display = 'none';
            cashSection.style.display = 'none';
            checkoutData.installments = 1;
            checkoutData.valorRecebido = 0;
            checkoutData.troco = 0;
            
            if (method === 'credito') {
                installmentsSection.style.display = 'block';
                generateInstallmentOptions();
            } else if (method === 'dinheiro') {
                cashSection.style.display = 'block';
                document.getElementById('valorRecebido').value = '';
                var trocoDisplay = document.getElementById('trocoDisplay');
                if (trocoDisplay) trocoDisplay.style.display = 'none';
                document.getElementById('confirmSaleBtn').disabled = true;
            } else {
                document.getElementById('confirmSaleBtn').disabled = false;
            }
        }

        function generateInstallmentOptions() {
            var subtotal = 0;
            for (var i = 0; i < cart.length; i++) {
                subtotal += cart[i].preco * cart[i].quantity;
            }
            var total = subtotal - currentDiscount.appliedValue;
            var installmentsGrid = document.getElementById('installmentsGrid');
            
            var installmentsHTML = '';
            
            installmentsHTML += '<div class="installment-option selected" data-installments="1" onclick="selectInstallments(1)">√Ä vista<br>' + formatCurrency(total) + '</div>';
            
            for (var i = 2; i <= 12; i++) {
                var installmentValue = total / i;
                installmentsHTML += '<div class="installment-option" data-installments="' + i + '" onclick="selectInstallments(' + i + ')">' + i + 'x<br>' + formatCurrency(installmentValue) + '</div>';
            }
            
            installmentsGrid.innerHTML = installmentsHTML;
            checkoutData.installments = 1;
            document.getElementById('confirmSaleBtn').disabled = false;
        }

        function selectInstallments(installments) {
            checkoutData.installments = installments;
            
            var installmentOptions = document.querySelectorAll('.installment-option');
            for (var i = 0; i < installmentOptions.length; i++) {
                installmentOptions[i].classList.remove('selected');
            }
            document.querySelector('[data-installments="' + installments + '"]').classList.add('selected');
        }

        function formatCashInput(input) {
            var value = input.value.replace(/\D/g, '');
            
            if (value === '') {
                input.value = '';
                return;
            }
            
            value = (parseInt(value) / 100).toFixed(2);
            
            input.value = parseFloat(value).toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            });
        }

        function calculateChange() {
            var valorRecebidoInput = document.getElementById('valorRecebido');
            var trocoDisplay = document.getElementById('trocoDisplay');
            var trocoValue = document.getElementById('trocoValue');
            
            var valorRecebidoStr = valorRecebidoInput.value.replace(/[^\d,]/g, '').replace(',', '.');
            var valorRecebido = parseFloat(valorRecebidoStr) || 0;
            
            var subtotal = 0;
            for (var i = 0; i < cart.length; i++) {
                subtotal += cart[i].preco * cart[i].quantity;
            }
            var total = subtotal - currentDiscount.appliedValue;
            
            var troco = valorRecebido - total;
            
            checkoutData.valorRecebido = valorRecebido;
            checkoutData.troco = troco;
            
            if (valorRecebido > 0) {
                trocoDisplay.style.display = 'block';
                trocoValue.textContent = formatCurrency(Math.abs(troco));
                
                if (troco >= 0) {
                    trocoDisplay.classList.remove('negative');
                    trocoValue.classList.remove('negative');
                    document.getElementById('confirmSaleBtn').disabled = false;
                } else {
                    trocoDisplay.classList.add('negative');
                    trocoValue.classList.add('negative');
                    document.getElementById('confirmSaleBtn').disabled = true;
                }
            } else {
                trocoDisplay.style.display = 'none';
                document.getElementById('confirmSaleBtn').disabled = true;
            }
        }

        function confirmSale() {
            if (!checkoutData.paymentMethod) {
                alert('Selecione um m√©todo de pagamento');
                return;
            }
            
            var subtotal = 0;
            for (var i = 0; i < cart.length; i++) {
                subtotal += cart[i].preco * cart[i].quantity;
            }
            
            var saleData = {
                vendedor_id: usuarioLogado ? usuarioLogado.id : null,
                metodo_pagamento: checkoutData.paymentMethod,
                parcelas: checkoutData.installments,
                valor_recebido: checkoutData.valorRecebido,
                troco: checkoutData.troco,
                desconto: currentDiscount.appliedValue,
                subtotal: subtotal,
                total: subtotal - currentDiscount.appliedValue,
                itens: cart
            };
            
            debugLog('üí≥ Confirmando venda: ' + JSON.stringify(saleData));
            
            // Simular sucesso da venda
            setTimeout(function() {
                showPdvNotification('success', 'Venda realizada com sucesso!\nTotal: ' + formatCurrency(saleData.total));
                
                // Limpar carrinho e fechar modal
                cart = [];
                clearDiscount();
                updateCartDisplay();
                closeCheckoutModal();
            }, 1000);
        }

        // Fun√ß√µes de favoritos
        function isFavorite(productId) {
            for (var i = 0; i < favorites.length; i++) {
                if (favorites[i].produto_id == productId) {
                    return true;
                }
            }
            return false;
        }

        function toggleFavorite(button) {
            if (!selectedUserId) {
                alert('Selecione um vendedor primeiro');
                return;
            }

            var productId = button.getAttribute('data-product-id');
            debugLog('üåü Toggle favorito para produto: ' + productId);

            var product = null;
            for (var i = 0; i < products.length; i++) {
                if (products[i].id == productId) {
                    product = products[i];
                    break;
                }
            }

            if (!product) {
                debugLog('‚ùå Produto n√£o encontrado para favorito: ' + productId);
                return;
            }

            var existingFavorite = null;
            var favoriteIndex = -1;
            for (var j = 0; j < favorites.length; j++) {
                if (favorites[j].produto_id == productId) {
                    existingFavorite = favorites[j];
                    favoriteIndex = j;
                    break;
                }
            }

            var xhr = new XMLHttpRequest();
            if (existingFavorite) {
                // Remover favorito
                xhr.open('DELETE', '/api/favoritos/' + selectedUserId + '/produtos/' + productId, true);
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            favorites.splice(favoriteIndex, 1);
                            button.classList.remove('active');
                            button.textContent = 'ü§ç';
                            debugLog('‚úÖ Favorito removido: ' + product.nome);
                            renderProducts();
                        } else {
                            debugLog('‚ùå Erro ao remover favorito: ' + xhr.status);
                        }
                    }
                };
                xhr.send();
            } else {
                // Adicionar favorito
                xhr.open('POST', '/api/favoritos/' + selectedUserId + '/produtos/' + productId, true);
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            favorites.push({produto_id: productId});
                            button.classList.add('active');
                            button.textContent = '‚ù§Ô∏è';
                            debugLog('‚úÖ Favorito adicionado: ' + product.nome);
                            renderProducts();
                        } else {
                            debugLog('‚ùå Erro ao adicionar favorito: ' + xhr.status);
                        }
                    }
                };
                xhr.send();
            }
        }

        // Fun√ß√µes de desconto
        function setDiscountType(type) {
            currentDiscount.type = type;
            
            var buttons = document.querySelectorAll('.discount-type-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            document.querySelector('[data-type="' + type + '"]').classList.add('active');
            
            var input = document.getElementById('discountInput');
            if (type === 'percentage') {
                input.placeholder = '0';
                input.max = '100';
                input.step = '0.01';
            } else {
                input.placeholder = '0,00';
                input.max = '999999';
                input.step = '0.01';
            }
            
            if (currentDiscount.amount > 0) {
                clearDiscount();
            }
            
            applyDiscountAutomatically();
        }

        function handleDiscountInput(input) {
            if (currentDiscount.type === 'value') {
                formatCurrencyInput(input);
            }
            applyDiscountAutomatically();
        }

        function applyDiscountAutomatically() {
            var input = document.getElementById('discountInput');
            var amount;
            
            if (currentDiscount.type === 'percentage') {
                amount = parseFloat(input.value) || 0;
            } else {
                amount = unformatCurrency(input.value);
            }
            
            if (amount <= 0) {
                currentDiscount.amount = 0;
                currentDiscount.appliedValue = 0;
                updateCartDisplay();
                updateDiscountDisplay();
                return;
            }
            
            var subtotal = 0;
            for (var i = 0; i < cart.length; i++) {
                subtotal += cart[i].preco * cart[i].quantity;
            }
            
            if (subtotal <= 0) {
                currentDiscount.amount = 0;
                currentDiscount.appliedValue = 0;
                updateCartDisplay();
                updateDiscountDisplay();
                return;
            }
            
            if (currentDiscount.type === 'percentage') {
                var limitedAmount = Math.min(100, Math.max(0, amount));
                if (limitedAmount !== amount) {
                    input.value = limitedAmount;
                }
                currentDiscount.amount = limitedAmount;
                currentDiscount.appliedValue = (subtotal * limitedAmount) / 100;
            } else {
                var limitedAmount = Math.min(subtotal, Math.max(0, amount));
                currentDiscount.amount = limitedAmount;
                currentDiscount.appliedValue = limitedAmount;
            }
            
            updateCartDisplay();
            updateDiscountDisplay();
        }

        function clearDiscount() {
            currentDiscount.amount = 0;
            currentDiscount.appliedValue = 0;
            document.getElementById('discountInput').value = '';
            updateCartDisplay();
            updateDiscountDisplay();
        }

        function updateDiscountDisplay() {
            var discountInfo = document.getElementById('discountInfo');
            var discountRow = document.getElementById('discountRow');
            var discountAmount = document.getElementById('discountAmount');
            
            if (currentDiscount.appliedValue > 0) {
                if (discountInfo) {
                    discountInfo.style.display = 'block';
                    var description = currentDiscount.type === 'percentage' 
                        ? currentDiscount.amount + '% de desconto aplicado'
                        : 'Desconto de ' + formatCurrency(currentDiscount.amount) + ' aplicado';
                    document.getElementById('discountDescription').textContent = description;
                }
                if (discountRow) {
                    discountRow.style.display = 'flex';
                }
                if (discountAmount) {
                    discountAmount.textContent = '- ' + formatCurrency(currentDiscount.appliedValue);
                }
            } else {
                if (discountInfo) discountInfo.style.display = 'none';
                if (discountRow) discountRow.style.display = 'none';
            }
        }

        // Fun√ß√µes de formata√ß√£o para valores monet√°rios
        function formatCurrency(value) {
            if (isNaN(value) || value === '') return 'R$ 0,00';
            var numValue = parseFloat(value);
            return 'R$ ' + numValue.toFixed(2).replace('.', ',');
        }

        function unformatCurrency(value) {
            if (!value) return 0;
            var cleaned = value.toString()
                .replace(/R\$\s?/g, '')
                .replace(/\s/g, '')
                .replace(/\./g, '')
                .replace(/,/g, '.');
            return parseFloat(cleaned) || 0;
        }

        function formatCurrencyInput(input) {
            var cursorPosition = input.selectionStart;
            var value = unformatCurrency(input.value);
            if (value === 0) {
                input.value = '';
                return;
            }
            var formatted = formatCurrency(value).replace('R$', '').trim();
            input.value = formatted;
            
            var newLength = input.value.length;
            var oldLength = formatted.length;
            var newPosition = Math.min(cursorPosition + (newLength - oldLength), newLength);
            setTimeout(function() {
                input.setSelectionRange(newPosition, newPosition);
            }, 0);
        }

        // Fun√ß√£o para mostrar erro
        function showError(message) {
            debugLog(message);
            
            var loadingStatus = document.getElementById('loadingStatus');
            loadingStatus.innerHTML = message;
            loadingStatus.className = 'status-message status-error';
            loadingStatus.style.display = 'block';
        }

        // Fun√ß√µes para modal de notifica√ß√£o PDV
        function showPdvNotification(type, message) {
            var iconContainer = document.getElementById('pdvNotificationIcon');
            
            if (type === 'success') {
                iconContainer.innerHTML = '<svg width="64" height="64" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" fill="#4CAF50"/><path d="M9 12l2 2 4-4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
            } else {
                iconContainer.innerHTML = '<svg width="64" height="64" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" fill="#F44336"/><path d="M15 9l-6 6M9 9l6 6" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
            }
            
            var modal = document.getElementById('pdvNotificationModal');
            var modalContent = modal.querySelector('.pdv-notification-modal');
            var title = document.getElementById('pdvNotificationModalTitle');
            var msg = document.getElementById('pdvNotificationModalMessage');
            
            title.textContent = type === 'success' ? 'Sucesso!' : 'Erro!';
            msg.textContent = message;
            modalContent.className = 'pdv-notification-modal ' + type;
            modal.classList.add('show');
        }

        function closePdvNotificationModal() {
            document.getElementById('pdvNotificationModal').classList.remove('show');
        }

        // Fun√ß√£o para criar anima√ß√£o do carrinho
        function createAddToCartAnimation(button, targetCart) {
            if (!button || !targetCart) return;
            
            var buttonRect = button.getBoundingClientRect();
            var cartRect = targetCart.getBoundingClientRect();
            
            var animationElement = document.createElement('div');
            animationElement.className = 'add-to-cart-animation';
            animationElement.innerHTML = '<div style="width: 20px; height: 20px; background: #9B64E3; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;">üõí</div>';
            
            animationElement.style.left = buttonRect.left + 'px';
            animationElement.style.top = buttonRect.top + 'px';
            
            document.body.appendChild(animationElement);
            
            // Simular anima√ß√£o com setTimeout
            setTimeout(function() {
                animationElement.style.transition = 'all 0.8s ease-out';
                animationElement.style.left = cartRect.left + 'px';
                animationElement.style.top = cartRect.top + 'px';
                animationElement.style.opacity = '0';
                animationElement.style.transform = 'scale(0.5)';
            }, 50);
            
            setTimeout(function() {
                if (animationElement.parentNode) {
                    animationElement.parentNode.removeChild(animationElement);
                }
            }, 900);
        }

        // Fun√ß√£o para carregar usu√°rio logado (simplificada)
        function carregarUsuarioLogado() {
            debugLog('üë§ Carregando usu√°rio logado (simplificado)...');
            try {
                var xhr = new XMLHttpRequest();
                xhr.open('GET', '/api/user-session', true);
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        debugLog('üë§ User session response - Status: ' + xhr.status);
                        if (xhr.status === 200) {
                            try {
                                var response = JSON.parse(xhr.responseText);
                                if (response.status === 'success' && response.user) {
                                    usuarioLogado = response.user;
                                    selectedUserId = usuarioLogado.id;
                                    debugLog('üë§ ‚úÖ Usu√°rio logado: ' + usuarioLogado.nome + ' (ID: ' + selectedUserId + ')');
                                } else {
                                    debugLog('üë§ ‚ö†Ô∏è Nenhum usu√°rio logado encontrado, continuando sem usu√°rio');
                                    // Definir um usu√°rio padr√£o tempor√°rio
                                    selectedUserId = 1;
                                }
                            } catch (e) {
                                debugLog('üë§ ‚ùå Erro ao fazer parse do usu√°rio: ' + e.message);
                                selectedUserId = 1; // Fallback
                            }
                        } else {
                            debugLog('üë§ ‚ö†Ô∏è Erro ao carregar usu√°rio, usando fallback - Status: ' + xhr.status);
                            selectedUserId = 1; // Fallback
                        }
                    }
                };
                xhr.onerror = function() {
                    debugLog('üë§ ‚ùå Erro de conex√£o ao carregar usu√°rio, usando fallback');
                    selectedUserId = 1; // Fallback
                };
                xhr.send();
            } catch (error) {
                debugLog('üë§ ‚ùå Erro geral ao carregar usu√°rio: ' + error.message);
                selectedUserId = 1; // Fallback
            }
        }

        // Fun√ß√£o para auto-selecionar vendedor
        function autoSelecionarVendedor() {
            debugLog('üë§ Auto-selecionando vendedor...');
            
            if (!usuarioLogado) {
                debugLog('‚ö†Ô∏è Nenhum usu√°rio logado para auto-sele√ß√£o');
                return;
            }
            
            selectedUserId = usuarioLogado.id;
            debugLog('‚úÖ Vendedor auto-selecionado: ' + usuarioLogado.nome + ' (ID: ' + selectedUserId + ')');
            
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/api/debug-log', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.send(JSON.stringify({
                message: 'Vendedor auto-selecionado: ' + usuarioLogado.nome + ' (ID: ' + selectedUserId + ')',
                level: 'INFO',
                source: 'PDV-VENDOR-SELECTED'
            }));
            
            debugLog('üåü Carregando favoritos...');
            loadUserFavorites();
        }

        // Fun√ß√£o para carregar favoritos do usu√°rio
        function loadUserFavorites() {
            debugLog('üåü Carregando favoritos para usu√°rio: ' + selectedUserId);
            
            if (!selectedUserId) {
                debugLog('‚ö†Ô∏è Nenhum vendedor selecionado para carregar favoritos');
                return;
            }
            
            try {
                var xhr = new XMLHttpRequest();
                xhr.open('GET', '/api/favoritos/' + selectedUserId + '/produtos', true);
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        debugLog('üì° Response favoritos recebido - Status: ' + xhr.status);
                        
                        if (xhr.status === 200) {
                            try {
                                var response = JSON.parse(xhr.responseText);
                                debugLog('‚úÖ Favoritos carregados - Status: ' + response.status);
                                
                                if (response.status === 'success' && response.favoritos) {
                                    favorites = response.favoritos;
                                    debugLog('üåü Favoritos encontrados: ' + favorites.length);
                                    
                                    // Re-renderizar produtos para mostrar favoritos
                                    renderProducts();
                                } else {
                                    debugLog('‚ö†Ô∏è Nenhum favorito encontrado');
                                    favorites = [];
                                    renderProducts();
                                }
                            } catch (e) {
                                debugLog('‚ùå Erro ao fazer parse dos favoritos: ' + e.message);
                                favorites = [];
                            }
                        } else {
                            debugLog('‚ùå Erro HTTP ao carregar favoritos: ' + xhr.status);
                            favorites = [];
                        }
                    }
                };
                
                xhr.onerror = function() {
                    debugLog('‚ùå Erro de conex√£o ao carregar favoritos');
                    favorites = [];
                };
                
                xhr.send();
                
            } catch (error) {
                debugLog('‚ùå Erro ao tentar carregar favoritos: ' + error.message);
                favorites = [];
            }
        }

        // Fun√ß√£o de inicializa√ß√£o
        function initializePDV() {
            var initTimestamp = new Date().toISOString();
            debugLog('üöÄ ===== INICIALIZANDO PDV iOS 12 ===== ' + initTimestamp);
            debugLog('üìÑ Document ready state: ' + document.readyState);
            debugLog('üåê URL atual: ' + window.location.href);
            debugLog('üì± User Agent: ' + navigator.userAgent);
            
            // Log inicial via Flask
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/api/debug-log', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.send(JSON.stringify({
                message: 'PDV iOS 12 inicializando - ' + initTimestamp,
                level: 'INFO',
                source: 'PDV-iOS12-INIT'
            }));
            
            debugLog('üß™ DOM funcionando! Agora testando requisi√ß√£o direta...');
            
            // Verificar elementos DOM essenciais
            debugLog('üîç Verificando elementos DOM...');
            var productsGrid = document.getElementById('productsGrid');
            var searchInput = document.getElementById('productSearch');
            var cartItems = document.getElementById('cartItems');
            var favoritesContainer = document.getElementById('favoritesContainer');
            var discountSection = document.querySelector('.discount-section');
            
            debugLog('productsGrid: ' + !!productsGrid);
            debugLog('searchInput: ' + !!searchInput);
            debugLog('cartItems: ' + !!cartItems);
            debugLog('favoritesContainer: ' + !!favoritesContainer);
            debugLog('discountSection: ' + !!discountSection);
            
            if (!productsGrid) {
                debugLog('‚ùå Elemento productsGrid n√£o encontrado!');
                return;
            }
            
            if (!cartItems) {
                debugLog('‚ùå Elemento cartItems n√£o encontrado!');
                return;
            }

            debugLog('‚úÖ Elementos DOM verificados');
            
            // Inicializar desconto padr√£o
            debugLog('üí∞ Inicializando sistema de desconto...');
            setDiscountType('percentage');
            
            // Testar requisi√ß√£o imediatamente mas de forma super simples
            debugLog('üß™ Fazendo requisi√ß√£o direta para /api/produtos...');
            
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/api/produtos', true);
            xhr.onreadystatechange = function() {
                debugLog('üì° XHR ReadyState: ' + xhr.readyState);
                if (xhr.readyState === 4) {
                    debugLog('üì° XHR Status: ' + xhr.status);
                    debugLog('üì° Response length: ' + (xhr.responseText ? xhr.responseText.length : 0));
                    
                    if (xhr.status === 200) {
                        debugLog('üì° ‚úÖ Resposta recebida!');
                        try {
                            var data = JSON.parse(xhr.responseText);
                            debugLog('üì¶ Produtos na resposta: ' + (data.produtos ? data.produtos.length : 0));
                            
                            if (data.produtos && data.produtos.length > 0) {
                                debugLog('üì¶ Primeiro produto: ' + JSON.stringify(data.produtos[0]).substring(0, 100));
                                
                                // Mostrar produtos diretamente no grid
                                var productsGrid = document.getElementById('productsGrid');
                                var html = '';
                                for (var i = 0; i < Math.min(3, data.produtos.length); i++) {
                                    var p = data.produtos[i];
                                    html += '<div style="background: rgba(155, 100, 227, 0.2); color: white; padding: 15px; margin: 10px; border-radius: 8px;">';
                                    html += '<h3>' + (p.nome || 'Sem nome') + '</h3>';
                                    html += '<p>Pre√ßo: R$ ' + (p.preco || '0,00') + '</p>';
                                    html += '</div>';
                                }
                                productsGrid.innerHTML = html;
                                debugLog('üì¶ ‚úÖ Produtos exibidos no grid!');
                            } else {
                                debugLog('üì¶ ‚ö†Ô∏è Nenhum produto encontrado na resposta');
                            }
                        } catch (e) {
                            debugLog('üì¶ ‚ùå Erro ao processar JSON: ' + e.message);
                        }
                    } else {
                        debugLog('üì° ‚ùå Erro HTTP: ' + xhr.status);
                    }
                }
            };
            xhr.onerror = function() {
                debugLog('üì° ‚ùå Erro de rede');
            };
            xhr.send();
            
            debugLog('‚úÖ PDV iOS 12 inicializado com sucesso!');
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üìÑ DOM carregado, inicializando PDV...');
            initializePDV();
        });

        // Expor fun√ß√£o globalmente para carregamento din√¢mico
        window.initializePDV = initializePDV;
        
        debugLog('üåê Fun√ß√£o initializePDV exposta globalmente');
        debugLog('üèÅ Script carregado completamente');
    </script>
</body>
</html>